<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">           

<html lang="he">
<head>
<meta charset="windows-1255">
<meta HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">

<META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">
<meta HTTP-EQUIV="EXPIRES" CONTENT="Mon, 22 Jul 2002 11:12:01 GMT">
<title>ועדת סדור מקומות</title>
<style>

 span {width:auto}

     #showNames { width:220px; height:22px; position:absolute; left:330px; top:131px;
		     background-color:LightGrey; border: 3px solid green;display:none; padding: 8px}	
 
    .steps1 {width:15px; height:50px; border: 1px solid DarkGray; position:absolute;  }
		.drawing_1 {width:220px; height:20px; position:absolute; left:330px; top:131px;
		     background-color:green; border: 1px solid green;visibility:hidden}	
		.drawing_2 {width:150px; height:20px; position:absolute; left:350px; top:131px;
		     border: 1px solid black; text-align: center;visibility:hidden}	  
		.knisa {position:absolute; left:310px; top:200px;visibility:hidden}
		.mafrid1 {  position:absolute; left:730px; top:140px; width:5px; height:600px;  
		     background-color:black;  border: 1px solid black; transform:rotate(-45deg);
				     -webkit-transform: rotate(-45deg);  
                     -moz-transform: rotate(-45deg);
                     -ms-transform: rotate(-45deg);visibility:hidden}
		.mafrid2 	{  position:absolute; left:945px; top:140px; height:5px; width:250px;  
		     background-color:black;  border: 1px solid black; visibility:hidden }	
		.mafrid3 {  position:absolute; left:466px; top:140px; height:5px; width:110px;  
		     background-color:black;  border: 1px solid black; transform:rotate(90deg);
				 -webkit-transform: rotate(90deg);  
                     -moz-transform: rotate(90deg);
                     -ms-transform: rotate(90deg); visibility:hidden} 
		.drawing_3 {width:240px; height:143px; position:absolute; left:29px; top:1px;
		     background-color:LightSlateGray; border: 1px solid black;visibility:hidden}	
		
		.mafrid4_2016 	{  position:absolute; left:30px; top:550px; height:5px; width:140px;  
		     background-color:black;  border: 1px solid black; visibility:hidden }	
		.mafrid5_2016 {  position:absolute; left:170px; top:140px; height:410px; width:5px;  
		     background-color:black;  border: 1px solid black;  visibility:hidden} 		 
				 		 
		.mafrid4 	{  position:absolute; left:30px; top:550px; height:5px; width:90px;  
		     background-color:black;  border: 1px solid black; visibility:hidden }	
		.mafrid5 {  position:absolute; left:120px; top:140px; height:410px; width:5px;  
		     background-color:black;  border: 1px solid black;  visibility:hidden} 	
		.knisa1, #knisa2		{position:absolute; left:40px; top:200px;font-size:30px;visibility:hidden} 	
		.arrow1 {position:absolute; left:40px; top:200px;font-size:100px;visibility:hidden}
		.arrow2 {position:absolute; left:0px; top:200px;font-size:100px;visibility:hidden}
		.drawing_4 {width:118px; height:118px; position:absolute; left:70px; top:20px;
		      background-color:LightSlateGray;border: 1px solid black; visibility:hidden}	
    .knisa3		{position:absolute; left:70px; top:140px;font-size:30px;visibility:hidden} 	
   	.arrow3 {position:absolute; left:70px; top:170px;font-size:100px;visibility:hidden}
    .drawing_5 {width:50px; height:33px; position:absolute; left:70px; top:269px;
		      background-color:LightSlateGray;border: 1px solid black; visibility:hidden}	
    .arrow4 {position:absolute; left:950px; top:350px;font-size:100px; transform: rotate(180deg); visibility:hidden}
		.drawing_6 {width:50px; height:23px; position:absolute; left:70px; top:446px;
		      background-color:LightSlateGray;border: 1px solid black; visibility:hidden}	
	  .knisa4		{position:absolute; left:980px; top:400px;font-size:30px;visibility:hidden} 		
		
		
		#calculatedStsfctn {position:absolute; left:600px; top:730px; }
		
		#explnArrow1 { width:720px;border:1px solid; position:absolute; left:50px; top:330px;visibility:hidden; background:white}
		#explnArrow2 { width:720px;border:1px solid; position:absolute; left:50px; top:330px;visibility:hidden; background:white}
		#explnAddMember { width:900px;border:1px solid; position:absolute; left:150px; top:400px;visibility:hidden}

		#prtFormt { display:inline-block;  text-align:right;  color;black;     border:1px solid Black; 
		            backgroundColor:transparent; overflow: auto;   padding:0px; margin: 0px;}    

		
		#hall1Txt {font-size:30px;}
		#hall2Button {font-size:30px;}
		#hall3Txt {font-size:30px;}

		#hall1 { border:2px solid black;  width:1200px;height:970px; display:inline-block;   padding: 0;
              margin: 0; float:left;  min-width: 0;}	
		#hall2 { border:2px solid black;  width:1200px;height:780px; display:inline-block;   padding: 0;
              margin: 0; float:left;  min-width: 0; }	
		#hall3 { border:2px solid black;  width:1200px;height:770px; display:inline-block;   padding: 0;
              margin: 0; float:left;  min-width: 0;}															
    #Button {border-style:hidden; width:50px; align:center; float:center;position:relative; margin: auto;}
   label, legend, radio, checkbox {display:inline-block; text-align:right; text-align:top; vertical-align:middle}
	 legend {color:red}
   textarea {width:560px; height:80px;  border:1px solid black; font-size:15px}
   #id1 {width:auto}
    td   {border:1px solid black; border-collapse:collapse; font-size:16px; text-align:center;font-weight:bold;}
	 input {font-size:25px}
	 .floatingDivColorTable  {border:1px solid black; border-collapse:collapse; font-size:16px; text-align:center;font-weight:bold;}
	  
		#FmNmT1 {display:inline-block; vertical-align:middle;border-collapse:collapse }
		#FmNmT2 {display:inline-block; vertical-align:middle;border-collapse:collapse }
		#fmNameFloat  {	border-style: none}
		#fmName {	border-style: none}
	  img {position:absolute; z-index:-1}
     body{direction: rtl; overflow-x:scroll}
		
		#dbgdiv {position:absolute; width:5px; height:5px; background:red; z-index:15}
		 
		
   .UlClass {}
	 
	   input[type="number"] {  direction:ltr; text-align:center }
		 ul {position:relative;  display:block;list-style-type:none; margin:0;  -webkit-padding-start: 0px; }
		 li {border:1px solid green;vertical-align:middlepadding:0px; margin: 0px; overflow:hidden;z-index:2 }
		 span { margin:0px; padding:0px;vertical-align:middle; text-align:center;}
		.W40H20  { width:40px; height:20px;  position:relative; display:inline-block; margin:0px; padding:0px;   }
		.spnForW40H20    { width:42px; height:10px; position:relative; display:inline-block; margin:0 ;padding:0 }
		
		.W25H40  { width:25px; height:40px; position:relative; display:inline-block; margin:0; padding:25px 0px 0px 0px;}
		.W40H25  { width:40px; height:25px; position:relative; display:inline-block; margin:0; padding:0;   }
		.W22H37  { width:22px; height:37px; position:relative; display:inline-block; margin:0; padding:12px 0px 0px 0px;   }
		.spnForW22H37   { width:24px; height:10px; position:relative; display:inline-block; margin:0; padding:0}

 		.W50H20  { width:50px; height:22px; position:relative; display:inline-block; margin:0; padding:0;   }
		
		.W20H50  { width:22px; height:50px; position:relative; display:inline-block; margin:0; padding:0;   }
		
		.spnForW50H20   { width:52px; height:5px; position:relative; display:inline-block; margin:0; padding:0;   }
    
		.RotatedM90Div   { position:absolute; text-align: center;
                                        vertical-align: middle;
			               -webkit-transform: rotate(270deg);  
                     -moz-transform: rotate(270deg);
                     -ms-transform: rotate(270deg);
                      transform: rotate(270deg)  
											}
		
		.RotatedM90DivSpecial   { position:absolute; text-align: center;
                                        vertical-align: middle;
			               -webkit-transform: rotate(270deg); 
										      -webkit-transform-origin: 0% 0%;  
                     -moz-transform: rotate(270deg);
										      -moz-transform-origin: 0% 0%; 
                     -ms-transform: rotate(270deg);
										      -ms-transform-origin: 0% 0%; 
                      transform: rotate(270deg);
											    transform-origin: 0% 0%; 
											}
											
											
		.Rotated90Div   { position:absolute; text-align: center;
                                        vertical-align: middle;
			               -webkit-transform: rotate(90deg); 
										      -webkit-transform-origin: 0% 0%;  
                     -moz-transform: rotate(90deg);
										      -moz-transform-origin: 0% 0%; 
                     -ms-transform: rotate(90deg);
										      -ms-transform-origin: 0% 0%; 
                      transform: rotate(90deg);
											    transform-origin: 0% 0%; 
											}									
		.NoRotateDiv   { position:absolute; text-align: center;
                                        vertical-align: middle;}

	  .prtRotated45Div   { position:absolute; 
	                      	text-align: center;
                          vertical-align: middle;
		                 -webkit-transform: rotate(45deg);
										   -webkit-transform-origin: 0% 0%;  
                     -moz-transform: rotate(45deg);
										  -moz-transform-origin: 0% 0%; 
                     -ms-transform: rotate(45deg);
										  -ms-transform-origin: 0% 0%; 
                      transform: rotate(45deg);  
											 transform-origin: 0% 0%; 
									  }
		.Rotated45Div   { position:absolute; 
	                      	text-align: center;
                          vertical-align: middle;
		                 -webkit-transform: rotate(45deg);  
                     -moz-transform: rotate(45deg);
                     -ms-transform: rotate(45deg);
                      transform: rotate(45deg)  
									  }
										
		.RotatedM45Div   { position:absolute; 
 		                 -webkit-transform: rotate(-45deg);  
                     -moz-transform: rotate(-45deg);
                     -ms-transform: rotate(-45deg);
                      transform: rotate(-45deg)  
									  }
										
	 .RotatedM315Div   { position:absolute; 
		                 -webkit-transform: rotate(-315deg);   
                     -moz-transform: rotate(-315deg);
                     -ms-transform: rotate(-315deg);
                      transform: rotate(-315deg)  
									  }	
										
		.RotatedM135Div   { position:absolute; 
		                 -webkit-transform: rotate(-135deg);   
                     -moz-transform: rotate(-135deg);
                     -ms-transform: rotate(-135deg);
                      transform: rotate(-135);
											}  
											
											
		.RotatedM315Div   { position:absolute; 
		                 -webkit-transform: rotate(-315deg);   
                     -moz-transform: rotate(-315deg);
                     -ms-transform: rotate(-315deg);
                      transform: rotate(-315deg);  
									   									  }											
	 .notRotatedDiv {position:absolute}
	 
	 .textNotRotated {display:inline-block; 
	                 line-height:80%;
                        margin:0px 0px 0px 0px;   
	                    width:auto;height:auto;}
	 
	 .prtTextRotatedM90 {  display:inline-block;
                    	margin-right: 0%; 
											bottom:0;
											line-height:80%;
	                   -webkit-transform: rotate(-90deg);
										   -webkit-transform-origin: 100% 100%;  
                     -moz-transform: rotate(-90deg);
										  -moz-transform-origin: 100% 100%; 
                     -ms-transform: rotate(-90deg);
										  -ms-transform-origin: 100% 100%; 
                      transform: rotate(-90deg);  
											 transform-origin: 100% 100%; 
	                }
									
		.prtTextRotatedM90_4 {  display:inline-block;
                    	margin-right: 0%; 
											bottom:0;
											line-height:80%;
	                   -webkit-transform: rotate(-90deg);
										   -webkit-transform-origin: 50% 50%;  
                     -moz-transform: rotate(-90deg);
										  -moz-transform-origin: 50% 50%; 
                     -ms-transform: rotate(-90deg);
										  -ms-transform-origin: 50% 50%; 
                      transform: rotate(-90deg);  
											 transform-origin: 50% 50%; 
	                }							
									
	 .textRotatedM90 {  display:inline-block;
                    	margin-right: 0%; 
											
	                   -webkit-transform: rotate(-90deg);
										 -moz-transform: rotate(-90deg);
										 -ms-transform: rotate(-90deg);
										 transform: rotate(-90deg);  
									    }
											
		.textRotatedM90Special	{  display:inline-block;
                    	margin-right: 0%; 
											width:49;
											height:19;
	                   -webkit-transform: rotate(-90deg);
										   -webkit-transform-origin: 80%;  
										 -moz-transform: rotate(-90deg);
										    -moz-transform-origin: 80%; 
										 -ms-transform: rotate(-90deg);
										     -ms-transform-origin: 80%; 
										 transform: rotate(-90deg);  
										   transform-origin: 80%; 
									    }								
	 .textRotated90 {  display:inline-block;  
                        margin:0px 0px 0px 0px;   
	                   
										
                     -webkit-transform: rotate(90deg);
										 -moz-transform: rotate(90deg);
										 -ms-transform: rotate(90deg);
										  transform: rotate(90deg);  
						         }
										 
		.textRotated90Special	{  display:inline-block;  position:absolute; left:10;  bottom:40;
                        margin:0px 0px 0px 0px;   
	                   width:49;
											height:19;
										
                     -webkit-transform: rotate(90deg);
										   -webkit-transform-origin: 0%;  
                     -moz-transform: rotate(90deg);
										  -moz-transform-origin: 0%; 
                     -ms-transform: rotate(90deg);
										  -ms-transform-origin: 0%; 
                      transform: rotate(90deg);  
											 transform-origin: 0%; 
						         }							 
									
	.prtNarrowTextRotated90 {  display:inline-block; float:right; position:absolute; bottom:0; 
                        margin:0px 0px 0px 0px;   
	                   line-height:80%;
										
                     -webkit-transform: rotate(90deg);
										   -webkit-transform-origin: 80%;  
                     -moz-transform: rotate(90deg);
										  -moz-transform-origin: 80%; 
                     -ms-transform: rotate(90deg);
										  -ms-transform-origin: 80%; 
                      transform: rotate(90deg);  
											 transform-origin: 80%; 
	                }								
	
	.prtWideTextRotated90 {  display:inline-block; float:right; position:absolute; bottom:0; 
                        margin:0px 0px 0px 0px;   
	                   line-height:80%;
										
                     -webkit-transform: rotate(90deg);	
										 	  -webkit-transform-origin: 50% 30%;  
                     -moz-transform: rotate(90deg);
										  -moz-transform-origin: 50% 50%; 
                     -ms-transform: rotate(90deg);
										  -ms-transform-origin: 50% 50%; 
                      transform: rotate(90deg);  
											 transform-origin: 50% 50%; 
	                }			
									
	.RotatedM135Txt  {}
	
	.prtRotate90 {  
                      
	                     position:absolute; 
		                 -webkit-transform: rotate(90deg);   
										      -webkit-transform-origin: 0% 30%; 
                     -moz-transform: rotate(90deg);
										      -moz-transform-origin: 0% 50%; 
                     -ms-transform: rotate(90deg);
										     -ms-transform-origin: 0% 50%; 
                      transform: rotate(90deg);  
											    transform-origin: 0% 50%;  
                     }
	
	#dialogoverlay{
	display: none;
	opacity: .8;
	position: fixed;
	top: 0px;
	left: 0px;
	background: #FFF;
	width: 100%;
	z-index: 10;
}
#dialogbox{
	display: none;
	position: fixed;
	background: #000;
	border-radius:7px; 
	width:550px;
	z-index: 10;
}

#dialogbox > div{ background:#FFF; margin:8px; }
#dialogbox > div > #dialogboxhead{ background: DarkGray; font-size:19px; padding:10px; color:#CCC; }
#dialogbox > div > #dialogboxbody{ background:DarkSlateGray; padding:20px; color:#FFF; }
#dialogbox > div > #dialogboxfoot{ background: DarkGray; padding:10px; text-align:right; }
	
	
	 
</style>
<script>


var xhttp = new XMLHttpRequest();
var xhttpDnld = new XMLHttpRequest();


var toPrint =new Array;

var validPasswordEntered=false;

// rgb colors
RGray='rgba(190,190,190,0.6)';
RBlue='rgba(0,0,255,0.6)';
RGreen='rgba(0,255,0,0.6)';
RYellow='rgba(255,255,0,0.6)';
ROrange='rgba(255,165,0,0.6)';
RRed='rgba(255,0,0,0.6)';
RRed4='rgba(139,0,0,0.6)';  // dark red replacement


// color map
// colormap= [ [0,'white','white'], [1, 'Gray', 'Blue'], [2, 'Green', 'Yellow'], [3,'Orange', 'Red'], [500, 'DarkRed', 'DarkRed']  ]; 
 colormap= [ [0,'white','white'], [1, RGray, RBlue], [2, RGreen, RYellow], [3,ROrange, RRed], [500, RRed4, RRed4]  ]; 
 
 var mapForMember;



                     
// -----------------------------MARTEF-----------------------------------------------------


row701_2016={firstInRow:701, lastInRow:781, lft:552, tp:60,textRotate:"textNotRotated", cellClass:"W40H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};
row702_2016={firstInRow:702, lastInRow:782};
row703_2016={firstInRow:703, lastInRow:783};
row704_2016={firstInRow:704, lastInRow:784};
row705_2016={firstInRow:705, lastInRow:785};
spn716_2016={spn:"spn",  spnClass:"spnForW40H20" ,spnCount:1};
row716_2016={firstInRow:716, lastInRow:786};
								 List701T716_2016= [[10,10,10,10,10,10,10,10,10],row701_2016,row702_2016,row703_2016,row704_2016,row705_2016,spn716_2016, row716_2016];
	
row711={firstInRow:711, lastInRow:781, lft:552, tp:60,textRotate:"textNotRotated", cellClass:"W40H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};
row712={firstInRow:712, lastInRow:782};
row713={firstInRow:713, lastInRow:783};
row714={firstInRow:714, lastInRow:784};
row715={firstInRow:715, lastInRow:785};
row716={firstInRow:716, lastInRow:786};
								 List701T716= [[10,10,10,10,10,10,10,10,10],row711,row712,row713,row714,row715, row716];
								 	
								 
row801=	{firstInRow:801, lastInRow:805, lft:1065, tp:270,textRotate:"textRotated90",  cellClass:"W25H40", uLstClass:"UlClass",divClass:"notRotatedDiv"};							 
row811=	{firstInRow:811, lastInRow:815};
                 List801T811=[[1,1,1,1,1,1],row801,row811];
								 
row821=	{firstInRow:821, lastInRow:826, lft:1040, tp:515,textRotate:"textRotated90", cellClass:"W25H40", uLstClass:"UlClass",divClass:"notRotatedDiv"};							 
row831=	{firstInRow:831, lastInRow:836};
row841=	{firstInRow:841, lastInRow:845};	
	                  List821T841=[[1,1,1,1,1,1],row821,row831,row841];
										
row901_2016=	{firstInRow:901, lastInRow:906, lft:1012, tp:737, textRotate:"textRotated90",cellClass:"W25H40", uLstClass:"UlClass",divClass:"notRotatedDiv"};							 
row911_2016=	{firstInRow:911, lastInRow:916};										
row921_2016=	{firstInRow:921, lastInRow:927};	
	                   List901T921_2016=[[1,1,1,1,1,1,1],row901_2016,row911_2016,row921_2016];
										 
row901=	{firstInRow:901, lastInRow:905, lft:1065, tp:737, textRotate:"textRotated90",cellClass:"W25H40", uLstClass:"UlClass",divClass:"notRotatedDiv"};							 
row911=	{firstInRow:911, lastInRow:915};										
row921=	{firstInRow:921, lastInRow:925};	
	                   List901T921=[[1,1,1,1,1,1,1],row901,row911,row921];
/*										 										
row1009={firstInRow:1009, lastInRow:1109, lft:410, tp:430,textRotate:"textNotRotated", cellClass:"W40H25", uLstClass:"UlClass",divClass:"RotatedM45Div"};
row1008={firstInRow:1008, lastInRow:1108};	
row1007={firstInRow:1007, lastInRow:1127};	
row1006={firstInRow:1006, lastInRow:1126};	
row1005={firstInRow:1005, lastInRow:1125};	
row1004={firstInRow:1004, lastInRow:1124};	
row1003={firstInRow:1003, lastInRow:1123};	
row1002={firstInRow:1002, lastInRow:1122};	
row1001={firstInRow:1001, lastInRow:1121};	

*/
//2016
row1009_2016={firstInRow:1009, lastInRow:1089, lft:470, tp:400,textRotate:"textNotRotated", cellClass:"W40H25", uLstClass:"UlClass",divClass:"RotatedM45Div"};
row1008_2016={firstInRow:1008, lastInRow:1088};	
row1007_2016={firstInRow:1007, lastInRow:1087};	
row1006_2016={firstInRow:1006, lastInRow:1086};	
row1005_2016={firstInRow:1005, lastInRow:1085};	
row1004_2016={firstInRow:1004, lastInRow:1084};	
row1003_2016={firstInRow:1003, lastInRow:1083};	
row1002_2016={firstInRow:1002, lastInRow:1082};	
row1001_2016={firstInRow:1001, lastInRow:1081};	
// end 2016

       List1009T1101_2016= [[20,20,20,20,20,20,20,20,20], row1009_2016,row1008_2016,row1007_2016,row1006_2016,row1005_2016,
			 row1004_2016,row1003_2016,row1002_2016,row1001_2016];


row1008={firstInRow:1008, lastInRow:1098,lft:427, tp:428,textRotate:"textNotRotated", cellClass:"W40H25", uLstClass:"UlClass",divClass:"RotatedM45Div"};	
row1007={firstInRow:1007, lastInRow:1097};	
row1006={firstInRow:1006, lastInRow:1096};	
row1005={firstInRow:1005, lastInRow:1095};	
row1004={firstInRow:1004, lastInRow:1094};	
row1003={firstInRow:1003, lastInRow:1093};	
row1002={firstInRow:1002, lastInRow:1092};	
row1001={firstInRow:1001, lastInRow:1091};
									 
									 
			 List1009T1101= [[20,20,20,20,10], row1008,row1007,row1006,row1005,row1004,row1003,row1002,row1001];
			 
//2016
//row937={firstInRow:937, lastInRow:974, lft:650, tp:645, textRotate:"textNotRotated",cellClass:"W40H25", uLstClass:"UlClass",divClass:"RotatedM45Div"};  // last was 982
row937_2016={firstInRow:937, lastInRow:974, lft:650, tp:610, textRotate:"textNotRotated",cellClass:"W40H25", uLstClass:"UlClass",divClass:"RotatedM45Div"};  // last was 982
row936_2016={firstInRow:936, lastInRow:973};// was 981
row935_2016={firstInRow:935, lastInRow:972};
row934_2016={firstInRow:934, lastInRow:971};
row933_2016={firstInRow:933, lastInRow:962};
row932_2016={firstInRow:932, lastInRow:961};
row931_2016={firstInRow:931, lastInRow:941};
            List937T931_2016=[[10,9,10,8,8], row937_2016,row936_2016,row935_2016,row934_2016,row933_2016,row932_2016,row931_2016];
// end 2016

row937={firstInRow:937, lastInRow:984, lft:577, tp:623, textRotate:"textNotRotated",cellClass:"W40H25", uLstClass:"UlClass",divClass:"RotatedM45Div"};  // last was 982

row936={firstInRow:936, lastInRow:983};// was 981
row935={firstInRow:935, lastInRow:982};
row934={firstInRow:934, lastInRow:981};
row933={firstInRow:933, lastInRow:962};

						
						List937T931=[[10,9,10,8,8,10], row937,row936,row935,row934,row933]


								 
row851=	{firstInRow:851, lastInRow:863, lft:550, tp:420, textRotate:"textRotatedM90",cellClass:"W22H37", uLstClass:"UlClass",divClass:"RotatedM315Div"};							 
                    List851= [[1,1,1,1,1,1,1,1,1,1,1,1,1],row851];
 

    ListArray1_2016 = [List701T716_2016,List801T811,List821T841,List901T921_2016,List1009T1101_2016,List937T931_2016,List851];
		ListArray1 = [List701T716,List801T811,List821T841,List901T921,List1009T1101,List937T931,List851];

// --------------------------------OOLAM RASHI------------------------------------------------------------------	


/*
row641 = {firstInRow:641, lastInRow:681, lft:310, tp:280,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};			
row642 = {firstInRow:642, lastInRow:682};	
row643 = {firstInRow:643, lastInRow:683};
row644 = {firstInRow:644, lastInRow:684};
row645 = {firstInRow:645, lastInRow:685};
row646 = {firstInRow:646, lastInRow:686};
row647 = {firstInRow:647, lastInRow:687};
row648 = {firstInRow:648, lastInRow:688};
row649 = {firstInRow:649, lastInRow:689};
row650 = {firstInRow:650, lastInRow:690};
row651 = {firstInRow:651, lastInRow:691};
            List681T691=[[20,20,20],row641,row642,row643,row644,row645,row646,row647,row648,row649,row650,row651];
 */
 
// 2016
row661_2016 = {firstInRow:661, lastInRow:681, lft:50, tp:280,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};			
row662_2016 = {firstInRow:662, lastInRow:682};	
row663_2016 = {firstInRow:663, lastInRow:683};
row664_2016 = {firstInRow:664, lastInRow:684};
row665_2016 = {firstInRow:665, lastInRow:685};
row666_2016 = {firstInRow:666, lastInRow:686};
row667_2016= {firstInRow:667, lastInRow:687};
row668_2016 = {firstInRow:668, lastInRow:688};
row669_2016 = {firstInRow:669, lastInRow:689};
row670_2016 = {firstInRow:670, lastInRow:690};
row671_2016 = {firstInRow:671, lastInRow:691};
            List681T691_2016=[[20,20,20],row661_2016,row662_2016,row663_2016,row664_2016,row665_2016,row666_2016,row667_2016,
						       row668_2016,row669_2016,row670_2016,row671_2016];
 
//  textRotatedM90Special   lft:110, tp:277   
 
 
 row681 = {firstInRow:681, lastInRow:691, lft:55, tp:542,textRotate:"textRotated90Special", cellClass:"W20H50", uLstClass:"UlClass",divClass:"RotatedM90DivSpecial"};			
  List681T681=[[1,1,1,1,1,1,1,1,1,1,1,1],row681];
 
/* 
row391 = {firstInRow:391, lastInRow:581, lft:510, tp:280,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};	
row392 = {firstInRow:392, lastInRow:582};
row393 = {firstInRow:393, lastInRow:583};
row394 = {firstInRow:394, lastInRow:584};
row395 = {firstInRow:395, lastInRow:585};
row396 = {firstInRow:396, lastInRow:586};
row397 = {firstInRow:397, lastInRow:587};
row398 = {firstInRow:398, lastInRow:588};
spn579={spn:"spn",  spnClass:"spnForW50H20",spnCount:1};
row579 = {firstInRow:579, lastInRow:589};
spn590={spn:"spn",  spnClass:"spnForW50H20",spnCount:2};
row590 = {firstInRow:590, lastInRow:590};
row591 = {firstInRow:591, lastInRow:591};
spn391={spn:"spn",  spnClass:"spnForW50H20"};
*/

//2016
row391_2016 = {firstInRow:391, lastInRow:601, lft:190, tp:280,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};	
row392_2016 = {firstInRow:392, lastInRow:602};
row393_2016 = {firstInRow:393, lastInRow:603};
row394_2016 = {firstInRow:394, lastInRow:604};
row395_2016 = {firstInRow:395, lastInRow:605};
row396_2016 = {firstInRow:396, lastInRow:606};
row397_2016 = {firstInRow:397, lastInRow:607};
row398_2016 = {firstInRow:398, lastInRow:608};
spn579_2016={spn:"spn",  spnClass:"spnForW50H20",spnCount:1};
row579_2016 = {firstInRow:579, lastInRow:609};
spn590_2016={spn:"spn",  spnClass:"spnForW50H20",spnCount:2};
row590_2016 = {firstInRow:590, lastInRow:610};
row591_2016 = {firstInRow:591, lastInRow:611};
spn391_2016={spn:"spn",  spnClass:"spnForW50H20"};

              List391T591_2016 = [[180,10,20],row391_2016,row392_2016,row393_2016,row394_2016,row395_2016,
							     row396_2016,row397_2016,row398_2016,spn579_2016,row579_2016,spn590_2016,row590_2016,spn590_2016,row591_2016];
														 
														 
//
row391 = {firstInRow:391, lastInRow:661, lft:140, tp:280,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};	
row392 = {firstInRow:392, lastInRow:662};
row393 = {firstInRow:393, lastInRow:663};
row394 = {firstInRow:394, lastInRow:664};
row395 = {firstInRow:395, lastInRow:665};
row396 = {firstInRow:396, lastInRow:666};
row397 = {firstInRow:397, lastInRow:667};
row398 = {firstInRow:398, lastInRow:668};
spn579={spn:"spn",  spnClass:"spnForW50H20",spnCount:1};
row579 = {firstInRow:579, lastInRow:669};
spn590={spn:"spn",  spnClass:"spnForW50H20",spnCount:2};
row590 = {firstInRow:590, lastInRow:670};
row591 = {firstInRow:591, lastInRow:671};
spn391={spn:"spn",  spnClass:"spnForW50H20"};

              List391T591 = [[180,10,20,60],row391,row392,row393,row394,row395,row396,row397,row398,spn579,row579,
							               spn590,row590,spn590,row591];
 
 row301 = {firstInRow:301, lastInRow:371, lft:270, tp:16,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};
 row302 = {firstInRow:302, lastInRow:372};
 row303 = {firstInRow:303, lastInRow:373};
 row304 = {firstInRow:304, lastInRow:374};
 row305 = {firstInRow:305, lastInRow:375};
 spn316={spn:"spn",  spnClass:"spnForW50H20",spnCount:1};
 row316 = {firstInRow:316, lastInRow:376};
              list301T316=[[10,10,10,10,10,10,10,10],row301,row302,row303,row304,row305,spn316,row316];
 
  
 row401 = {firstInRow:401, lastInRow:405, lft:770, tp:230,textRotate:"textRotated90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"notRotatedDiv"};
 row411 = {firstInRow:411, lastInRow:416};
 row421 = {firstInRow:421, lastInRow:426};
 row431 = {firstInRow:431, lastInRow:436};
 row441 = {firstInRow:441, lastInRow:446};
 row451 = {firstInRow:451, lastInRow:456};
 row471 = {firstInRow:471, lastInRow:476};
 row491 = {firstInRow:491, lastInRow:496};
 row511 = {firstInRow:511, lastInRow:516};
 row541 = {firstInRow:541, lastInRow:547};
                List401T541=[[1,1,1,1,1,1,1,1,1],
								              row401,row411,row421,row431,row441,row451,row471,row491,row511,row541];
 
 
 row461 = {firstInRow:461, lastInRow:467, lft:338, tp:485,textRotate:"textRotated90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"notRotatedDiv"};
 row481 = {firstInRow:481, lastInRow:488};
 row501 = {firstInRow:501, lastInRow:510};
 row521 = {firstInRow:521, lastInRow:532};
 row548 = {firstInRow:548, lastInRow:565};
               List461T548=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],row461,row481,row501,row521,row548];
							 
 row381={firstInRow:381, lastInRow:382, lft:670, tp:230,textRotate:"textRotated90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"RotatedM135Div"};
               List381=[[1,1],row381];


   ListArray2_2016=[List681T691_2016,List391T591_2016,list301T316,List401T541,List461T548,List381]							 
   ListArray2=[List681T681,List391T591,list301T316,List401T541,List461T548,List381];
 
// -----------EZRAT NASHIM-----------------------------------------------------------------
 
 row111 = {firstInRow:111, lastInRow:141, lft:70, tp:280,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};	
 row112 = {firstInRow:112, lastInRow:161};
 row113 = {firstInRow:113, lastInRow:162};
 row114 = {firstInRow:114, lastInRow:163};
 spn164={spn:"spn",  spnClass:"spnForW50H20",spnCount:4};
 row164 = {firstInRow:164, lastInRow:164};
              List111T164=[[10,10,10,19,1],row111, row112,row113,row114,spn164,row164];
 
 
 
 row115 = {firstInRow:115, lastInRow:165,lft:70, tp:400,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv" };
 row116 = {firstInRow:116, lastInRow:166};
 row117 = {firstInRow:117, lastInRow:147};
             List115T117=[[10,10,10,20,1],row115,row116,row117];
 
 row118 = {firstInRow:118, lastInRow:167,lft:70, tp:471,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv" };
 spn129= {spn:"spn",  spnClass:"spnForW50H20",spnCount:1};
 row129 = {firstInRow:129, lastInRow:168};
 spn140={spn:"spn",  spnClass:"spnForW50H20",spnCount:2};
 row140 = {firstInRow:140, lastInRow:169};
 spn151={spn:"spn",  spnClass:"spnForW50H20",spnCount:3};
 row151 = {firstInRow:151, lastInRow:170};
 spn171={spn:"spn",  spnClass:"spnForW50H20",spnCount:4};
 row171 = {firstInRow:171, lastInRow:171};
 spn172={spn:"spn",  spnClass:"spnForW50H20",spnCount:4};
 row172 = {firstInRow:172, lastInRow:172};	
 spn173={spn:"spn",  spnClass:"spnForW50H20",spnCount:4};
 row173 = {firstInRow:173, lastInRow:173}
	            List111T173=[[10,10,10,19,1],row118,spn129,row129,spn140,row140,spn151,row151,spn171,row171,
							       spn172,row172,spn173,row173];
	
 
 //---
 spn91={spn:"spn",  spnClass:"spnForW50H20",spnCount:1, lft:190, tp:20,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};
 row91 = {firstInRow:91, lastInRow:101};
 row81 = {firstInRow:81, lastInRow:102};
 row82 = {firstInRow:82, lastInRow:103};
 row83 = {firstInRow:83, lastInRow:104};
 spn105={spn:"spn",  spnClass:"spnForW50H20",spnCount:2};
 row105 = {firstInRow:105, lastInRow:105};
                List91T105=[[11,10,1],spn91,row91, row81,row82,row83,spn105,row105]; 
	
// ----

 row51 = {firstInRow:51, lastInRow:62, lft:450, tp:20,textRotate:"textRotated90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"notRotatedDiv"};
 spn71={spn:"spn",  spnClass:"spnForW22H37",spnCount:1};
 row71 = {firstInRow:71, lastInRow:75};
                 List51T71=[[1,1,1,1,1,1,1,1,1,1,1,1],row51,spn71,row71];

 row76 = {firstInRow:76, lastInRow:79,lft:474, tp:70,textRotate:"textRotated90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"notRotatedDiv"};
                 List76=[[1,1,1,1,1],row76];
								 
//-------

 row31 = {firstInRow:31, lastInRow:34, lft:820, tp:20,textRotate:"textRotated90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"notRotatedDiv"};
								 List31=[[1,1,1,1],row31];
//--------

 row1 = {firstInRow:1, lastInRow:1, lft:920, tp:20,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"notRotatedDiv"};
 row2 = {firstInRow:2, lastInRow:2};
 row3 = {firstInRow:3, lastInRow:3};
 row4 = {firstInRow:4, lastInRow:4};
 row5 = {firstInRow:5, lastInRow:5};
 row6 = {firstInRow:6, lastInRow:6};
 row7 = {firstInRow:7, lastInRow:7};
 row8 = {firstInRow:8, lastInRow:8};
 row9 = {firstInRow:9, lastInRow:21};
 row10 = {firstInRow:10, lastInRow:22};
 row11 = {firstInRow:11, lastInRow:23};
 row12 = {firstInRow:12, lastInRow:24};
 row13 = {firstInRow:13, lastInRow:25};
 row14 = {firstInRow:14, lastInRow:26};
 row15 = {firstInRow:15, lastInRow:27};
                 List1T15=[[12,1],row1,row2,row3,row4,row5,row6,row7,row8,row9,row10,row11,row12,row13,row14,row15];

//-----------

 row221 = {firstInRow:221, lastInRow:227, lft:550, tp:500,textRotate:"textRotated90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"notRotatedDiv"};
 row241 = {firstInRow:241, lastInRow:247};
 row261 = {firstInRow:261, lastInRow:277};
                 List221T261=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],row221,row241,row261];
								 
 row228 = {firstInRow:228, lastInRow:234, lft:574, tp:500,textRotate:"textRotated90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"notRotatedDiv"};
 row248 = {firstInRow:248, lastInRow:255};
                 List228T248=[[1,1,1,1,1,1,1,1,1],row228,row248];
/*								 								 
 row181 = {firstInRow:181, lastInRow:211, lft:320, tp:490,textRotate:"textNotRotated", cellClass:"W50H20", uLstClass:"UlClass",divClass:"RotatedM45Div"};
 row182 = {firstInRow:182, lastInRow:212};
 spn203={spn:"spn",  spnClass:"spnForW50H20",spnCount:2};
 row203 = {firstInRow:203, lastInRow:213};
 spn204={spn:"spn",  spnClass:"spnForW50H20",spnCount:2};
 row204 = {firstInRow:204, lastInRow:204}
                 List181T204=[[10,10,10,10],row181,row182,spn203,row203,spn204,row204];
	*/
	
	
	
spn181={spn:"spn",  spnClass:"spnForW22H37",spnCount:2, lft:370, tp:450,textRotate:"textRotatedM90",cellClass:"W22H37", uLstClass:"UlClass",divClass:"RotatedM315Div"};
row181={firstInRow:181, lastInRow:182};
spn191={spn:"spn",  spnClass:"spnForW22H37",spnCount:2};
row191={firstInRow:191, lastInRow:192};
row201={firstInRow:201, lastInRow:204};
spn211={spn:"spn",  spnClass:"spnForW22H37",spnCount:1};
row211={firstInRow:211, lastInRow:213};
  List181T211=[[1,1,1,1],spn181,row181,spn191,row191,row201,spn211,row211];

					 								 
 row41 = {firstInRow:41, lastInRow:43, lft:820, tp:140,textRotate:"textRotatedM90", cellClass:"W22H37", uLstClass:"UlClass",divClass:"RotatedM315Div"};
								 List41=[[1,1,1],row41];
 

  ListArray3=[List111T164,List115T117,List111T173,List91T105,List51T71,List76,List31,List1T15,List221T261,List228T248,
	             List181T211,List41];
	
ListArray3dbg=[List111T164,List111T173,List91T105,List76,List31,List1T15,List221T261,List228T248,
	             List41]

// ---------------------------pictures-------embedded from simcha's microsoft One Drive account----------------------------------------------------------------
var  ezrat_nashim_pic='https://2ugfcg-sn3301.files.1drv.com/y4mBeOdkaIFgL-gYvPvzq_FRDw5-LjOlyNGQ0zhuqDW4hNJIoqL0qZoLPQsWvoY7U-QSr3hHhzB9xa99iGE29wKsv6Faao6MeiVf0qoNZZIbdvXcXrPU2ZVaGiJGbmqn1koi7IySvNNw_Ifkno8i2AFn6cUG8dgkeSt-zuwSICNyuTgTGFPzNyaRjWg3VUY4g5lSNSXt87SBC8dUb7nJ_oFGg';
var martef_pic001='https://q0z75q-ch3301.files.1drv.com/y4mrGdKoV4EOFYWhbnuI0cJa_k5-EWJQp4tg2mi5-WlYpsWRArGL9c8H0M2eepMkQLBGQ_SnJFVWP0RoP53x_YL68YS0Akfg8JQZY3WlLUz0bRjeLCeNUNOGhkxbdYog28KC_3uiAf1c3D5i0PAyX_l8MPmQhiF2LOAH8UxJ1wMEw4iOSkIIDYT2N_7tYv2_AP8mvfaszT08eh_s8iWlU5sdQ';									
var martef_pic002='https://q0ajqa-sn3301.files.1drv.com/y4mdcq7N6PKPsZMkb52cbHNjvToniAak0_yloPvh9aLY_hGxrxliC60N243oceCmS1SvTXoaeJplFaWakQNd-1xps5x4fw4qQa-f13gLZRRwjGWEu09DKVDx24Bxhijn9Lus2Og-qXPv-vsc_IJ6sQ1FrOhlxWSr0-zb6f_r4LMDD1GRv3ifZRmwbmIXO7cEsKeH5vDrSw8Mod9UDvIY7-QHg';
var martef_pic003='https://2ui65g-sn3301.files.1drv.com/y4mHGOkjIV32CdAO69JC9LdlZetuEVQop2EqLh2CfJqlc0DuHj-IAEPI5W5SUL2EwDE968cz4GWRAyUPtwhMWmb4wMqqtSlsIzc-lvpaua1Hpm3z4aGonat1QbwURuXo2uf5jFvuJvFBaTYmeL1LHrbGNwkj9t0maQlgClC2GLp3nn9Uw6wb_AkQIsJhQGXiBCsf_wJnqRgFzp7OjVFoRjcJw';
var merkazi1='https://2uieqq-sn3301.files.1drv.com/y4mzcc5ufyZP05s2XkFA9EUjqxN8d8PlfV0xpwG6e4r039oqHZVh19UKB4R4l3Ru8K_cIZZGuyCKCxOBCDtVVXqukxnL1Kc24pd_KqB9Juh_dqvxYfF4Axdijr10NQPEjK84WmzJSTWfSEREotnVkp8hy-vjEdJnk_ncpyWsg5fuvbG37SXDFeuD2fFhMQ9XkZps86obFRUvC87U_-as0uXwA';
var merkazi2='https://2uhvww-sn3301.files.1drv.com/y4mhqSP0p3XvoxW5hLJqpeZS47wJ4APgrqLlzH1g9mBodXKnEI7v8OwY2nMWVBZnLgUHL7uDYKhufNK-j_E-S4ZELQy9DgHMd4lm-MLruINyTvCvoUZjX7CAGp8PXmssZzshYm9Weh6RBvjarWDTYTFntnATj-7ODGcc0VrSoYqyqdEwHSao0Hpl8F3c_8sZiDnmSJidDq_W66LFfvN6OHwug';								


//---martef

pic1Strct={sorc:martef_pic001,wdth:250,hgt:900,lft:10,tp:30,rtt:0,picId:'pic001'}; 
pic2Strct={sorc:martef_pic002,wdth:170,hgt:170,lft:800,tp:300,rtt:45,picId:'pic002'}; 
pic3Strct={sorc:martef_pic003,wdth:60,hgt:100,lft:1000,tp:140,rtt:45,picId:'pic003'}; 
picsForMartef=[pic1Strct,pic2Strct,pic3Strct];



// structure= drawing div id,  top,   class id
martefDrawing=[ 
                ["drawing_1",170,"drawing_1"],
								["drawing_2",192,"drawing_2"],
								["knisa",55,"knisa"],
								["mafrid1",215,"mafrid1"],
								["mafrid2",728,"mafrid2"],
								["mafrid3",244,"mafrid3"]    ];
	
							

//----rashi
m1picStrct={sorc:merkazi1,wdth:170,hgt:170,lft:540,tp:280,rtt:45,picId:'m1pic'}; 
m2picStrct={sorc:merkazi2,wdth:80,hgt:135,lft:770,tp:100,rtt:45,picId:'m2pic'}; 
picsforRashi=[m1picStrct,m2picStrct];

rashiDrawing_2016=  [
        ["drawing_3",35,"drawing_3"],
        ["mafrid4",585,"mafrid4_2016"],
	      ["mafrid5",180,"mafrid5_2016"],
			  ["knisa1",175,"knisa1"], 
			  ["arrow1",160,"arrow1"],
			  ["knisa2",660,"knisa2"], 
			  ["arrow2",560,"arrow2"]     ];
				
rashiDrawing=  [
       ["drawing_3",35,"drawing_3"],
        ["mafrid4",585,"mafrid4"],
	      ["mafrid5",180,"mafrid5"],
			  ["knisa1",175,"knisa1"], 
			  ["arrow1",160,"arrow1"],
			  ["knisa2",660,"knisa2"], 
			  ["arrow2",560,"arrow2"]     ];
				
				 
//------nashim
nashimpicStrct={sorc:ezrat_nashim_pic,wdth:400,hgt:260,lft:460,tp:175,rtt:0,picId:'nashimpic'}; 
picsforNashim=[nashimpicStrct];

nashimDrawing=[
          ["drawing_4",30,"drawing_4"],
          ["knisa3",140,"knisa3"],
		      ["arrow3",140,"arrow3"], 
          ["drawing_5",279,"drawing_5"],
		      ["drawing_6",456,"drawing_6"],    
  	      ["knisa4",400,"knisa4"], 
		      ["arrow4",400,"arrow4"]      ];
					
					
// ------------------root structures					

										 
	lastyearStructure  ={martef:{ ListArray:ListArray1,pics:picsForMartef,drawings:martefDrawing},
                     rashi:{ListArray:ListArray2,pics:picsforRashi,drawings:rashiDrawing},
                     nashim:{ListArray:ListArray3,pics:picsforNashim,drawings:nashimDrawing} }; 
										 
										 
	Y2016Structure  ={martef:{ ListArray:ListArray1_2016,pics:picsForMartef,drawings:martefDrawing},
                     rashi:{ListArray:ListArray2_2016,pics:picsforRashi,drawings:rashiDrawing_2016},
                     nashim:{ListArray:ListArray3,pics:picsforNashim,drawings:nashimDrawing} }; 									 
										 
yearlyDataStructure=[[2017,lastyearStructure],[2016,Y2016Structure]];

var LastYear;
var nextYear;


// ----------------------------------------------------------------------------------------	
                     

var	positionInMsg={email:0,	addr:1,phone:2,	gvarimRoshHashana:3,gvarimKipur:4,nashimRoshHashana:5,nashimKipur:6,
		                minyanMuadafNashim:7, esberNashim:8,minyanMuadafGvarim:9,esberGvarim:10,moreComments:11,
									 requestedSeats:12,requestDate:13,assignedSeatsRosh:14,assignedSeatsKipur:15,tashlum:16,tashlumPaid:17,
									 stsfctnInFlr2YRSAgoYrWmn:18,stsfctnInFlr2YRSAgoYrMen:19,TwoYRSAgoSeat:20,stsfctnInFlr3YRSAgoYrWmn:21,
                   stsfctnInFlr3YRSAgoYrMen:22,ThreeYRSAgoSeat:23,memberShipStatus:24,stsfctnInFlrLastYrWmn:25,stsfctnInFlrLastYrMen:26,
									 LastYrSeat:27,issueInFloorWmn:28,  issueinFloorMen:29,  issueBetweenFloors:30,nashimMuadaf:31,gvarimMuadaf:32
									 };
											  


originalListOfAssigned= [];
	 listOfAssignedSeats =[];		
	 
var seatOriginalInfo= new Array;	 						 
									 
var toPrintCt;
var password;


var moed=0;
var sidurUlam=0;
var sinunShlavB=true;
var sinunNotPaid=true;

var roshStr;
var kipurStr;

moedCodes=['','rosh$','kipur$','all$'];

var namesToAssign=new Array; 
var requestorsNameList=new Array;  
var listToUse=new Array; 
  
var currentNameIdx;
var keyupListenerOn=false;
 
var registrationClosed= false;

var countAssignedMen;
var countAssignedWomen;	 

var displayYear;

var originalInfo={ocuupacColor:'black',occupancBGColor:'White',baseNameToShowList:'',assgnedName:'$'};

basePayment=1200;
paymentPerSeat=50;

var firstPartOfURL ='http://server-seatselection.7e14.starter-us-west-2.openshiftapps.com:80';
var isWoman = new Array;

var blinkElmntList=[];
var lastBlink=true;

var listOfNames = new Array;
var contentIdx=0;
changeContent=0;

var fullNames=[];
var namesOptionDisplayed=false;

var nameToJumpBackTo='';

var printingNow=false;
var printingMartef=false;
var printingRashi=false;
var printingNashim=false;

var lastNameChecked='';

var addinFirstName;

var lastName='';

var yearToDisplay='';

var fmNmOnChangeDIsabled=false;

waitForKeyUp=false;

var autoComletionOn=true;

var JumpToCandidate='';
var lastKeyPressed='';
var functionKeyList=[
                     67,   // 'c' or 'ב'     toggle auto completion
										 74,    // 'j' or 'ח'    jump to assigned
										 76     // 'l' or 'ך,    jump to assign and refocus
										 ];
var reFocus;										 
var focusElmnt;			


var shurot=[];		
var cellAttrbts=[[]];		

var BG_indx;			 

minyanMevukashW= [ 
	         '  אנו מבקשים להושיב את הנשים באזור השמאלי בבית המדרש במרתף סמוך לאזור המיועד לעגלות תינוקות. תאריך הלידה של התינוק:',
										'לא משנה',
										'מעדיפים להיות במנין המרכזי אבל מבינים שאחת למספר שנים נתפלל בבית המדרש במרתף',
										'  הסיבה שבגללה אנו מבקשים לשבת השנה במנין המרכזי היא',
										'באותו מנין עם משפחות (כפוף לסבב)',
										'  מבקשים לפצל את המשפחה',' ',' ',' ','לא סומן מנין מבוקש'];

minyanMevukashM= [ 'מעדיפים את בית המדרש במרתף',
	         					'לא משנה',
										'מעדיפים להיות במנין המרכזי אבל מבינים שאחת למספר שנים נתפלל בבית המדרש במרתף',
										'  הסיבה שבגללה אנו מבקשים לשבת השנה במנין המרכזי היא',
										'באותו מנין עם משפחות (כפוף לסבב)',
										'  מבקשים לפצל את המשפחה',' ',' ',' ','לא סומן מנין מבוקש'];
	
	
var stsfctionVlusFromServer= new Array;
var newStsfctionVlus= new Array;

var prsnlProblemsVlusFromServer= new Array;
var newprsnlProblemsVlus= new Array;


// -------------------------------------------------------------------   
  

function initPage(){
   
	      var d = new Date();
	     nextYear=d.getFullYear();
			 currentMonth=Number(d.getMonth()); 
			 if (currentMonth > 9 )nextYear=Number(nextYear)+1;
			 LastYear=(nextYear-1).toString();
			 nextYear=nextYear.toString();

			hideFieldSets();
			
			document.getElementById("firstX").onmouseover=disableFmNmOnChange;;	
			document.getElementById("firstX").onmouseout= enableFmNmOnChange;
			
			document.getElementById("secondX").onmouseover=disableFmNmOnChange;	
			document.getElementById("secondX").onmouseout= enableFmNmOnChange;
			
			window.onkeydown = keydown;
			window.onkeyup = keyup;

      initListOfYears();
			
	getShulConfig();

}

// -------------------------------------------------------------------   
function keydown(evnt){
var idx;
var keyPressed;
var bgColor;

  reFocus=false;
	
	keyPressed=	evnt.keyCode;		//console.log('keyPressed='+keyPressed);
	idx=	functionKeyList.indexOf(	keyPressed );				 
  if(idx ==-1)return; 
  if(waitForKeyUp)return;
  
  
	                 
	if ( ! evnt.altKey )return;  
	waitForKeyUp=true;
	lastKeyPressed=keyPressed;
	

	
	switch 	(idx) {
		      case 0:    //   'c' == toggle auto completion
				
					autoComletionOn= ! autoComletionOn;   
					if ( autoComletionOn){bgColor='white';} else bgColor='Lavender';  
					document.getElementById("fmName").style.backgroundColor=bgColor;
					document.getElementById("fmNameFloat").style.backgroundColor=bgColor;
					
					       break;
					
					
					case 1:    //			'j' == jump to assigned 		
	            window.scrollTo(0, 0);
						  focusElmnt=document.getElementById("fmName"); // over ride focus point to scroll up 
							 
					case 2:   // 'f' jump and refocus
					   if( ! JumpToCandidate)return;  // no candidate
						 saveSeatAssignment(false);  // save current  seat assignment; do not show positive confirmation
						 if ( ! nameToJumpBackTo )nameToJumpBackTo=document.getElementById("fmName").value;
						 document.getElementById("fmName").value=JumpToCandidate;
						
						
						 
						 activateOnChange();
						  activateRefocus();
						   break;
							 
							 }  //end switch
	}
	
	function keyup(evnt){

	if(evnt.keyCode ==lastKeyPressed)waitForKeyUp=false;}


// -------------------------------------------------------------------   

function disableFmNmOnChange(){ fmNmOnChangeDIsabled=true;}

// ------------------------------------------------------------------- 
function enableFmNmOnChange(){ fmNmOnChangeDIsabled=false;}

// ------------------------------------------------------------------- 

 function initListOfYears(){
   
			
			
          // prepare year to review selection
	    url=encodeURI(firstPartOfURL+"/getYearList");
      xhttp.open("GET", url, false);
      xhttp.send();
	    rspnsString = xhttp.responseText.split('$');  
			
			 
					rspnsString.sort(); 
                    
				  for (i=0; i<	rspnsString.length; i++)document.myform.dsplayYear.options[i+1]=new Option(rspnsString[i]);
			
 
 }
// -------------------------------------------------------------------  
  

function simpleHideFieldSets(){

document.getElementById("hall1").style.display='none';
	 document.getElementById("hall2").style.display='none';
	 document.getElementById("hall3").style.display='none';
   document.getElementById("getstfction").style.display='none';
   document.getElementById("addNewMember").style.display='none';
   document.getElementById("floatingDiv").style.display='none'; 
	 document.getElementById("shortFloatingDiv").style.display='none';
	 document.getElementById("copyAssignment").style.display='none';
	 document.getElementById("prsnlProblems").style.display='none';
	 document.getElementById("reportAssgnmnts").style.display='none';

}
// -------------------------------------------------------------------  

function getSeatsStructureForYear(yr){
  if ( !yr )return yearlyDataStructure[0][1];
	if (yearlyDataStructure.length==1) return yearlyDataStructure[0][1];
	
	//yearToDsply=0;
	//yearToDsplyIdx=0;
		rqstYr=Number(yr);
		
	for (ii=0;ii<yearlyDataStructure.length;ii++){
	 //  if ( (yearlyDataStructure[ii][0] <= rqstYr)  && (yearlyDataStructure[ii][0] > yearToDsply)  )
	 if (yearlyDataStructure[ii][0] <= rqstYr)return yearlyDataStructure[ii][1];
		    //   {yearToDsply=yearlyDataStructure[ii][0];  yearToDsplyIdx=ii;};
	 }
	// return yearlyDataStructure[yearToDsplyIdx][1];
}	


// -------------------------------------------------------------------

function hideFieldSets(){

   document.getElementById("hall1").style.display='none';
	 document.getElementById("hall2").style.display='none';
	 document.getElementById("hall3").style.display='none';
	 document.getElementById("ctrlFieldset").style.display='none';
	 document.getElementById("floatingDiv").style.display='none'; 
	 document.getElementById("shortFloatingDiv").style.display='none';
	 document.getElementById("mainFieldset").style.display='none';
	 document.getElementById("getstfction").style.display='none';
	 document.getElementById("addNewMember").style.display='none';
	 document.getElementById("copyAssignment").style.display='none';
	 document.getElementById("prsnlProblems").style.display='none';
	  document.getElementById("reportAssgnmnts").style.display='none';



	 
			displayRegistrationClosedStatus();	
  
			isWoman=rspnsString[2].split('+');  
			
			  originalInfo.occupancBGColor='White';  
				originalInfo.ocuupacColor='black';
				originalInfo.baseNameToShowList='';
				originalInfo.assgnedName='$'; 	
				
				
											
			for (i=0;i<2000;i++) collectOriginalInfo(i);	
			
	var floatingElmntHight=80;
	var floatingElmntWidth=1200;
	
	
	var w = window.innerWidth;
  var h = window.innerHeight;		
	floatingElmntTop=	h-floatingElmntHight-10;	
	
	floatingElmnt=document.getElementById("floatingDiv"); 
	floatingElmnt.style.height=floatingElmntHight;
	floatingElmnt.style.width=floatingElmntWidth;
	floatingElmnt.style.top=floatingElmntTop.toString()+'px';  
	floatingElmnt.style.left=	((w-floatingElmntWidth)/2 ).toString()+'px';	
	
	copyAssnmntDiv=document.getElementById("copyAssignment");
	copyAssnmntDiv.style.top=(floatingElmntTop-120).toString()+'px';
	copyAssnmntDiv.style.left=(w-600).toString()+'px'; 
	
	var shortFloatingElmntWidth=700;	
	shortFloatingElmnt=document.getElementById("shortFloatingDiv"); 
	shortFloatingElmnt.style.height=floatingElmntHight;
	shortFloatingElmnt.style.width=shortFloatingElmntWidth;
	shortFloatingElmnt.style.top=(h-floatingElmntHight-10).toString()+'px';
	shortFloatingElmnt.style.left=	((w-shortFloatingElmntWidth)/2 ).toString()+'px';		
	
	var seatcountersElmntHight=140;
	var seatcountersElmntWidth=1000;	
	seatcountersElmnt=document.getElementById("seatcounters"); 
	seatcountersElmnt.style.height=seatcountersElmntHight;
	seatcountersElmnt.style.width=seatcountersElmntWidth;
	seatcountersElmnt.style.top=(h/2-seatcountersElmntHight-40).toString()+'px';
	seatcountersElmnt.style.left=	((w-seatcountersElmntWidth-40)/2 ).toString()+'px';		
	
	
	document.getElementById('pasw').focus();

	
	setTimeout(blinkRequested, 1000);		
							
	}
  
// --------------------------------------------------------------------------
function displayRegistrationClosedStatus(){


    url=encodeURI(firstPartOfURL+"/isRegistrationClosed");
   xhttp.open("GET", url, false);
   xhttp.send();
	 tmp1= document.getElementById("openclose");   
	 tmp2= document.getElementById("openclose_2");   
	 rspnsString = xhttp.responseText.split('$');  
	 if ( rspnsString[0] == '+++'){ 
	     registrationClosed = true;
				 
				 
				 
 var d = new Date(rspnsString[1]);
  var offset = (new Date().getTimezoneOffset() / 60) * -1;
  var n = new Date(d.getTime() + offset); 		

		   txt1='בטל סגירת הרשמה';
			 txt2='נסגרה ב: ';
			 dParts=n.toString().split(' ');
			 
			 MonthNum=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'].indexOf( dParts[1]);
						 dParts[1]=['01','02','03','04','05','06','07','08','09','10','11','12'][MonthNum];
			 
			 dclose=dParts[2]+' '+dParts[1]+' '+dParts[3]+' '+dParts[4];   
			 
			 tmp1.innerHTML=	txt1;	
			 tmp2.innerHTML=	dclose;	
										}
			
				    					
				else{ 
				         registrationClosed = false;  
				
			              tmp1.innerHTML=	'סגור הרשמה';	
										tmp2.innerHTML=	' ';	
										}
			

}
 // --------------------------------------------------------------------------

function blinkRequested(){
   lastBlink= ! lastBlink;
	 contentIdx++;  if(contentIdx==4){ changeContent=1- changeContent;  contentIdx=0} ; 
	 if(lastBlink){borderStyle='1px solid Red';} else borderStyle='1px solid White';
	 for (jjj=0; jjj<blinkElmntList.length; jjj++){
	      blinkParts=blinkElmntList[jjj].split('_');
				blinkElmntSeatId='c'+blinkParts[0]+'_p'; 
				blinkElmnt=document.getElementById(blinkElmntSeatId); 
				spanBlinkElement=blinkElmnt.children[0];
				if (blinkParts.length==2){  // first time here
				          blinkParts[2]=blinkElmnt.style.backgroundColor;
									blinkParts[3]=spanBlinkElement.innerHTML;
									blinkElmntList[jjj]=blinkParts.join('_');
					}	
				blinkElmnt.style.border=borderStyle;				
	     	crrntBGColor=blinkElmnt.style.backgroundColor;
				if (crrntBGColor != 'black'){
	       
				   blinkPriort=Number(blinkParts[1]);
				  if (changeContent){
				            spanBlinkElement.innerHTML=blinkPriort;
										blinkElmnt.style.backgroundColor=['white','Red','coral','pink'][blinkPriort];
										  } else {
											    spanBlinkElement.innerHTML=blinkParts[3];
										      blinkElmnt.style.backgroundColor=blinkParts[2]; 
	                   }
			}							 
	  }                 
			setTimeout(blinkRequested, 500);		
 
  }
	
// --------------------------------------------------------------------------

function deleteOldChildren(id){
   while (true) {
   elmnt=document.getElementById(id);
   if( !elmnt)break;
	 elmnt.parentNode.removeChild(elmnt);
	
	}	
	}	
	
// ---------------------------------------------------------------------------------	
	
	function getPosition(element) {
    var xPosition = 0;
    var yPosition = 0;
  var kkk=0;
    while(element) {toPrint[toPrintCt]={k:kkk, offsttop:element.offsetTop, scrltp:element.scrollTop,cknttop:element.clientTop,nxtelmnt:element.offsetParent};
		                                      kkk++; toPrintCt++;
        xPosition += (element.offsetLeft - element.scrollLeft + element.clientLeft);
     //   yPosition += (element.offsetTop - element.scrollTop + element.clientTop);
		    yPosition += (element.offsetTop  + element.clientTop);
				
        element = element.offsetParent;  
			//	alert( 'offsettop='+element.offsetTop+' scrolltop='+element.scrollTop+' clienttop='+element.clientTop+' elmnt='+element);
    }
    return { x: xPosition, y: yPosition };
}

// ---------------------------------------------------------------------------------	

function gensteps(){
 var  Asteps1=document.getElementById("hall1");
  LegendTextElement=document.getElementById("Hall1FrameTop"); 
  tmpStartingTop=getPosition(LegendTextElement);
	tmpStartingTop=tmpStartingTop.y;
	deleteOldChildren("steps");
  for(j=0;j<2;j++){
	tempStartingLeft=295;
     for (i=0; i<100; i=i+10){
		   aStep= document.createElement("div");
			 aStep.setAttribute("id","steps");
			 Asteps1.appendChild(aStep);
			 Asteps1.lastChild.style.top=(tmpStartingTop+35).toString()+"px";
			 Asteps1.lastChild.style.left= (tempStartingLeft+100).toString()+"px";
			 Asteps1.lastChild.setAttribute("class", "steps1");
			 
			 tempStartingLeft+=15; 
			   }
		tmpStartingTop+=50;
		 };
			 
		} 

	//--------------------------------------------------------------------------------
	
function genPicture(baseElement,sorc,wdth,hgt,lft,tp,rtt,LegendTextElement,picId){
 deleteOldChildren(picId);

  startingTop=getPosition(LegendTextElement);
	startingTop=startingTop.y;
	startingTop1=startingTop+ tp;
	 var aPic= document.createElement("img");
	     //      fullSorc="https://googledrive.com/host/0B3RY8t3CW8yEMzd1RlRsMmNJZnc/"+sorc;
						 aPic.src=sorc; 
						 aPic.style.width=wdth+"px";
						 aPic.style.height=hgt+"px";
				 		 aPic.style.left = lft+ "px";
						 aPic.style.top = startingTop1 + "px";  
						 aPic.setAttribute("id",picId); 
				  	baseElement.appendChild(aPic);
						
					if(rtt!=0){
						  rotateIt= 'rotate('+ rtt.toString()+'deg)';
						   baseElement.lastChild.style.webkitTransform = rotateIt;
							 baseElement.lastChild.style.transform = rotateIt;
                       };  
						  };
							
//--------------------------------------------------------------------------------

function adjustElementTop(LTextElement,element,tp,styl){
      
           startingTopA=getPosition(LTextElement);
					 startingTopA=startingTopA.y; 
					 tmp1= document.getElementById(element);
					 tmp1.setAttribute("class", styl);
					 tmp1.style.top=(startingTopA+tp)+"px";
	         tmp1.style.visibility='visible';
              };
					 
//-------------------------------------------------------------------------------- 

 function generate_list(LLst,baseElement,startingTop) {
 
 
 rotations=['RotatedM45Div','RotatedM315Div','RotatedM135Div','RotatedM90DivSpecial'];
  var divE     = document.createElement("div");
	divE.setAttribute("id","kk");
	generateUl=true;
  // creating all cells
	  for (rownum=1; rownum<LLst.length; rownum++) {
    // creates a list 
		 if (generateUl ) { var ulst= document.createElement("ul");
				 k=0;  
				    }
		if(notASpan(LLst[rownum]) )   { 
    strt=LLst[rownum].firstInRow; 
		endd=LLst[rownum].lastInRow;
		 j=strt;
		  while ( j<=endd){
      var cell = document.createElement("li");
			cell.className=LLst[1].cellClass;
			var textSpan = document.createElement("span");
			textSpan.className=LLst[1].textRotate;
			//textSpan.style.opacity=1;
		  textSpan.innerHTML='&nbsp';
			cond=(! mapForMember)&&(! printingNow); 
	    if ( cond)	textSpan.innerHTML=(j).toString();  			cell.appendChild(textSpan);  
     
			inh=j.toString(); 
      pid='c'+inh+'_p'; 
			cell.onclick=clk; 
      cell.setAttribute("id", pid);
 //     cell.className=LLst[1].cellClass;
			// use quotes as indicator for div is rotated
			dvCls=LLst[1].divClass;
			divType=rotations.indexOf(dvCls)+1;
			switch (divType){
			  case 0:  cell.style.quotes="'$' '$'";  break;
				case 1:  cell.style.quotes="'<' '$'";  break;
				case 2:  cell.style.quotes="'#' '$'";  break;
				case 3:  cell.style.quotes="'>' '$'";  break;
				case 4:  cell.style.quotes="'_' '$'";  break;
				}
			cell.onmouseover=showNames;	
			cell.onmouseout= hideNames;
		
			ulst.appendChild(cell); 
    	j=j+LLst[0][k];
			k++;
			if (k>100)return;
			generateUl=true;
    }}
		else {
		  for(spncnt=0; spncnt < LLst[rownum].spnCount; spncnt++){
		  spn=document.createElement("span");
      spn.className=LLst[rownum].spnClass; 
			
   		ulst.appendChild(spn);
			k++;   if (k>100)return;
			    }
			generateUl=false;;
         };
	 ulst.className+= LLst[1].uLstClass;
	 divE.appendChild(ulst);
	}
	
   divE.className=LLst[1].divClass;
	baseElement.appendChild(divE);
	llfft=(LLst[1].lft).toString()+"px"; 
	baseElement.lastChild.style.left=llfft;
	t1=(LLst[1].tp+startingTop).toString()+"px"; 
	 baseElement.lastChild.style.top=t1;   
  
}

function notASpan(list) { 
   if (list.spn=="spn")
            return false;
     else 
            return true;
}
//-------------------------------------------------------------------------- 
	

function clk(e){



     if ( ! sidurUlam) return;
		 
		 
	
    var div_id = this.id;
		elmnt=document.getElementById(div_id);
		span_element=elmnt.children[0];
		seatNumber=div_id.split('_')[0].substr(1);
		
		 //  if assigned to somebode else - do nothing
		//originalInfo=Object.assign({}, seatOriginalInfo[seatNumber])
		getOriginalInfo(seatNumber);
		assigns=originalInfo.assgnedName.split('$'); 
		
		 if(assigns[0])	{if(((moed==1)||(moed==3))&&(assigns[0]!=document.myform.familyname.value))return;}
		if(assigns[1])	{if(((moed==2)||(moed==3))&&(assigns[1]!=document.myform.familyname.value))return;}
		
		
		if( listOfAssignedSeats.indexOf(seatNumber) == -1){ 
	
		  // new assignment
 
		      span_element.innerHTML=document.myform.familyname.value;
			   listOfAssignedSeats.push(seatNumber);
				 elmnt.style.backgroundColor='black';
				 elmnt.style.color='yellow';
				 updateCountAssigned(seatNumber,1);
				 
			}
			else { // clear assignment
			nameInSpan=span_element.innerHTML;
			if (nameInSpan != document.myform.familyname.value ) return; // can un-assign only current member
			//originalInfo= Object.assign({}, seatOriginalInfo[seatNumber]);
			getOriginalInfo(seatNumber);
			  elmnt.style.backgroundColor=originalInfo.occupancBGColor;
				elmnt.style.color= originalInfo.ocuupacColor;  
	
					 
		 // 	nameT0Show=seatNumber.toString();
				assndLst=originalInfo.assgnedName.split('$');
				assgndRosh=delLeadingBlnks(assndLst[0]);
				assgndKipur=delLeadingBlnks(assndLst[1]);
				if( (moed==1) || (moed==3) )assgndRosh='';
				if( (moed==2) || (moed==3) )assgndKipur='';
				
				originalInfo.assgnedName=assgndRosh+'$'+assgndKipur;
				 collectOriginalInfo(seatNumber);
						  	
				
							
					
				span_element.innerHTML=seatNumber.toString();			 
		//		if( nameT0Show == seatNumber.toString()){
				 dlta=-1;
				updateCountAssigned(seatNumber,dlta);		   			 
		    indxOfElmnt=listOfAssignedSeats.indexOf(seatNumber); 
				listOfAssignedSeats.splice(indxOfElmnt,1);  //remove it from list
		//		}
		  }
		}
//--------------------------------------------------------------------------dbg

function showNames(e){

/*  debug
document.getElementById('dbg').style.display='block';
cursorX = e.pageX;
cursorY = e.pageY;
document.getElementById('dbgx').innerHTML=cursorX.toString();
document.getElementById('dbgy').innerHTML=cursorY.toString();

return;
*/
if( ! moed) return;
var cell_id = this.id; 
cell1=document.getElementById(cell_id);  
tempStr=cell1.getAttribute('value'); 
tempStr=delLeadingBlnks (tempStr); 
if(tempStr=='$/')return;

   var winW = window.innerWidth;

   strParts=tempStr.split('/'); 
	 if( delLeadingBlnks(strParts[1])!='$'){
     tempStrNames=strParts[1].split('$');
	   strr=tempStrNames.join(', ')
		 }    		 else strr=''; 
	 tempAssigned=strParts[0].split('$');  
   
   divWidth1=  (15+strr.length)*7;  
	 divWidth2=0;       
   positn=getPosition(cell1);
   topp=positn.y; 
   //leftt=positn.x+60;  if (leftt-60 > winW/2) leftt=leftt-divWidth-80; 
   namesDiv=document.getElementById("showNames");
   namesDiv.style.top=topp;
	 namesDiv.style.zIndex = "12";
   
 // choose a possible 'jump-to' candidate
 JumpToCandidate='';
 if(  tempAssigned[0] == tempAssigned[1] )JumpToCandidate=tempAssigned[0];
 if( ! tempAssigned[0] )JumpToCandidate=tempAssigned[1];
 if( ! tempAssigned[1] )JumpToCandidate=tempAssigned[0];
 
 focusElmnt=document.getElementById(cell_id); 
 
 
	 hgt=10;
	
	document.getElementById('muktzaTag1').style.display='none';
	document.getElementById('muktzaTag2').style.display='inline';
	
	 document.getElementById("misparMakom").innerHTML=cell_id.split('_')[0].substr(1);
	 if(tempAssigned[0]){
	    document.getElementById("mukzerosh").style.display='inline';
			document.getElementById("hakzaaRosh").innerHTML=tempAssigned[0];
			 hgt=hgt+30;
			 divWidth2=350;
			}  	else {
			     document.getElementById("mukzerosh").style.display='none';
					 document.getElementById('muktzaTag1').style.display='inline-block';
	         document.getElementById('muktzaTag2').style.display='none';
					 }
			
		if(tempAssigned[1]){
	    document.getElementById("mukzekipur").style.display='inline-block';
			document.getElementById("hakzaakipur").innerHTML=tempAssigned[1];
		 hgt=hgt+40;
			divWidth2=350;
			}  	else document.getElementById("mukzekipur").style.display='none';	
			    
	 if ( delLeadingBlnks(strr)){     
         document.getElementById("bikshu").innerHTML=strr;
	       document.getElementById("isBikshu").style.display='inline-block';
	 			 hgt=hgt+30;
         
	 }  else document.getElementById("isBikshu").style.display='none';
	 
	  namesDiv.style.height=hgt;
	 divWidth=Math.max(divWidth1,divWidth2);
	 namesDiv.style.width=divWidth;
	  leftt=positn.x+120;  if (leftt-120 > winW/2) leftt=leftt-divWidth-180; 
		namesDiv.style.left=leftt;
   namesDiv.style.display='block';
                 
}


//---------------------------------------------------------------------------
 function hideNames(){
 namesDiv=document.getElementById("showNames");
 namesDiv.style.display='none';
 JumpToCandidate='';
 focusElmnt='';
 
 } 

  
	
// ---------------------------------------------------------------------------------			
	function generateMartef(LegendTextElement,MartefElement){
	
  startingTop=getPosition(LegendTextElement);
	startingTop=startingTop.y; // alert("startingtop martef="+startingTop);
	
 deleteOldChildren('kk'); // delete previous tables.
 
	   yearStructure=getSeatsStructureForYear(yearToDisplay);
		 martefStructure=yearStructure.martef;
		 ListArray=martefStructure.ListArray;
    for(ull=0; ull<ListArray.length; ull++)  {
		 generate_list(ListArray[ull],MartefElement,startingTop);}  
				
	 gensteps();
	 pics=martefStructure.pics;
	 for (picnum=0; picnum<pics.length;picnum++) {
	      genPicture(MartefElement,pics[picnum].sorc,pics[picnum].wdth,pics[picnum].hgt,pics[picnum].lft,
				                           pics[picnum].tp, pics[picnum].rtt,LegendTextElement,pics[picnum].picId); }


	
   drwings=martefStructure.drawings;

	for (drw=0;drw<drwings.length;drw++)
	           adjustElementTop(LegendTextElement,drwings[drw][0],drwings[drw][1],drwings[drw][2]); 	
}
	
// ---------------------------------------------------------------------------------	
   function generateRashi(LegendTextElement,merkaziElement){

   startingTop=getPosition(LegendTextElement);
	 startingTop=startingTop.y+20;  
	 
     yearStructure=getSeatsStructureForYear(yearToDisplay);
		 rashiStructure=yearStructure.rashi;
		 ListArray=rashiStructure.ListArray; 
	   for(ull=0; ull<ListArray.length; ull++)  {
		  generate_list(ListArray[ull],merkaziElement,startingTop);} 
	
	 pics=rashiStructure.pics;
	 for (picnum=0; picnum<pics.length;picnum++) { 
	      genPicture(merkaziElement,pics[picnum].sorc,pics[picnum].wdth,pics[picnum].hgt,pics[picnum].lft,
				                           pics[picnum].tp, pics[picnum].rtt,LegendTextElement,pics[picnum].picId); }
						 
		 drwings=rashiStructure.drawings;

	for (drw=0;drw<drwings.length;drw++)
	           adjustElementTop(LegendTextElement,drwings[drw][0],drwings[drw][1],drwings[drw][2]); 						 	
		
		
}

// ------------------------------------------------------------------------------------- 
  
	function generateNashim(LegendTextElement,nashimElement){
   
	 startingTop=getPosition(LegendTextElement);
	 startingTop=startingTop.y+10; 
   
	 yearStructure=getSeatsStructureForYear(yearToDisplay);
		 nashimStructure=yearStructure.nashim;
		 ListArray=nashimStructure.ListArray;
	 for(tb=0; tb<ListArray.length; tb++)  { 
		    generate_list(ListArray[tb],nashimElement,startingTop);}
				
		
	drwings=nashimStructure.drawings;

	for (drw=0;drw<drwings.length;drw++)
	           adjustElementTop(LegendTextElement,drwings[drw][0],drwings[drw][1],drwings[drw][2]); 						 	
		
	
	
	pics=nashimStructure.pics;
	 for (picnum=0; picnum<pics.length;picnum++) { 
	      genPicture(nashimElement,pics[picnum].sorc,pics[picnum].wdth,pics[picnum].hgt,pics[picnum].lft,
				                           pics[picnum].tp, pics[picnum].rtt,LegendTextElement,pics[picnum].picId); }
						 	 


  }

 
 
//------------------------------------------------------------------------------	
	
function GenerateTables(){


deleteOldChildren('kk'); // delete previous tables.

   if ( ( ! printingNow) || printingMartef) document.getElementById("hall1").style.display='block';
	 if ( ( ! printingNow) || printingRashi) document.getElementById("hall2").style.display='block';
	 if ( ( ! printingNow) || printingNashim) document.getElementById("hall3").style.display='block';
	
 //    ---------Martef---------------------------------------------------------------		
	

LegendTextElement=document.getElementById("Hall1FrameTop"); 
MartefElement=document.getElementById("hall1"); 

generateMartef(LegendTextElement,MartefElement);

//------------------OOLAM RASHI--------------------------------------------------------
      LegendTextElement=document.getElementById("Hall2FrameTop"); 
    
     merkaziElement=document.getElementById("hall2"); 
		 generateRashi (LegendTextElement,merkaziElement);
	  
			 
//--------------------------EZRAT NASHIM----------------------------------------
     LegendTextElement=document.getElementById("Hall3FrameTop"); 
     nashimElement=document.getElementById("hall3");
		 generateNashim (LegendTextElement,nashimElement);
		 	 
//--------------------------------------------------------------------------------			
	
	
	if (document.myform.seatsString.value)reconstructSeats(document.myform.seatsString.value);
		document.getElementById('fmName').focus();
		
		
		
		
		
	}   
//-----------------------------------------------------------------------------------------

//------------------------------------------------------------------------------------

		
	
// -----------------------------------------------------------------------------------------	
    function clearPrevsVlus(){
		
//		simpleHideFieldSets();
		
	   document.getElementById('reqemail').innerHTML='';  
		 document.getElementById('reqaddress').innerHTML='';
		 document.getElementById('reqmobile').innerHTML='';
     document.getElementById('menRosh').innerHTML='';
		 document.getElementById('menkipur').innerHTML='';
		 document.getElementById('womenRosh').innerHTML='';
		 document.getElementById('womenkipur').innerHTML='';
		 document.getElementById('rCmnts').innerHTML='';
		 document.getElementById('minyanW').innerHTML=''; 
		 document.getElementById('minyanM').innerHTML=''; 
		 document.getElementById('letashlum').innerHTML=''; 
		 
		 
		 
			document.getElementById("adainloukzu").style.display='none';
			document.getElementById("yotermidai").style.display='none';
			document.getElementById("hakzaamleaa").style.display='none';
			document.getElementById("holidayMixup").style.display='none';																		
					
		
		if(document.myform.seatsString.value){
		 var stArray = new Array;
	   stArray = document.myform.seatsString.value.split('+');   
	   for(i=0; i<stArray.length; i++){
		  var vlu=stArray[i].split('_');
      ckid='c'+vlu[0];  
			checkbox_element = document.getElementById(ckid); 
      cellId='c'+vlu[0]+'_p'; 
			cell_element=document.getElementById(cellId); 
	
		  cell_element.style.background="white";	
		
			}
			document.myform.seatsString.value='';
    }

}
// -------------------------------------------------------------------------------------
  
		function yesOrNo(dialog)		{
        var winW = window.innerWidth;  
        var winH = window.innerHeight; 
        var dialogoverlay = document.getElementById('dialogoverlay');
        var dialogbox = document.getElementById('dialogbox');
        dialogoverlay.style.display = "block";
        dialogoverlay.style.height = winH+"px";
        dialogbox.style.left = (winW/2) - (550 * .5)+"px";
        dialogbox.style.top = "100px";
        dialogbox.style.display = "block";
        document.getElementById('dialogboxbody').innerHTML = dialog;
        document.getElementById('dialogboxfoot').innerHTML = '<button onclick="yesOrNo_yes()">&nbsp &nbsp &nbsp &nbsp כן</button>';
		    document.getElementById('dialogboxfootLeft').innerHTML = '<button onclick="yesOrNo_no()">לא &nbsp &nbsp &nbsp &nbsp &nbsp</button>';
    }
	 function yesOrNo_yes(func){
	
		document.getElementById('dialogbox').style.display = "none";
		document.getElementById('dialogoverlay').style.display = "none";
	   funcYes(); 
		}
		function yesOrNo_no(func){
		
		document.getElementById('dialogbox').style.display = "none";
		document.getElementById('dialogoverlay').style.display = "none";
    funcNo(); 
	}


// -------------------------------------------------------------------------------------


		function Alert(dialog){
        var winW = window.innerWidth;  
        var winH = window.innerHeight; 
        var dialogoverlay = document.getElementById('dialogoverlay');
        var dialogbox = document.getElementById('dialogbox');
        dialogoverlay.style.display = "block";  
				dialogoverlay.style.height = winH+"px";
        dialogbox.style.left = (winW/2) - (550 * .5)+"px";
        dialogbox.style.top = "100px";
        dialogbox.style.display = "block";
    
        document.getElementById('dialogboxbody').innerHTML = dialog;
				document.getElementById('dialogboxfootLeft').innerHTML = '';
        document.getElementById('dialogboxfoot').innerHTML = '<button onclick="AlertOk()">OK</button>';
    }
	AlertOk = function(){
		document.getElementById('dialogbox').style.display = "none";
		document.getElementById('dialogoverlay').style.display = "none";

		
	}

// -----------------------------------------------------------------------------------------	
  function inputCompletion(){
	idxx=document.getElementById("prti").selectedIndex; 
	if ( ! idxx) return; 
	
	document.getElementById("fmName").value=fullNames[idxx-1];  
	tmp1= document.getElementById("prtitxt");
	tmp1.style.display='none';
	namesOptionDisplayed=false;
	ckNameRtrvVlus(true);
	}

// -----------------------------------------------------------------------------------------	
 function getNamesForCompletion(){
 var reslt=[];
 
  if ( ! autoComletionOn ) return;
 var listToSearchFrom=[];
    tmp1= document.getElementById("prtitxt");
		tmp1.style.display='none';
		namesOptionDisplayed=false;
	//	document.myform.familyname.value=delLeadingBlnks(document.myform.familyname.value);	
		if ( ! document.myform.familyname.value)return;
		
		 if ( ! sidurUlam){listToSearchFrom=requestorsNameList;} else listToSearchFrom=namesToAssign;
		 
		 srchArg=delLeadingBlnks(document.myform.familyname.value);
	   if (srchArg.length > 1 ){
		  for(i=1; i< srchArg.length-1; i++){
		    shortArg=srchArg.substr(0,i);
				reslt=searchName(shortArg,listToSearchFrom);
				
		    if( reslt.length==1){
				     document.getElementById("fmName").value=reslt[0];
		         document.getElementById("fmNameFloat").value=reslt[0];
						 window.setTimeout(activateOnChange,5);
						 return;
						 }   // if
				} // for		 
			}  //if			 
		        
	  document.getElementById("fmNameFloat").value=srchArg;
	   
	  fullNames=searchName(srchArg,listToSearchFrom);
	  
		 
		 
			idx=  fullNames.length;
		  if ( idx){
			    if ( idx > 1 ){
			    clearPrevsVlus();
		     
			    var selectList = document.getElementById("prti");
          var SLlength = selectList.options.length; 
				
          while (selectList.options.length > 1) selectList.options[1] = null; 

					fullNames.sort(); 
                    
				  for (i=0; i<	fullNames.length; i++)document.myform.prti.options[i+1]=new Option(fullNames[i]);
														
				  tmp1= document.getElementById("prtitxt");
		      tmp1.style.display='inline';
					namesOptionDisplayed=true;
				  focusId=document.getElementById('prti');
					} else
					   	document.getElementById("fmName").value=fullNames[0];						 
              
					window.setTimeout(activateOnChange,5);
							 
     } // if idx
		 
	}	 
// -----------------------------------------------------------------------------------------
 function searchName(arg,searchList){
  var fullNmes=[];
	var srchArgLength;
	srchArgLength=arg.length;
	   for (rn=0; rn<searchList.length; rn++){
			   leftPartOfNameString=searchList[rn].substr(0,srchArgLength);
	       if(arg == leftPartOfNameString) fullNmes.push(searchList[rn]); 
			  }  // for 	
 return fullNmes;
 
 
 
 }



// -----------------------------------------------------------------------------------------

function activateOnChange(){	
        document.getElementById('fmName').onchange(); 
				
	 	}
// -----------------------------------------------------------------------------------------
function activateRefocus(){
if (focusElmnt) focusElmnt.focus();
	}
    


 

// -----------------------------------------------------------------------------------------

   function ckNameRtrvVlus(genTables){
	 
	 if(fmNmOnChangeDIsabled)return;    // if mouse is over 'x' prepare for slecting it to erase name
	
	if(namesOptionDisplayed)return; //name not completed yet
	
	
	if(	document.myform.familyname.value != delLeadingBlnks(document.myform.familyname.value)){
	       	document.myform.familyname.value=delLeadingBlnks(document.myform.familyname.value);	
          return;
					}	

	   var resArray = new Array;
	 if(document.getElementById("fmName").value!= delLeadingBlnks(document.getElementById("fmNameFloat").value))   
	    document.getElementById("fmNameFloat").value = delLeadingBlnks(document.getElementById("fmName").value);
			
	
		if(   document.myform.familyname.value==''  )clearPrevsVlus();
		
	//	 if(  ! moed)return;
				 
			countAssignedMen=0;
			countAssignedWomen=0;	 
		
	if(document.myform.familyname.value){

		 document.getElementById("colorMap").style.display='none';
		 
		 res= ckName(0); 
		 if(res.substr(0,3)!='---')lastNameChecked=document.myform.familyname.value; 
	
		 mapForMember=true;
		  resArray=res.split('&');  
			
	    if(document.hiddenForm.lastFamName.value != document.myform.familyname.value)clearPrevsVlus();
		 document.hiddenForm.lastFamName.value = document.myform.familyname.value;
		 
		 numberOfSeatsRequested=resArray[3]+resArray[4]+resArray[5]+resArray[6];
		
		 if(numberOfSeatsRequested )memberdetails(resArray);  //  not first time,  previous data exists
   
		}
		else {if(genTables) clearPrevsVlus();}
	

	if(moed){
	
		 res= ckName(moed); 
		 if (res.substr(0,3)=='999') location.reload(true);
		 if (res.substr(0,3)=='---') return;
		 if(res.substr(0,3)=='aaa'){ // display color map
		      mapForMember= false; 
		      document.getElementById("colorMap").style.display='block';
			
					if ( ! printingNow)document.getElementById("mainFieldset").style.display='block';
					resArray=res.substr(4).split('&');
					
					
		      creatColoredMap(genTables,resArray);
					
					if(delLeadingBlnks (document.myform.familyname.value))   // if there is a family name then
				                      	updateCountAssigned(1,0); // force "number-of-assgnments-left" msg 
					return;	
   		};
					
					
		}
	}
	
//---------------------------------------------------------------------------------			
/*
	positionInMsg.email   0
	positionInMsg.addr   1
		positionInMsg.phone   2
			positionInMsg.gvarimRoshHashana   3
				positionInMsg.gvarimKipur   4
					positionInMsg.nashimRoshHashana   5
						positionInMsg.nashimKipur   6
							positionInMsg.minyanMuadafNashim   7
								positionInMsg.esberNashim    8
									positionInMsg.minyanMuadafGvarim    9
										positionInMsg.esberGvarim   10
											positionInMsg.moreComments   11
									 	positionInMsg.requestedSeats    12
											positionInMsg.requestDate    13
												positionInMsg.assignedSeatsRosh   14
													positionInMsg.assignedSeatsKipur    15
														positionInMsg.tashlum    16
															positionInMsg.tashlumPaid     17

 
*/

function memberdetails(resArray){
  
	 
		
	
     document.getElementById("details").style.display='block';
		
		 document.getElementById('reqemail').innerHTML=delLeadingBlnks(resArray[positionInMsg.email]);
		 document.getElementById('reqaddress').innerHTML=resArray[positionInMsg.addr];
		 document.getElementById('reqmobile').innerHTML=delLeadingBlnks(resArray[positionInMsg.phone]);
		 document.getElementById('menRosh').innerHTML=resArray[positionInMsg.gvarimRoshHashana];
		 document.getElementById('menkipur').innerHTML=resArray[positionInMsg.gvarimKipur];
		 document.getElementById('womenRosh').innerHTML=resArray[positionInMsg.nashimRoshHashana];
		 document.getElementById('womenkipur').innerHTML=resArray[positionInMsg.nashimKipur];
		 if (resArray[positionInMsg.moreComments]) {
		        document.getElementById('rCmnts').innerHTML=resArray[positionInMsg.moreComments];
		        document.getElementById("RmoreComments").style.display='block';
						 }
						 
		index=Number(resArray[positionInMsg.minyanMuadafNashim ]);  
		tmp=resArray[positionInMsg.esberNashim];
		if( index == 0) {
		         tmp1=tmp.split('/');
		         MonthNum=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'].indexOf( tmp1[1]);
						 tmp1[1]=['01','02','03','04','05','06','07','08','09','10','11','12'][MonthNum];
						 tmp= tmp1.join('/');
						 }
		minyan=	minyanMevukashW[index]+'  '+	tmp;  
		document.getElementById('minyanW').innerHTML=minyan;      
	

  	minyan=	minyanMevukashM[resArray[positionInMsg.minyanMuadafGvarim ]]+'  '+	resArray[positionInMsg.esberGvarim];   
		document.getElementById('minyanM').innerHTML=minyan;      
		
	
		seatsForRoshHashana=Number(resArray[positionInMsg.gvarimRoshHashana])+Number(resArray[positionInMsg.nashimRoshHashana]);
		seatsForYomKipur=Number(resArray[positionInMsg.gvarimKipur])+Number(resArray[positionInMsg.nashimKipur]);
	  numberOfSeatsForPayment=Math.max(seatsForRoshHashana,	seatsForYomKipur);  
		requiredPayment= basePayment+		numberOfSeatsForPayment * paymentPerSeat;  
		document.getElementById('letashlum').innerHTML=requiredPayment.toString(); 	

		
		tmp1=document.getElementById("isClosed");		
		if(delLeadingBlnks(resArray[positionInMsg.requestDate]))	{		
	                      tmp1.style.display='block';	
												var d = new Date(resArray[13]);
                        var offset = (new Date().getTimezoneOffset() / 60) * -1;
                        var n = new Date(d.getTime() + offset); 
												dParts=n.toString().split(' ');
			 
			                MonthNum=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'].indexOf( dParts[1]);
						          dParts[1]=['01','02','03','04','05','06','07','08','09','10','11','12'][MonthNum];
			                dclose=dParts[2]+' '+dParts[1]+' '+dParts[3]+' '+dParts[4];   
											document.getElementById("isClosedDate").innerHTML=dclose;
											document.getElementById("isClosedDate").style.textDecoration='underline';   
											document.getElementById("isClosedDate").style.fontWeight='bold'; 
												  }
					else {	
				                tmp1.style.display='none';	
												
										  }	
		
		
		
	// build seat maps 
	var templist = new Array;  
	GenerateTables();  
	    listOfAssignedSeats=[];
			requestedSeatsStr=delLeadingBlnks(resArray[positionInMsg.requestedSeats]); 
     
			roshStr=delLeadingBlnks(resArray[positionInMsg.assignedSeatsRosh]);  
			if( (moed==1) || (moed==3) ) if(roshStr){listOfAssignedSeats=roshStr.split('+')};
			kipurStr=delLeadingBlnks(resArray[positionInMsg.assignedSeatsKipur]);   
			if( moed==2 ) if(kipurStr){listOfAssignedSeats=kipurStr.split('+')};
			if(moed == 3){
			        if(kipurStr){templist=kipurStr.split('+')}else templist=[];
			        for(i=0; i<templist.length; i++){
							     if(listOfAssignedSeats.indexOf(templist[i]) == -1)listOfAssignedSeats.push(templist[i]);   };
							    }
			
			        assignedSeatsStr=resArray[positionInMsg.assignedSeatsRosh]+'*'+resArray[positionInMsg.assignedSeatsKipur];
			
							 combinedSeatsStr= requestedSeatsStr+'*'+assignedSeatsStr;
			        if ( ! moed)reconstructSeats(	combinedSeatsStr);
							document.myform.seatsString.value=combinedSeatsStr;
							          
												 
									 
}
// --------------------------------------------------------------------------------		
	
	function highlightMemberSeats(seatStr){
	
	  seatsStrArray=seatStr.split('*');
	  blinkElmntList=[];
		tempList=[];
		if ( ! seatStr)return;
		if ( printingNow) return;
		//highlight requests
		seatsArray=seatsStrArray[0].split('+');    
		for(ij=0;ij<seatsArray.length;ij++){
			   seatId='c'+seatsArray[ij].split('_')[0]+'_p';  
	       seatElmnt=document.getElementById(seatId);  
		     if (seatElmnt ){
				      blinkElmntList.push(seatsArray[ij]);
							}

				               
				 }
				 
		// highlight assigned seats
	
					assignedColor='yellow';
					assignedBGColor=	'black';
					assignedBorder='1px solid white';
					if (printingNow){
					   assignedColor='black';
					   assignedBGColor=	'white';
					   assignedBorder='1px solid black';
		       }			
					for(ij=0;ij<listOfAssignedSeats.length;ij++){
					currentSeat=listOfAssignedSeats[ij]; 
					seatt=Number( currentSeat);
					
			   seatId='c'+currentSeat+'_p';  
	       seatElmnt=document.getElementById(seatId); 	
						
	    	if (seatElmnt ){
				           
				   		     if(tempList.indexOf(currentSeat) == -1){ // not alredy highlighted
									  tempList.push(currentSeat);
							 
							      updateCountAssigned(currentSeat,1);
										
			    				  seatElmnt.style.backgroundColor=assignedBGColor;
				            seatElmnt.style.color=assignedColor;
										seatElmnt.style.border=assignedBorder;
									      }  // end if listOfAssignedSeats
						}		// end if seatElmnt	      
				 } // end for
		
	     
			 originalListOfAssigned=listOfAssignedSeats.slice();  
	}		 
		
//-----------------------------------------------------------------------------------    

  function displayAssignmentCounters  (){    
	       
         url=encodeURI(firstPartOfURL+"/getCountOfSeats/?"+yearToDisplay);	
         xhttp.open("GET", url, false);
         xhttp.send();
	       countersString = xhttp.responseText;
         seatCounters=countersString.split('$');  
				 for(counterNumber=0;counterNumber<18;counterNumber++){
				   counterId='avlblSeats'+counterNumber.toString(); 
					 document.getElementById(counterId).innerHTML=seatCounters[counterNumber];
					}
					document.getElementById('seatcounters').style.display='block';
					document.getElementById('seatcounters').style.background='white';
					
			//		setTimeout(DoNot_displayAssignmentCounters, 7000);
	}				 

	function DoNot_displayAssignmentCounters(){
						document.getElementById('seatcounters').style.display='none';
}


//-----------------------------------------------------------------------------------			
	function getInfoForStsfction(){
	if ( ! ( delLeadingBlnks (document.myform.famyname.value) ))return;
	   
	   document.myform.familyname.value=document.myform.famyname.value; // needed there for ckName
		yearToDisplay='';   // get info from this year
		
		 res= ckName(0);
		  resArray=res.split('&'); 
 if(res.substr(0,3)=='---'){
        Object.keys(positionInMsg).forEach(function(key) {resArray[positionInMsg[key]]=''; 
     									                     });	
		    };                                          
	
		 numberOfSeatsRequested=resArray[3]+resArray[4]+resArray[5]+resArray[6];
	//  	 if(numberOfSeatsRequested == 0 )return;  //   no  previous data exists
		 
	   	
		 document.getElementById('gvr_m3').innerHTML=resArray[positionInMsg.stsfctnInFlr3YRSAgoYrMen];   
		 document.getElementById('nashim_m3').innerHTML=resArray[positionInMsg.stsfctnInFlr3YRSAgoYrWmn];
		 document.getElementById('mkishv_m3').innerHTML=resArray[positionInMsg.ThreeYRSAgoSeat];
		 document.getElementById('gvr_m2').innerHTML=resArray[positionInMsg.stsfctnInFlr2YRSAgoYrMen];
	   document.getElementById('nashim_m2').innerHTML=resArray[positionInMsg.stsfctnInFlr2YRSAgoYrWmn];
		 document.getElementById('mkishv_m2').innerHTML=resArray[positionInMsg.TwoYRSAgoSeat];
		 document.getElementById('vetek').innerHTML=resArray[positionInMsg.memberShipStatus];		
		 
	//   document.myform.beinKomot.value=Number(resArray[positionInMsg.issueBetweenFloors]);	
	//	 document.myform.bekomaM.value=Number(resArray[positionInMsg.issueinFloorMen]);
	//	 document.myform.bekomaW.value=Number(resArray[positionInMsg.issueInFloorWmn]);
		
		 lstYrMn=delLeadingBlnks(resArray[positionInMsg.stsfctnInFlrLastYrMen]);
		 tmp1=lstYrMn.split('*');  
		 if ( !tmp1[1] ){ 
		      tmp2=Number(tmp1[0]);
					clr='red';}
					else {
					tmp2=Number(tmp1[1]);
					clr='black'};
			elmnt=document.getElementById('gvr_m1');
			elmnt.value=tmp2;
			elmnt.style.color=clr;
		 	document.getElementById('calcGvr_m1').innerHTML=tmp1[0];
		
		 lstYrWmn=delLeadingBlnks(resArray[positionInMsg.stsfctnInFlrLastYrWmn]);
		 tmp1=lstYrWmn.split('*');
		 if ( !tmp1[1] ){
		      tmp2=Number(tmp1[0]);
					clr='red';}
					else {
					tmp2=Number(tmp1[1]);
					clr='black'};
			elmnt=document.getElementById('nashim_m1');
			elmnt.value=tmp2;
			elmnt.style.color=clr;
	 	  document.getElementById('calcNashim_m1').innerHTML=tmp1[0];
		 			 
	   lstYrSt=delLeadingBlnks(resArray[positionInMsg.LastYrSeat]);
		 tmp1=lstYrSt.split('*');
		 if ( !tmp1[1] ){
		      tmp2=Number(tmp1[0]);
					clr='red';}
					else {
					tmp2=Number(tmp1[1]);
					clr='black'};
			elmnt=document.getElementById('mkishv_m1');
			elmnt.value=tmp2;
			elmnt.style.color=clr;
			document.getElementById('calcMkishv_m1').innerHTML=tmp1[0];
		  	
	
		 saveStsfctionVlusToArray(stsfctionVlusFromServer);   
		 
		 
		 
	// get info from previous year	
	
	yearToDisplay=LastYear;  
	
	    res= ckName(0);
		  resArray=res.split('&'); 
      if(res.substr(0,3)=='---'){
        Object.keys(positionInMsg).forEach(function(key) {resArray[positionInMsg[key]]=''; 
     									                     });	
		    };                                         
	
	   document.getElementById('menRoshStsfctn').innerHTML=resArray[positionInMsg.gvarimRoshHashana];
		 document.getElementById('menkipurStsfctn').innerHTML=resArray[positionInMsg.gvarimKipur];
		 document.getElementById('womenRoshStsfctn').innerHTML=resArray[positionInMsg.nashimRoshHashana];
		 document.getElementById('womenkipurStsfctn').innerHTML=resArray[positionInMsg.nashimKipur];
		 	  
		 if (delLeadingBlnks(resArray[positionInMsg.moreComments])) {
		        document.getElementById('rCmntsStsfctn').innerHTML=resArray[positionInMsg.moreComments];              
		        document.getElementById("RmoreCommentsStsfctn").style.visibility='visible';
						 }
						 else document.getElementById("RmoreCommentsStsfctn").style.visibility='hidden';
		
		if(	resArray[positionInMsg.minyanMuadafNashim ] ) {			 
		index=Number(resArray[positionInMsg.minyanMuadafNashim ]);           
		tmp=resArray[positionInMsg.esberNashim];
		if( index == 0) {
		         tmp1=tmp.split('/');
		         MonthNum=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'].indexOf( tmp1[1]);
						 tmp1[1]=['01','02','03','04','05','06','07','08','09','10','11','12'][MonthNum];
						 tmp= tmp1.join('/');
						 }
		minyan=	minyanMevukashW[index]+'  '+	tmp; }
		else minyan=''; 
		document.getElementById('minyanWSStsfctn').innerHTML=minyan;      
	
 if(	resArray[positionInMsg.minyanMuadafGvarim ] ) {
  	minyan=	minyanMevukashM[resArray[positionInMsg.minyanMuadafGvarim ]]+'  '+	resArray[positionInMsg.esberGvarim];  }
		else  minyan=''; 
		document.getElementById('minyanMSStsfctn').innerHTML=minyan; 
		
		
		elmnt=document.getElementById('stsfctnTbl');
		elmnt.onmouseover=showCalcStsf;	
		elmnt.onmouseout= hideCalcStsf;     
		
  GenerateTables();
	
	// requestedSeats,assignedSeatsRosh,assignedSeatsKipur,
	var tmp;
	var i;
	tmp=delLeadingBlnks(resArray[positionInMsg.assignedSeatsRosh]);
	var assnLstRosh=''; if (tmp)assnLstRosh=tmp.split('+');
	tmp=delLeadingBlnks(resArray[positionInMsg.assignedSeatsKipur]);
	var assnLstKipur='';   if (tmp)assnLstKipur=tmp.split('+');
	tmp=delLeadingBlnks(resArray[positionInMsg.requestedSeats]);
	var rqstList='';  if (tmp)rqstList=tmp.split('+');
	
	for (i=0;i <rqstList.length;i++){
	 requested_Seat_priority=rqstList[i].split('_');
	 seat_id='c'+requested_Seat_priority[0]+'_p';
	
	 switch 	(requested_Seat_priority[1]) {
		      case "1": 
								 	     changeBackgroundTo="red";
											 break;		 
													 
				  case "2": 
									  	 changeBackgroundTo='coral'; 
											 break;  
												
				  case "3": 
									  	changeBackgroundTo="pink";
											break;
													
				  }  // switch
											
	  txt='';
	  if (assnLstRosh.indexOf(requested_Seat_priority[0]) != -1){
		                            txt='ראש ';
																tmp=assnLstRosh.indexOf(requested_Seat_priority[0]);
																assnLstRosh.splice(tmp,1);
																}
		if (assnLstKipur.indexOf(requested_Seat_priority[0]) != -1){
		   
				tmp= assnLstKipur.indexOf(requested_Seat_priority[0]);
				 assnLstKipur.splice(tmp,1);
		     if( ! txt){txt='כפור';} else txt='חגים';  
				     }  // if
		if ( ! txt)txt='&nbsp';   // not assigned
		
	          elmnt=document.getElementById(seat_id);
						spnchild=elmnt.firstChild; 
						spnchild.innerHTML=txt;
						elmnt.style.background=changeBackgroundTo;  
						
		} // for i	
	if	(assnLstRosh){		
		for (i=0;i<	assnLstRosh.length;i++){
		  				txt='ראש ';
							if (assnLstKipur.indexOf(assnLstRosh[i]) != -1){			 
	                  
										tmp= assnLstKipur.indexOf(assnLstRosh[i]);
										
										assnLstKipur.splice(tmp,1);
										 txt='חגים';  
										 }
               seat_id=	'c'+assnLstRosh[i]+'_p';		
	             elmnt=document.getElementById(seat_id);  
						   spnchild=elmnt.firstChild; 
						   spnchild.innerHTML=txt;
							 elmnt.style.background='Aquamarine';
				}  // for i
		}  // 		if	(assnLstRosh)
				
				
	if (assnLstKipur){			
			for (i=0;i<	assnLstKipur.length;i++){
		  				txt='כפור'; 
								seat_id=	'c'+assnLstKipur[i]+'_p';		 
	             elmnt=document.getElementById(seat_id);
						   spnchild=elmnt.firstChild; 
						   spnchild.innerHTML=txt;
							 elmnt.style.background='Aquamarine';
				}  // for i
		} // if (assnLstKipur)						 
	
	}
//-----------------------------------------------------------------------------------			
	function getInfoForPrsnlPrblm(){  
	if ( ! ( delLeadingBlnks (document.myform.famlyname.value) ))return;
	   
	   document.myform.familyname.value=document.myform.famlyname.value; // needed there for ckName
		yearToDisplay='';   // get info from this year
		
		 res= ckName(0);
		  resArray=res.split('&'); 
 if(res.substr(0,3)=='---'){
        Object.keys(positionInMsg).forEach(function(key) {resArray[positionInMsg[key]]=''; 
     									                     });	
		    };                                          
	
		 numberOfSeatsRequested=resArray[3]+resArray[4]+resArray[5]+resArray[6];
	//  	 if(numberOfSeatsRequested == 0 )return;  //   no  previous data exists
		 
	   	
		 
		 document.getElementById('vetekPP').innerHTML=resArray[positionInMsg.memberShipStatus];		
		 
	   document.myform.beinKomot.value=Number(resArray[positionInMsg.issueBetweenFloors]);	
		 document.myform.bekomaM.value=Number(resArray[positionInMsg.issueinFloorMen]);
		 document.myform.bekomaW.value=Number(resArray[positionInMsg.issueInFloorWmn]);
			 			 
	   
		  	
		 tmp2=Number(resArray[positionInMsg.nashimMuadaf]);
		 document.myform.nashimMuadaf.value=tmp2;
		 clr='white'
		 if ( ! tmp2)clr='lightBlue';
		 document.myform.nashimMuadaf.style.backgroundColor =clr;
		 
		 tmp2=Number(resArray[positionInMsg.gvarimMuadaf]);
		 document.myform.gvarimMuadaf.value=tmp2;
		 clr='white'
		 if ( ! tmp2)clr='lightBlue';
		 document.myform.gvarimMuadaf.style.backgroundColor =clr;
		 
		 
		 savePrsnlProblemsVlusToArray(prsnlProblemsVlusFromServer);   
		 
		  document.getElementById('menRoshPrsnlProblems').innerHTML=resArray[positionInMsg.gvarimRoshHashana];
		 document.getElementById('menkipurPrsnlProblems').innerHTML=resArray[positionInMsg.gvarimKipur];
		 document.getElementById('womenRoshPrsnlProblems').innerHTML=resArray[positionInMsg.nashimRoshHashana];
		 document.getElementById('womenkipurPrsnlProblems').innerHTML=resArray[positionInMsg.nashimKipur];
		 
		 	  
		 if (delLeadingBlnks(resArray[positionInMsg.moreComments])) {
		        document.getElementById('rCmntsPrsnlProblems').innerHTML=resArray[positionInMsg.moreComments];              
		        document.getElementById("RmoreCommentsPrsnlProblems").style.visibility='visible';
						 }
						 else document.getElementById("RmoreCommentsPrsnlProblems").style.visibility='hidden';
		
		if(	resArray[positionInMsg.minyanMuadafNashim ] ) {			 
		index=Number(resArray[positionInMsg.minyanMuadafNashim ]);           
		tmp=resArray[positionInMsg.esberNashim];
		if( index == 0) {
		         tmp1=tmp.split('/');
		         MonthNum=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'].indexOf( tmp1[1]);
						 tmp1[1]=['01','02','03','04','05','06','07','08','09','10','11','12'][MonthNum];
						 tmp= tmp1.join('/');
						 }
		minyan=	minyanMevukashW[index]+'  '+	tmp; }
		else minyan=''; 
		document.getElementById('minyanWSPrsnlProblems').innerHTML=minyan;      
	
 if(	resArray[positionInMsg.minyanMuadafGvarim ] ) {
  	minyan=	minyanMevukashM[resArray[positionInMsg.minyanMuadafGvarim ]]+'  '+	resArray[positionInMsg.esberGvarim];  }
		else  minyan=''; 
		document.getElementById('minyanMSPrsnlProblems').innerHTML=minyan; 
		
		
  GenerateTables();
	
	// requestedSeats,assignedSeatsRosh,assignedSeatsKipur,
	var tmp;
	var i;
	tmp=delLeadingBlnks(resArray[positionInMsg.assignedSeatsRosh]);
	var assnLstRosh=''; if (tmp)assnLstRosh=tmp.split('+');
	tmp=delLeadingBlnks(resArray[positionInMsg.assignedSeatsKipur]);
	var assnLstKipur='';   if (tmp)assnLstKipur=tmp.split('+');
	tmp=delLeadingBlnks(resArray[positionInMsg.requestedSeats]);
	var rqstList='';  if (tmp)rqstList=tmp.split('+');
	
	for (i=0;i <rqstList.length;i++){
	 requested_Seat_priority=rqstList[i].split('_');
	 seat_id='c'+requested_Seat_priority[0]+'_p';
	
	 switch 	(requested_Seat_priority[1]) {
		      case "1": 
								 	     changeBackgroundTo="red";
											 break;		 
													 
				  case "2": 
									  	 changeBackgroundTo='coral'; 
											 break;  
												
				  case "3": 
									  	changeBackgroundTo="pink";
											break;
													
				  }  // switch
											
	  txt='';
	  if (assnLstRosh.indexOf(requested_Seat_priority[0]) != -1){
		                            txt='ראש ';
																tmp=assnLstRosh.indexOf(requested_Seat_priority[0]);
																assnLstRosh.splice(tmp,1);
																}
		if (assnLstKipur.indexOf(requested_Seat_priority[0]) != -1){
		   
				tmp= assnLstKipur.indexOf(requested_Seat_priority[0]);
				 assnLstKipur.splice(tmp,1);
		     if( ! txt){txt='כפור';} else txt='חגים';  
				     }  // if
		if ( ! txt)txt='&nbsp';   // not assigned
		
	          elmnt=document.getElementById(seat_id);
						spnchild=elmnt.firstChild; 
						spnchild.innerHTML=txt;
						elmnt.style.background=changeBackgroundTo;  
						
		} // for i	
	if	(assnLstRosh){		
		for (i=0;i<	assnLstRosh.length;i++){
		  				txt='ראש ';
							if (assnLstKipur.indexOf(assnLstRosh[i]) != -1){			 
	                  
										tmp= assnLstKipur.indexOf(assnLstRosh[i]);
										
										assnLstKipur.splice(tmp,1);
										 txt='חגים';  
										 }
               seat_id=	'c'+assnLstRosh[i]+'_p';		
	             elmnt=document.getElementById(seat_id);  
						   spnchild=elmnt.firstChild; 
						   spnchild.innerHTML=txt;
							 elmnt.style.background='Aquamarine';
				}  // for i
		}  // 		if	(assnLstRosh)
				
				
	if (assnLstKipur){			
			for (i=0;i<	assnLstKipur.length;i++){
		  				txt='כפור'; 
								seat_id=	'c'+assnLstKipur[i]+'_p';		 
	             elmnt=document.getElementById(seat_id);
						   spnchild=elmnt.firstChild; 
						   spnchild.innerHTML=txt;
							 elmnt.style.background='Aquamarine';
				}  // for i
		} // if (assnLstKipur)						 
	
	}

// --------------------------------------------------------------------------------  	
	function showCalcStsf(){
	var elmnt;
	elmnt=document.getElementById('calculatedStsfctn');
	elmnt.style.display='block';
	}
	
//----------------------------------
  function hideCalcStsf(){
	var elmnt;
	elmnt=document.getElementById('calculatedStsfctn');
	elmnt.style.display='none';
	}


// --------------------------------------------------------------------------------   
  function saveStsfctionVlusToArray(arr){
	
	
	   arr[0]= document.myform.gvr_m1.value;		
	   arr[1]= document.myform.nashim_m1.value;		
	   arr[2]= document.myform.mkishv_m1.value;	

	
	}


// --------------------------------------------------------------------------------   
  function savePrsnlProblemsVlusToArray(arr){
	
	  arr[0]=document.myform.beinKomot.value;	
		 arr[1]=document.myform.bekomaM.value;		
	   arr[2]= document.myform.bekomaW.value;		
	   
		 arr[3]= document.myform.nashimMuadaf.value;	
		 arr[4]= document.myform.gvarimMuadaf.value;
	   
	
	}




// --------------------------------------------------------------------------------  


function creatColoredMap(genTables,strArray){

var namesForInnerhtml = new Array;
     document.myform.seatsString.value='';
		
		if(genTables)GenerateTables(); // build seat maps
		 ;              
			
// coloring
    str_s=strArray[0]; // ocupancy and highlight. [0] is occupacy list
		seats=str_s.split('+');  // seats array 
	
		  assignedColor='white';
			assignedBGColor=	'black';
			
			if (printingNow){
			   assignedColor='black';
			   assignedBGColor=	'white';
			   }
	 for (i=0; i< seats.length; i++){
	 
	    seatNVlu= seats[i].split('_');    debug=false;
	
				
			seatId='c'+seatNVlu[0]+'_p';  
			cell_element=document.getElementById(seatId); 
		
			if(cell_element){                 // element was created
	
	    vluu=seatNVlu[1].split('@'); 
			occupanc=Number(vluu[0]);	
			for (j=0; j<colormap.length; j++){ 
			  if (occupanc < 	colormap[j][0] ) {colr=colormap[j][1]; break;}
				if (occupanc == 	colormap[j][0] ) {colr=colormap[j][2]; break;}
        	}
		  
			 
			 
			 
				baseColr=colr;
				fontClr='black';
				if(printingNow){nameT0Show=' ';} else nameT0Show=seatNVlu[0];
				seatParts=vluu[1].split('/'); 
				assndLst=seatParts[0].split('$'); 
				assgndRosh=delLeadingBlnks(assndLst[0]); 
				assgndKipur=delLeadingBlnks(assndLst[1]); 
				if ( assgndRosh || assgndKipur){ // assigned for at least one holiday  'if1'
				  if(assgndRosh == assgndKipur ){ //'if2'
										  
											 fontClr=assignedColor;
					             colr=assignedBGColor;
					              nameT0Show=assgndRosh;
					                     } //end if2
					  else { //only one is assigned   start else2
						    

					    if (  (moed == 1) && assgndRosh) { //if3
							 										  

								fontClr=assignedColor;
					       colr=assignedBGColor;
								 nameT0Show=assgndRosh;  
								  } else if((moed == 2) && assgndKipur) { //else3
						
																  

									   fontClr=assignedColor;
					           colr=assignedBGColor;
								     nameT0Show=assgndKipur;
										 } //end else3
				      } // end else2
				}  //end if1
				
			//	cell_element.style.background=	'rgba(84,84,84,0.4)';
				cell_element.style.background=	colr;	
				cell_element.style.color=	fontClr; 
				cell_element.style.fontSize = '11px';
	//		cell_element.style.fontWeight = 'bold';
				originalInfo.occupancBGColor=baseColr;  
				originalInfo.ocuupacColor='black';
				originalInfo.baseNameToShowList='';
				originalInfo.assgnedName='$'; 
			  span_element=cell_element.children[0];	
       
 
		      originalInfo.assgnedName=seatParts[0];  
	    		originalInfo.baseNameToShowList=seatNVlu[0];
	

	 
		     cell_element.setAttribute("value", vluu[1]); 
		 if ( ! printingNow)span_element.innerHTML=nameT0Show;
				
	
								  
	
	 //seatOriginalInfo[seatNVlu[0]]=Object.assign({}, originalInfo);
	 collectOriginalInfo(seatNVlu[0]);
	span_element.setAttribute('style',"padding:0"); // 
	
	
	
       }   // end 'if cell element'
	}  // end loop  		 
		

	 highlightMemberSeats(strArray[1]); 
}

// --------------------------------------------------------------------------------
function collectOriginalInfo(toSeat){
seatOriginalInfo[toSeat]= originalInfo.ocuupacColor+'@'+originalInfo.occupancBGColor+'@'
                                                +originalInfo.baseNameToShowList+'@'+originalInfo.assgnedName;

}

// --------------------------------------------------------------------------------

function  getOriginalInfo(fromSeat){
 var tmp;
 tmp=seatOriginalInfo[fromSeat].split('@');
 originalInfo.ocuupacColor=tmp[0];
 originalInfo.occupancBGColor=tmp[1];
 originalInfo.baseNameToShowList=tmp[2];
 originalInfo.assgnedName=tmp[3];
 
 }



// --------------------------------------------------------------------------------



function reconstructSeats(str){
  var stArray = new Array;
	var seatsStringsArray;
	blinkElmntList=[];

	seatsStringsArray=str.split('*'); 
	if( (moed==1) || (moed==2) ){assignedSeats=seatsStringsArray[moed]}  else assignedSeats=seatsStringsArray[1]+'+'+seatsStringsArray[2]; 
	  
	stArray = seatsStringsArray[0].split('+');   //handle requested seats
	  
	if(stArray[0].indexOf('_')!=-1){   
	  for(i=0; i<stArray.length; i++){
		  var vlu=stArray[i].split('_');
      
      cellId='c'+vlu[0]+'_p'; 
			cell_element=document.getElementById(cellId); 
			
			
			spnchild=cell_element.firstChild;	
			
			switch 	(vlu[1]) {  
				     				 
				     case "1":  
									  	 cell_element.style.background='red'; 
											 spnchild.innerHTML='1';
											 break;  
												
				   	case "2": 		 
									  	cell_element.style.background="coral";
											spnchild.innerHTML='2';
											break;
													
				  	case "3":	 
									  	cell_element.style.background="pink";	
											spnchild.innerHTML='3';
											break;																		 
													          }; 
																		
					}													
			} 
			
// highlight assigned seats			
		listOfAssignedSeats=[];	
		assignedSeatsArray=assignedSeats.split('+'); 
		for(i=0;i<	assignedSeatsArray.length; i++){ 
		    var vlu=assignedSeatsArray[i];   
        cellId='c'+vlu+'_p'; 
			  cell_element=document.getElementById(cellId)
			  if(cell_element){
				   k=listOfAssignedSeats.indexOf(vlu); 
				     if(k == -1){ // not alredy highlighted
									 listOfAssignedSeats.push(vlu); 
						        cell_element.style.background='gold';   
		                 }
			       } 
	     }
			
	}
	
// -----------------------------------------------------------------------------------------document.body.scrollTop
function setShortCounters(menAssgnd,menRqstd,womenAssgnd,womenRqstd){
document.getElementById('menToAssgn').innerHTML=menAssgnd.toString();
document.getElementById('menReqst').innerHTML=menRqstd.toString();
document.getElementById('womenToAssgn').innerHTML=womenAssgnd.toString();
document.getElementById('womenRqst').innerHTML=womenRqstd.toString();

document.getElementById('menToAssgn').style.color='black';
document.getElementById('womenToAssgn').style.color='black';


if (menAssgnd > menRqstd)document.getElementById('menToAssgn').style.color='red';
if (womenAssgnd > womenRqstd) document.getElementById('womenToAssgn').style.color='red';


}


	
// -----------------------------------------------------------------------------------------
	

function updateCountAssigned(seat,delta){
  var noBlnks_roshStr;
	var noBlnks_kipurStr;
	var tmp11=[];
	var ii;
  noBlnks_roshStr=delLeadingBlnks(roshStr);
	noBlnks_kipurStr=delLeadingBlnks(kipurStr);
	
	copyAssgnmntElmnt=document.getElementById('copyAssignment');
	copyAssgnmntElmnt.style.display='none'
	
 if(isWoman[seat]==1){countAssignedWomen=countAssignedWomen+delta;}
    else countAssignedMen=countAssignedMen+delta;
		
			switch 	(moed) {  
				     				 
				     case 1:	// rosh hashana
						          countRequestedMen=Number(document.getElementById('menRosh').innerHTML);
											countRequestedWomen=Number(document.getElementById('womenRosh').innerHTML);
											break;
						 case 2:   // kipur
						          countRequestedMen=Number(document.getElementById('menkipur').innerHTML);
											countRequestedWomen=Number(document.getElementById('womenkipur').innerHTML);
											if (! noBlnks_roshStr)break;
											tmp11=noBlnks_roshStr.split('+');  
											seatsInUlam=false;
											for (ii=0;ii<tmp11.length;ii++)if(inUlam(tmp11[ii])){seatsInUlam=true; break};
											if ( (seatsInUlam) &&  ( !  (countAssignedMen+countAssignedWomen) ))copyAssgnmntElmnt.style.display='block'
											break;
							case 3:  // both
							        countRequestedMen=Math.max(Number(document.getElementById('menRosh').innerHTML),Number(document.getElementById('menkipur').innerHTML));
											countRequestedWomen=Math.max(Number(document.getElementById('womenRosh').innerHTML),Number(document.getElementById('womenkipur').innerHTML));
							        break;
																				
                     };
				 
			stillToAssignMen=countRequestedMen-countAssignedMen;	
			stillToAssignWomen=countRequestedWomen-countAssignedWomen;
			
			setShortCounters(countAssignedMen,countRequestedMen,countAssignedWomen,countRequestedWomen);
			
			document.getElementById("adainloukzu").style.display='none';
			document.getElementById("yotermidai").style.display='none';
			document.getElementById("hakzaamleaa").style.display='none';
			document.getElementById("holidayMixup").style.display='none';
			
			document.getElementById("mekomotGvarim").innerHTML=stillToAssignMen;
			document.getElementById("mekomotNashim").innerHTML=stillToAssignWomen;
			
			if(delta==0){   // case when function was called after loading of member info
			   if(moed == 3) { //and 2 holidays are handled now
				 
				   if (  ( noBlnks_roshStr != noBlnks_kipurStr)  && noBlnks_kipurStr && noBlnks_roshStr)
					 
					 { // but they are not the same 
					    document.getElementById("holidayMixup").style.display='inline';
							return;
							}
					}
			};	
			if(delLeadingBlnks(document.myform.familyname.value)){
			if( (! stillToAssignMen ) && ( ! stillToAssignWomen) ){ // assignment done
			     			document.getElementById("hakzaamleaa").style.display='inline';  }
				else { if (	(	stillToAssignMen <0 ) || (	stillToAssignWomen < 0 ) ) {
				           document.getElementById("yotermidai").style.display='inline';   }
									 else document.getElementById("adainloukzu").style.display='inline';
						};
				}						 
}


// ----------------------------------------------------------------------------------------- 	

function inUlam(seat){
 var tmp=Number(seat);
 var shura;
 
 if (sidurUlam==3)return true;
 martef=''; if (sidurUlam == 2)martef='m';
 for (shura=0; shura<shurot.length;shura++) { 
                         if ( (shurot[shura][0] <= tmp ) && (tmp <= shurot[shura][1])  ) break;  }
												 
 if (  (shurot[shura][3]=='m')  && (martef=='m') )return true;
 if (  (shurot[shura][3]!='m')  && (! martef) )return true;
 return false;
 }


// ----------------------------------------------------------------------------------------- 	
		
// delete leading blanks

 function delLeadingBlnks (str){
     str1=str;  if (! str1)return str1;
		 while (str1.substr(0,1)==' '){str1= str1.substr(1); 	  if (! str1.length)break;}	
		 while (str1.substr(str1.length-1,1)==' '){str1= str1.substr(0,str1.length-1); 	  if (! str1.length)break;}		
		 return str1;
		 }


// -----------------------------------------------------------------------------------------	
    function ckName(lMoed){ 
		          if ( ! validPasswordEntered){
							                          Alert('יש להכניס סיסמא נכונה לפני שימוש בטופס');
																				document.myform.familyname.value='';
																				document.getElementById("pasw").focus();
																				return '999';
																				}
           		
							moedStr=moedCodes[lMoed];
						
							url=encodeURI(firstPartOfURL+"/mngfmname/?"+moedStr+document.myform.familyname.value+'$'+'&'+password+'&'+yearToDisplay);
           
						  xhttp.open("GET", url, false);
              xhttp.send();
	            CNrspnsString = xhttp.responseText;
							focusId=document.getElementById('fmName');
							if(CNrspnsString.substr(0,3)=='999'){  
							                        Alert('סיסמא שגויה. הכנס שוב סיסמא');
																		  document.getElementById("paswDiv").style.display='block';  
								       	              validPasswordEntered=false; 
																		  };
																			
				if(CNrspnsString.substr(0,3)=='---'){
				      Alert('שם לא מוכר. אנא הכנס שם שנית או הוסף שם למערכת');	
							nameToJumpBackTo='';														
					    clearPrevsVlus();
	          }
	     			 return CNrspnsString;
    }
//----------------------------------------------------------------------------------------------------

function selectionMade(oprtion){
if ( ! validPasswordEntered){
							                          Alert('יש להכניס סיסמא נכונה לפני שימוש בטופס');
																				document.myform.familyname.value='';
																				document.getElementById("pasw").focus();
																				return '999';
																				}

		  nameToJumpBackTo='';
			document.getElementById("adainloukzu").style.display='none';
			document.getElementById("yotermidai").style.display='none';
			document.getElementById("hakzaamleaa").style.display='none';
			document.getElementById("holidayMixup").style.display='none';																		
																			
  chooseOperation(); // in case that this was not preceding selectionmade
	switch 	(oprtion) {  
				     				 
				     case "1":  
							  	
                 moed=document.getElementById("moed1").selectedIndex;
				//				 if( ! moed) return;
                 sidurUlam=0;
                 sinunShlavB=false;
                 sinunNotPaid=false;
								 sinunDoneWith=false;
								 
                 break;  
             
						 case "2":  
							  	
                 moed=document.getElementById("moed2").selectedIndex;
                 sidurUlam=document.getElementById("ulamLesidur").selectedIndex;
								  if( (! moed)|| ( !sidurUlam)) return;
                 sinunShlavB= ! (document.myform.sinun[0].checked);
                 sinunNotPaid=! (document.myform.sinun[1].checked);
								 sinunDoneWith= ! (document.myform.sinun[2].checked);
                 break;  

          }

       getListOfNames();
       ckNameRtrvVlus(true);
	   	 
}

//--------------------------------------------------------------------------------------------------------  
 

function prepareToPrint(reqUlam){
/*
  rotationTags=  notRotated:$   RotatedM45Div: <    RotatedM315Div: #      RotatedM135Div: >    

  */
										 
										 
										 

var directnTags=['$','#','<','>','_'];
var shura;
var fromSeat;
var toSeat;
var minGroupSize;
var seat;
var seatCount;
var innerLoopSeat;
var  cell_id;
var cell;
var tempStr;
var strParts=[];
var tempAssigned;
var assgndName;
var candidateGroupName;
var tmp;
var jumpOne;
var single;
 

deleteOldChildren('envPrtFormt');
deleteOldChildren('prtFormt');

 

getShulConfig(); 

BG_indx=0;

cellAttrbts=[[],[]];

for (shura=0; shura<shurot.length; shura++){  // find group of seats in each shura   --

ulam=shurot[shura][3]; 
if (ulam != reqUlam)continue;

  fromSeat=shurot[shura][0];  
	toSeat=shurot[shura][1];
	inDbgRange=false;  if ( (fromSeat==681) || (fromSeat==681) )inDbgRange=true;//===========================================dbg switch

// if(	inDbgRange) console.log('
	
inDbgRange=false;
//	if ( (toSeat - fromSeat +1) <  minGroupSize) continue;   // line too short  
	
	envlpDiv=document.createElement("div");
	envlpDiv.setAttribute("id","envPrtFormt");
	 divHight=0;
	 divWidth=0;
	 cellAttrbts[0][0]=0;
	 cellAttrbts[0][1]=0;
	 
   firstSeatElmnt=document.getElementById('c'+fromSeat.toString()+'_p'); 
	 getCellAttrbts(firstSeatElmnt,0);  
	 baseHeight=cellAttrbts[0][2];
	 baseWidth=cellAttrbts[0][3];  
	 nxtStElmnt=document.getElementById('c'+(fromSeat+1).toString()+'_p');
	 getCellAttrbts(nxtStElmnt,1);   // get info to determine type of row
	 
	 directionType=directnTags.indexOf(cellAttrbts[0][4]);
	 
	 ulam=shurot[shura][3];
	if (ulam=='m'){
	              base=document.getElementById("Hall1FrameTop");
								startingTop=getPosition(document.getElementById("hall1"));
								}
	    else if (ulam=='n'){
			          base=document.getElementById("Hall3FrameTop");
								startingTop=getPosition(document.getElementById("hall3"));
								}
			  else {
				       base=document.getElementById("Hall2FrameTop");
							 startingTop=getPosition(document.getElementById("hall2"));
							 }
	startingTop=startingTop.y;						 
	
	ind= shurot[shura][4]; 
	 if (ind ){ 
       envlpX=ind;
	     envlpY=shurot[shura][5]+startingTop;
			 
			 } else {  
			    envlpX=cellAttrbts[0][0];  
	        envlpY=cellAttrbts[0][1];   
	             }
		
			
		envlpDiv.style.zIndex = "10";
		deltaHeight=0;
		deltaWidth=0;
		envWidth=0;
		envHeight=0;
		
	
	  minGroupSize=1;   ///////////////////////////////////////////   
		
	
	
	   seat=fromSeat;
	     while ( seat < toSeat-minGroupSize+2){   // start looking from this seatNumber
			
			    seatCount=0;
					jumpOne=0;
					candidateGroupName='';//
				
          for (innerLoopSeat=seat;innerLoopSeat<toSeat+1;innerLoopSeat++){
					
					    cell_id='c'+innerLoopSeat.toString()+'_p';   
					    cell=document.getElementById(cell_id);
																			 
				     	tempStr=cell.getAttribute('value'); 
              tempStr=delLeadingBlnks (tempStr); 
							
              if(tempStr=='$/'){ jumpOne=1; break;}
					    strParts=tempStr.split('/'); 
					    tempAssigned=strParts[0].split('$');
					    assgndName=tempAssigned[moed-1]; // moed=1 is rosh, =2 is kipur
							if ( ! assgndName){ jumpOne=1; break;}
				    	if ( ! seatCount) {
							             seatCount=1; 
													 candidateGroupName=assgndName;
													 
													  continue;
													};
				    	if ( candidateGroupName != assgndName)break;
						 	
							seatCount++;	
					} // for innerLoopSeat
		     
		         tmp=innerLoopSeat;
						 
						// if (seatCount){tmp=tmp-1;}else {seatCount++; };
						single=false;
						if ( ! seatCount){seatCount=1; single=true;} 
	
			
			
	 switch 	(directionType) {
		      case 0: 
								 	    
											 if (cellAttrbts[0][0]==cellAttrbts[1][0]){ // second case ==> verical row; rotated 90
						          heightBased=true;
								      widthBased=false;
							        height=baseWidth-2;
							        width=(baseHeight)* seatCount-2;  
								      DivClass='RotatedM90Div';
				             }  else {
								 
			        // horizontal
							           heightBased=false;
								         widthBased=true;
							           width=baseWidth * seatCount-2;
								         height=baseHeight-2;
								         DivClass='NoRotateDiv';
									 							
			        }  // else
											 break;		 
													 
				  case 1: 
									  	 DivClass='prtRotated45Div';
										   heightBased=true;
								       widthBased=false;
							         width=baseWidth * seatCount-2;
								       height=baseHeight-2;
											 break;  
												
				  case 2: 
									  	DivClass='prtRotated45Div';
											heightBased=true;
								      widthBased=false;
							        height=baseWidth-2;
							        width=(baseHeight)* seatCount-2; 
											break;
					case 3: 
									  	DivClass='RotatedM135Div';
								      heightBased=true;
								      widthBased=false;
							        width=baseWidth * seatCount-2;
								      height=baseHeight-2;
											break;
					case 4: 
									  	DivClass='RotatedM90DivSpecial';
										  heightBased=false;
								      widthBased=true;
							        width=baseWidth * seatCount-2;  
								      height=baseHeight-2;
											break;														
				  }  // switch
			// coomon code
			
								
								  newDiv= document.createElement("div");
									newDiv.setAttribute("id","prtFormt");
                 
									newDiv.style.width=(width).toString()+'px';
						
									newDiv.style.height=height.toString()+'px';
						     if(single)newDiv.style.background='white';
						     envWidth=envWidth+width+2;
									          
									
							  									
							for (i=seat;i <innerLoopSeat;i++){
									   cell_id='c'+(i).toString()+'_p';  
					           cell=document.getElementById(cell_id);
										 cell.style.backgroundColor = "White";
										 cell.style.color='white';
										 if ( seatCount>1 )cell.style.border=  '1px dotted  green';
							 	 }  
					if(directionType==0){ // if not slanted
				envHeight=height;
				if(widthBased){
				        //envHeight=baseHeight-2;
							 divX=envlpX-envWidth+baseWidth;  
							  divY=envlpY;      
							 }
      	 if(heightBased){
				// envHeight=baseHeight-2;
				
				   divX=envlpX-envWidth/2+envHeight/2;//+2;
					 divY=envlpY+envWidth/2-envHeight/2;
							}
				 
				}	;			 
								 
          formatName(newDiv,candidateGroupName,width,height,seatCount,widthBased,directionType);
					 
						envlpDiv.appendChild(newDiv);
					   seat=seat+seatCount;   //jump over sub group;;  loop will add 1
											
        } // while seat
				
				envlpDiv.className=	DivClass;
				
				
			  envlpDiv.style.position='absolute';
				envlpDiv.style.border='1px black';
				
				
				
				if(  (directionType==0) || (directionType==4) ) { // if not slanted
				envHeight=height;
				if(widthBased){
				        //envHeight=baseHeight-2;
							 envlpX=envlpX-envWidth+baseWidth;  
							 						        
							 }
      	 if(heightBased){
				// envHeight=baseHeight-2;
				
				   envlpX=envlpX-envWidth/2+envHeight/2;//+2;
					 envlpY=envlpY+envWidth/2-envHeight/2;
							}
				
				}	;
				envlpDiv.setAttribute("value",fromSeat);	
				
				envlpDiv.style.left=envlpX.toString()+'px';
	      envlpDiv.style.top=envlpY.toString()+'px';
								
				envlpDiv.style.height=	(envHeight).toString()+'px';
				envlpDiv.style.width=	(envWidth).toString()+'px';					 
				base.appendChild(envlpDiv);
			/* dbg
			  dbgDiv= document.createElement("div");
				dbgDiv.setAttribute("id","dbgdiv");
			 dbgDiv.innerHTML='X';
				dbgDiv.style.left=envlpX.toString()+'px';   if (fromSeat==801)dbgDiv.style.left='1172px';
	      dbgDiv.style.top=envlpY.toString()+'px';
				base.appendChild(dbgDiv);
				
				 end dbg code*/
   }  // for shura
	 
}
//--------------------------------------------------------------------------------------------------------
 function formatName(div,name,width,height,seatCount,widthBased,directionType){
 BGColors=['lightgray','gainsboro','mistyrose','lavender','lightyellow','beige'];
  var tmp;
	var tmp2;
	var hgt;
	var tmp1=[];
  var textSpan = document.createElement("span");
	var nam;
	var ind;

	nam=delLeadingBlnks(name);
						
  if (true){   // seatCount==1
			 textSpan.style.color='black';
			 textSpan.style.position='absolute'; 
			textSpan.style.width=(Math.max(height,width)).toString()+'px';
			hgt=Math.min(height,width);
			textSpan.style.height=hgt;
		
			 textSpan.style.fontWeight = 'bold';
			
			 tmp1=calcFont(nam.length,width,height);
			 ind=nam.indexOf(' ');
			 lnHgt=hgt;  if ( (tmp1[2]) || (ind) )lnHgt=lnHgt/1.8;
			 if( (tmp1[1] <= 14) && ind)tmp1[1]=16; 
			 textSpan.style.lineHeight =(lnHgt  ).toString()+'px';
			 
			 if(nam){textSpan.innerHTML=nam;} else textSpan.innerHTML='&nbsp';
			 textSpan.style.fontSize=tmp1[1];
		
			if ( ! tmp1[0] ){
			               if ( directionType  ){ txtClass='prtTextRotatedM90'; if( directionType==4)txtClass ='textRotated90';}   //prtTextRotatedM90_4
										   else { 
											    if(hgt<30) {txtClass='prtNarrowTextRotated90';}else txtClass='prtWideTextRotated90';
													}
			               textSpan.className=txtClass;
			
			   } else  textSpan.className='textNotRotated';

			div.appendChild(textSpan);
			
			 if (nam){
			div.style.background=BGColors[BG_indx];
			BG_indx++; if (BG_indx >= BGColors.length)BG_indx=0;
			div.style.opacity = "0.5"
			}
			 return;
			 }

}



//--------------------------------------------------------------------------------------------------------

  function calcFont(namLength,width,height){
	var rspns=[];
	var tmp;
	var tmp1;
	var tmpMx;
	var tmpMn;
	
	
	rspns[2]=false; // one text line
	tmpMx=Math.max(width,height);				
	if (tmpMx == width){rspns[0]=true}else rspns[0]=false;
	tmpMn=width+height-tmpMx;
	tmp=Math.floor((tmpMx/namLength)*1.9);
	
	if (tmp>tmpMx)tmp=tmpMx;
	if (tmp<12)rspns[2]=true;     // probably 2 lines of text 
	 if (tmp<14)tmp=14;     if (tmp>35)tmp=35;
	rspns[1]=tmp;  
	return rspns;
	
	

}

//--------------------------------------------------------------------------------------------------------

function getCellAttrbts(cell,idx){

var tmp=[];
var kkk=[];

tmp[0]=getPosition(cell).x;
 tmp[1]=getPosition(cell).y; 
 tmp[2]=cell.offsetHeight;
 tmp[3]=cell.offsetWidth;
 tmp[4]=(cell.style.quotes).substr(1,1);  // '#' is indication for rotation
 cellAttrbts[idx]=tmp;
 /*
                var rect = cell.getBoundingClientRect ();
               tmp[5]= rect.left;
                tmp[6]= rect.top;
               tmp[7]= rect.right - rect.left;
             tmp[8]= rect.bottom - rect.top;
  */
 }

//--------------------------------------------------------------------------------------------------------

   function getShulConfig(){
	 
	 //amudotOfConfig={fromSeat:'A', toSeat:"B",reltvRowQual:'C',open_badSeats:'D',ezor:'E',ulam:'F',X_forSlantedRow:'H',Y_forSlantedRow:'I'};										

	   url=encodeURI(firstPartOfURL+"/getShulConfig");
     xhttp.open("GET", url, false);
       xhttp.send();
	     rspnsString = xhttp.responseText;        
			 shurot=[];
			 var shura;
			
       var tbl1=	rspnsString.split('$'); 
			 for (shura=0;shura<tbl1.length;shura++){
			    tmp=tbl1[shura].split('@');
					
					shurot[shura]=new Array;
					shurot[shura][0]=Number(tmp[0]);
					shurot[shura][1]=Number(tmp[1]);
					shurot[shura][2]=tmp[4];
					shurot[shura][3]=tmp[7];
					shurot[shura][4]=Number(tmp[5]);
					shurot[shura][5]=Number(tmp[6]);
					
					}				
	
	
	}

//-------------------------------------------------------------------------- 
 function copyFromRosh(){
 var listToReAssgn=[];
 var i;
 var seat;
 var seatId;
 
 
 listToReAssgn=roshStr.split('+');
 
 for (i=0;i<listToReAssgn.length;i++){
    seat=listToReAssgn[i];
		seatId='c'+seat+'_p'; 
    document.getElementById(seatId).click();
 }


}

//--------------------------------------------------------------------------------------------------------   
  function getListOfNames(){
	  if(sidurUlam){
       getNameList();
			 return;
						 }
			// get list of all requestors			 
		url=encodeURI(firstPartOfURL+"/getRequstorsList/?"+password+'$'+yearToDisplay);  
              xhttp.open("GET", url, false);
              xhttp.send();
	            rqstorsString = xhttp.responseText; 
						  if(rqstorsString.substr(0,3)=='999'){Alert('סיסמא שגויה. הכנס סיסמא נכונה');  return;};
					    if(rqstorsString.substr(0,3)=='000'){Alert('רשימת שמות ריקה');  return;};
					    strrratrs=delLeadingBlnks(rqstorsString.substr(3));
							if(! strrratrs){Alert('רשימת שמות ריקה');  return;};

					 requestorsNameList=strrratrs.split('$');
					  for (rn=0; rn<requestorsNameList.length; rn++){	   // normelise names
       	       fnm=requestorsNameList[rn].split(' ');
			         if (fnm.length>1)requestorsNameList[rn]=fnm.join(' '); 
			   	  }  // for 	
					 
					  
				
				   if( delLeadingBlnks(document.myform.familyname.value)){kadem(0)}
					  else{
					 currentNameIdx=0;
					 document.myform.familyname.value=requestorsNameList[currentNameIdx];
					    }
							
			
			}			 



//--------------------------------------------------------------------------------------------------------   
  function setMoedForPrinting(){
    	simpleHideFieldSets();
	   moed=document.getElementById("moedPrint").selectedIndex;  
   }

//--------------------------------------------------------------------------------------------------------
function getNameList(){
   if ( ! moed){
	    Alert('בשלב סדור אולם יש לבחור חג');
			return;
			}

	url=encodeURI(firstPartOfURL+"/getlist/?$"+password+'$'+moedCodes[moed]+sidurUlam.toString()+'$'
	                       +sinunShlavB+'$'+sinunNotPaid+'$'+sinunDoneWith+'$'+yearToDisplay);		


         xhttp.open("GET", url, false);
         xhttp.send();
	       rspnsString1 = xhttp.responseText; 
         if(rspnsString1.substr(0,3)!='+++'){Alert('סיסמא שגויה. הכנס סיסמא נכונה');}
					 else { 
					 strr=delLeadingBlnks(rspnsString1.substr(3));
					 if( !strr) {Alert('אין מתפללים שעונים למאפייני הסינון'); return};
					 namesToAssign=strr.split('$'); 
					 for (rn=0; rn<namesToAssign.length; rn++){	   // normelise names
       	       fnm=namesToAssign[rn].split(' ');
			         if (fnm.length>1)namesToAssign[rn]=fnm.join(' '); 
			   	  }  // for 	
					 
									
				   if( delLeadingBlnks(document.myform.familyname.value)){kadem(0)}
					  else{
					 currentNameIdx=0;
					 document.myform.familyname.value=namesToAssign[currentNameIdx];
					 lastName=namesToAssign[currentNameIdx];


					      }
					 ckNameRtrvVlus(true);
					 		
					 }
return;

}

//--------------------------------------------------------------------------------------------------------

function getUnFilteredNameList(){
  yearToDisplay='';     //nextYear;  // the list of names that has to be handled is the most updated one

	url=encodeURI(firstPartOfURL+"/getFullList/?$"+password+'$'+yearToDisplay+'$'+LastYear);		


         xhttp.open("GET", url, false);
         xhttp.send();
	       rspnsString1 = xhttp.responseText; 
         if(rspnsString1.substr(0,3)!='+++'){Alert('סיסמא שגויה. הכנס סיסמא נכונה');}
					 else {
					 listOfNames=rspnsString1.substr(3).split('$');
				   listOfNames.sort();      
				   if( delLeadingBlnks(document.myform.famyname.value)){kademStsfction(0);}
								
					  else{
					 currentNameIdx=0;
					 document.myform.famyname.value=listOfNames[currentNameIdx];
					      }
					 		 getInfoForStsfction();			 		
					 }
return;

}


//--------------------------------------------------------------------------------------------------------

function getUnFilteredNameListForPP(){
  yearToDisplay='';     //nextYear;  // the list of names that has to be handled is the most updated one
 
	url=encodeURI(firstPartOfURL+"/getFullList/?$"+password+'$'+yearToDisplay+'$'+LastYear);		


         xhttp.open("GET", url, false);
         xhttp.send();
	       rspnsString1 = xhttp.responseText; 
         if(rspnsString1.substr(0,3)!='+++'){Alert('סיסמא שגויה. הכנס סיסמא נכונה');}
					 else {
					 listOfNames=rspnsString1.substr(3).split('$');
				   listOfNames.sort();      
				   if( delLeadingBlnks(document.myform.famlyname.value)){kademPersnlPrblms(0)} 
						 else{
					 currentNameIdx=0;
					 document.myform.famlyname.value=listOfNames[currentNameIdx];
					      }
					 		 getInfoForPrsnlPrblm()			 		
					 }
return;

}


  

//--------------------------------------------------------------------------------------------------------checkOnly
  function  nextname(){ 
	checkOnly= ! event.altKey;   // if alt key pressed==> donot ask; save!
	 noSaveNeeded=  svSeatAssignment(checkOnly,false);  // if saved, no more saving needed
	 if (noSaveNeeded){  
	         kadem(1);
					 return;
					 }
		funcNo=nxName;
	  funcYes=svAndNext;
		yesOrNo("האם ברצונך לשמור את הערכים ששונו?");			 
	}
	
//----------------------------------	
	function nxName(){ kadem(1)}
	
//--------------------------	
 function svAndNext(){
    saveSeatAssignment(true);
		kadem(1);
		}

//-----------------------------
	function kadem(zz){
	if ( nameToJumpBackTo) {
							    document.getElementById("fmName").value=nameToJumpBackTo;
			            document.getElementById("fmNameFloat").value=nameToJumpBackTo;
									nameToJumpBackTo='';
                  document.getElementById('fmName').onchange();
							    return;
									}  
									
	
	
	   mvCnt=zz;
	
	   if(  sidurUlam){listToUse=namesToAssign;}else listToUse=requestorsNameList;
		 
	   currentNamefound=false;
	   nameToSearch=delLeadingBlnks(document.myform.familyname.value);
		 for (tryIt=0;tryIt<2;tryIt++){ 
		  
		   for(currentNameIdx=0; currentNameIdx <listToUse.length; currentNameIdx++ ){
		     if (nameToSearch == delLeadingBlnks(listToUse[currentNameIdx])){
				       currentNamefound=true;
							 break;
							 }
			    }
					if(currentNamefound){
					    if( ! tryIt)lastName=nameToSearch;
							break;
							}
							
					mvCnt=0;		
					nameToSearch=lastName;   
					
			}		
			if( ! currentNamefound	){
			     Alert('הוקלד שם שגוי');
				//	  document.addEventListener('keyup', checkArrowPress );	
						}   else {
			 
		    
				   if(currentNameIdx < listToUse.length-mvCnt) currentNameIdx=currentNameIdx+mvCnt;    
				   document.myform.familyname.value=listToUse[currentNameIdx];
			//		 document.getElementById("fmNameFloat").value=namesToAssign[currentNameIdx];  
					 ckNameRtrvVlus(true); 
					 }
		}			       
	//--------------------------------------------------------------------------------------------------------  
	
	//--------------------------------------------------------------------------------------------------------
  function  prvname(){
	
	 checkOnly= ! event.altKey;   // if alt key pressed==> donot ask; save!
	 noSaveNeeded=  svSeatAssignment(checkOnly,false);  // if saved, no more saving needed
	 
	 
	 if (noSaveNeeded){
	               prvsname();
					 return;
					 }
		funcNo=prvsname;
	  funcYes=svAndPrvs;
		yesOrNo("האם ברצונך לשמור את הערכים ששונו?");			 
	}
	

//--------------------------	
 function svAndPrvs(){
    saveSeatAssignment(true);
		prvsname();
		}

//-----------------------------     
	function  prvsname(){
	     if ( nameToJumpBackTo) {
							    document.getElementById("fmName").value=nameToJumpBackTo;
			            document.getElementById("fmNameFloat").value=nameToJumpBackTo;
									nameToJumpBackTo='';
                  document.getElementById('fmName').onchange();
							    return;
									}  
									
	
	   	   if(  sidurUlam){listToUse=namesToAssign;}else listToUse=requestorsNameList;

		 
		mvCnt=1;
		 
		 currentNamefound=false;
		 
	nameToSearch=delLeadingBlnks(document.myform.familyname.value);
	for (tryIt=0;tryIt<2;tryIt++){ 	 
		 for(currentNameIdx=0; currentNameIdx <listToUse.length; currentNameIdx++ ){
		     if (nameToSearch == delLeadingBlnks(listToUse[currentNameIdx])){
				       currentNamefound=true;
							 break;
							 }
			   }
				 if(currentNamefound){
					    if( ! tryIt)lastName=nameToSearch;
							break;
							}
					nameToSearch=lastName;
					mvCnt=0;
			}		
			if( ! currentNamefound	){
			     Alert('הוקלד שם שגוי');
					//  document.addEventListener('keyup', checkArrowPress );	
						}  else {
			 
		    
				   if(currentNameIdx > 0) currentNameIdx=currentNameIdx-mvCnt;    
				   document.myform.familyname.value=listToUse[currentNameIdx];

					 ckNameRtrvVlus(true); 
					 }
		}			       		

//--------------------------------------------------------------------------------------------------------			 

function ckSaveAndMoveNextStsfction(){

  saveStsfctionVlusToArray(newStsfctionVlus);
  eqArrays=true;
  for (ijk=0;ijk<3;ijk++){
	          if ( stsfctionVlusFromServer[ijk] != newStsfctionVlus[ijk] )eqArrays=false;
	                }
	
	if(eqArrays) {		nextnameStsfction();   return; };
	funcNo=nextnameStsfction;
	funcYes=saveAndMoveNext;
		yesOrNo("האם ברצונך לשמור את הערכים ששונו?");

}
//--------------------------------------------------------------------------------------------------------			 

function ckSaveAndMovePrvsStsfction(){

  saveStsfctionVlusToArray(newStsfctionVlus);
  eqArrays=true;
  for (ijk=0;ijk<3;ijk++){
	          if ( stsfctionVlusFromServer[ijk] != newStsfctionVlus[ijk] )eqArrays=false;
	                }
	
	if(eqArrays) {prvnameStsfction(); return; };
	funcNo=prvnameStsfction;
	funcYes=saveAndMovePrvs;
		yesOrNo("האם ברצונך לשמור את הערכים ששונו?");

}

//--------------------------------------------------------------------------------------------------------	

//--------------------------------------------------------------------------------------------------------			 
		 

function ckSaveAndMoveNextPrsnlProblems(){

  savePrsnlProblemsVlusToArray(newprsnlProblemsVlus);
  eqArrays=true;
  for (ijk=0;ijk<5;ijk++){
	          if ( prsnlProblemsVlusFromServer[ijk] != newprsnlProblemsVlus[ijk] )eqArrays=false;
	                }
	
	if(eqArrays) {		nextnamePrsnlPrblms();   return; };
	funcNo=nextnamePrsnlPrblms;
	funcYes=saveAndMoveNextPP;
		yesOrNo("האם ברצונך לשמור את הערכים ששונו?");

}
//---------------------------------------------------------------------------------------------------------			 

function ckSaveAndMovePrvsPrsnlProblems(){

  savePrsnlProblemsVlusToArray(newprsnlProblemsVlus);
  eqArrays=true;
  for (ijk=0;ijk<5;ijk++){
	          if ( prsnlProblemsVlusFromServer[ijk] != newprsnlProblemsVlus[ijk] )eqArrays=false;
	                }
	
	if(eqArrays) {prvnamePrsnlPrblms(); return; };
	funcNo=prvnamePrsnlPrblms;
	funcYes=saveAndMovePrvsPP;
		yesOrNo("האם ברצונך לשמור את הערכים ששונו?");

}
//--------------------------------------------------------------------------------------------------------
  function saveAndMoveNext(){   
	  saveStsfctn();
		kademStsfction(1);
		}
//--------------------------------------------------------------------------------------------------------
 function saveAndMovePrvs(){   
	  saveStsfctn();
		prvnameStsfction();
		}
//--------------------------------------------------------------------------------------------------------
 function  nextnameStsfction(){
	
		kademStsfction(1);
	}  
	
	function kademStsfction(zz){
	
		 currentNamefound=false;
		 nam=delLeadingBlnks(document.myform.famyname.value);
		 for(currentNameIdx=0; currentNameIdx <listOfNames.length; currentNameIdx++ ){
		     if (nam == delLeadingBlnks(listOfNames[currentNameIdx])){
				       currentNamefound=true;
							 break;
							 }
			}
			if( ! currentNamefound	){
			     Alert('הוקלד שם שגוי');
			//		  document.addEventListener('keyup', checkArrowPress );	
						}   else {
			 
		    
				   if(currentNameIdx < listOfNames.length-zz) currentNameIdx=currentNameIdx+zz;    
				   document.myform.famyname.value=listOfNames[currentNameIdx];
					 getInfoForStsfction();
					 } 
		}			 


//--------------------------------------------------------------------------------------------------------  
 function  prvnameStsfction(){
	
	   
		
		 currentNamefound=false;
		 for(currentNameIdx=0; currentNameIdx <listOfNames.length; currentNameIdx++ ){
		     if (delLeadingBlnks(document.myform.famyname.value) == delLeadingBlnks(listOfNames[currentNameIdx])){
				       currentNamefound=true;
							 break;
							 }
			}
			if( ! currentNamefound	){
			     Alert('הוקלד שם שגוי');
					//  document.addEventListener('keyup', checkArrowPress );	
						}  else {
			 
		    
				   if(currentNameIdx > 0) currentNameIdx--;    
				   document.myform.famyname.value=listOfNames[currentNameIdx];
					 getInfoForStsfction();
					 }
		}			       		


//--------------------------------------------------------------------------------------------------------  
   function saveStsfctn(){
	 
	 nam=delLeadingBlnks(document.myform.famyname.value);
	 
	 lastYearStsfctnMen=document.myform.gvr_m1.value;
	 lastYearStsfctnWmn=document.myform.nashim_m1.value;
	 lastYearSeat=document.myform.mkishv_m1.value;
	 
	   if(   	( !lastYearStsfctnMen) || (!lastYearStsfctnWmn) || (!lastYearSeat)  )
				  { Alert('אנא מלא את בל השדות כמבוקש');return;} 
	   url=firstPartOfURL+'/saveStsfctionParams/?'+password+'$'+nam;
		 url=url+'$'+lastYearStsfctnMen.toString()+'$'+lastYearStsfctnWmn.toString()+'$'+lastYearSeat.toString()
		
	   url=encodeURI(url); 
 
     xhttp.open("GET", url, false);
     xhttp.send();
	   rspnsString1 = xhttp.responseText; 
     if(rspnsString1.substr(0,3)!='+++'){Alert('סיסמא שגויה. הכנס סיסמא נכונה');}
					 else {
					    	elmnt=document.getElementById('mkishv_m1');        
                elmnt.style.color='black';
								elmnt=document.getElementById('gvr_m1');           
                elmnt.style.color='black';
								elmnt=document.getElementById('nashim_m1');       
                elmnt.style.color='black';
					    saveStsfctionVlusToArray(stsfctionVlusFromServer);
					    Alert('נתונים נרשמו');
					 }
				
				             
	 
	 
	 }
//------------------------------------------------------------------------------------------------------ 
//-------------------------------------------------------------------------------------------------------- 
 function saveAndMoveNextPP(){   
	  savePrsnlPrblms();
		kademPersnlPrblms(1);
		}
//--------------------------------------------------------------------------------------------------------
 function saveAndMovePrvsPP(){   
	  savePrsnlPrblms();
		prvnamePrsnlPrblms();
		}
//--------------------------------------------------------------------------------------------------------
 function  nextnamePrsnlPrblms(){
	
		kademPersnlPrblms(1);
	}  
	
	function kademPersnlPrblms(zz){
	
		 currentNamefound=false;
		 nam=delLeadingBlnks(document.myform.famlyname.value);
		 for(currentNameIdx=0; currentNameIdx <listOfNames.length; currentNameIdx++ ){
		     if (nam == delLeadingBlnks(listOfNames[currentNameIdx])){
				       currentNamefound=true;
							 break;
							 }
			}
			if( ! currentNamefound	){
			     Alert('הוקלד שם שגוי');
			//		  document.addEventListener('keyup', checkArrowPress );	
						}   else {
			 
		    
				   if(currentNameIdx < listOfNames.length-zz) currentNameIdx=currentNameIdx+zz;    
				   document.myform.famlyname.value=listOfNames[currentNameIdx];
					 getInfoForPrsnlPrblm();
					 } 
		}			 


//--------------------------------------------------------------------------------------------------------  
 function  prvnamePrsnlPrblms(){
	
	   
		
		 currentNamefound=false;
		 for(currentNameIdx=0; currentNameIdx <listOfNames.length; currentNameIdx++ ){
		     if (delLeadingBlnks(document.myform.famlyname.value) == delLeadingBlnks(listOfNames[currentNameIdx])){
				       currentNamefound=true;
							 break;
							 }
			}
			if( ! currentNamefound	){
			     Alert('הוקלד שם שגוי');
					//  document.addEventListener('keyup', checkArrowPress );	
						}  else {
			 
		    
				   if(currentNameIdx > 0) currentNameIdx--;    
				   document.myform.famlyname.value=listOfNames[currentNameIdx];
					 getInfoForPrsnlPrblm();
					 }
		}			       		


//--------------------------------------------------------------------------------------------------------  
   function savePrsnlPrblms(){
	 
	 nam=delLeadingBlnks(document.myform.famlyname.value);
	 issueBetweenFloors=document.myform.beinKomot.value;
	 issueinFloorMen=document.myform.bekomaM.value;
	 issueInFloorWmn=document.myform.bekomaW.value;
	 
	 nashim_muadaf=document.myform.nashimMuadaf.value;
	 gvarim_muadaf=document.myform.gvarimMuadaf.value;
	   if(   ( !issueBetweenFloors) || (! issueinFloorMen) || ( ! issueInFloorWmn) )
				  { Alert('אנא מלא את בל השדות כמבוקש');return;} 
	   url=firstPartOfURL+'/savePrsnlPrblmsParams/?'+password+'$'+nam+'$'+issueBetweenFloors.toString()+'$';
		 url=url+issueinFloorMen.toString()+'$'+issueInFloorWmn.toString();
		 url=url+'$'+nashim_muadaf.toString()+'$'+gvarim_muadaf.toString();
	   url=encodeURI(url); 
 
     xhttp.open("GET", url, false);
     xhttp.send();
	   rspnsString1 = xhttp.responseText; 
     if(rspnsString1.substr(0,3)!='+++'){Alert('סיסמא שגויה. הכנס סיסמא נכונה');}
					 else {
					   savePrsnlProblemsVlusToArray(prsnlProblemsVlusFromServer);
					    Alert('נתונים נרשמו');
					 }
				
				             
	 
	 
	 }
//-------------------------------------------------------------------------------------------------------- 
//-------------------------------------------------------------------------------------------------------- 
	

function saveSeatAssignment(showPositiveConfirmation){  
    svSeatAssignment(false,showPositiveConfirmation);
		
		}

function svSeatAssignment(checkOnly,showPositiveConfirmation){		

  // if over assigned do not save
	overAssigned = false;
	if  ( Number(document.getElementById("mekomotGvarim").innerHTML) < 0)  overAssigned = true;
	if  ( Number(	document.getElementById("mekomotNashim").innerHTML) < 0)  overAssigned = true;
	
	
	
  originalListOfAssigned=originalListOfAssigned.sort(); 
	listOfAssignedSeats=listOfAssignedSeats.sort();
	listsAreTheSame=false;
	if(listOfAssignedSeats.length == originalListOfAssigned.length){
	   listsAreTheSame=true;
		 for(i=0; i < listOfAssignedSeats.length; i++){
		   if ( originalListOfAssigned[i] != listOfAssignedSeats[i]) {listsAreTheSame=false; break}
			         }
				}	
		if(	checkOnly)return listsAreTheSame;		 
		if(listsAreTheSame)return true;
		
		if(overAssigned) { Alert('הקצאה לא נרשמה. יותר מדי מקומות הוקצו'); return};
		strSeatsToUpdate=listOfAssignedSeats.join('+');  
		url=encodeURI(firstPartOfURL+"/updateAssignedSeats/?"+password+'$'+moedCodes[moed]+
		            document.myform.familyname.value+'$'+strSeatsToUpdate);
					
		xhttp.open("GET", url, false);
         xhttp.send();
	       rspnsString1 = xhttp.responseText;  
         if(rspnsString1.substr(0,3)=='999'){Alert('סיסמא שגויה. אנא הכנס סיסמא נכונה');}
				   else { if(rspnsString1.substr(0,3)=='---'){Alert('שגיאת מערכת. אנא נסה לצאת ולהכנס שוב')} 
					 else {
					    rishumButzaHight=60;
              rishumButzaWidth=200;		
	            w = window.innerWidth;
              h = window.innerHeight;		
	            rishumButzaElmnt=document.getElementById("rishumButza"); 
	            rishumButzaElmnt.style.height=rishumButzaHight;
	            rishumButzaElmnt.style.width=rishumButzaWidth;
            	rishumButzaElmnt.style.top=(h/2).toString()+'px';
	            rishumButzaElmnt.style.left=	((w-rishumButzaWidth)/2 ).toString()+'px';	
							if (showPositiveConfirmation){
							     rishumButzaElmnt.style.display='block';
							     setTimeout(turnOffRishumButza, 3000);
									 }	
	
					  //  Alert(' רישום בוצע');
							originalListOfAssigned=listOfAssignedSeats.slice(); 	
							          } //second else	
					 	}		;   // first else
					 
					 return true;			 				 
  }
//--------------------------------------------------------------------------------------------------------
function 	turnOffRishumButza(){
   document.getElementById("rishumButza").style.display='none';
	}
//--------------------------------------------------------------------------------------------------------
 function backToMain(){
 
 document.getElementById("hall1").style.display='none';
	 document.getElementById("hall2").style.display='none';
	 document.getElementById("hall3").style.display='none';
	// document.getElementById("ctrlFieldset").style.display='block';
	 document.getElementById("floatingDiv").style.display='none'; 
	 document.getElementById("shortFloatingDiv").style.display='none';
	 document.getElementById("mainFieldset").style.display='none';
	 
 
 
 }
//--------------------------------------------------------------------------------------------------------
 function chooseOperation(){
 
 if ( ! validPasswordEntered){
							                          Alert('יש להכניס סיסמא נכונה לפני שימוש בטופס');
																				document.myform.familyname.value='';
																				document.getElementById("pasw").focus();
																				return '999';
																				}
 
 
 if (document.getElementById("oprtion").selectedIndex == 0) return;

  simpleHideFieldSets();
  document.getElementById("reviww").style.display='none';
  document.getElementById("editt").style.display='none';
  document.getElementById("printt").style.display='none';
  document.getElementById("managing").style.display='none';
  document.getElementById("floatingDiv").style.display='none';
	document.getElementById("shortFloatingDiv").style.display='none';
	document.getElementById("mainFieldset").style.display='none';
	 document.getElementById("getstfction").style.display='none';
	 document.getElementById("prsnlProblems").style.display='none';
	  document.getElementById("reportAssgnmnts").style.display='none';
	
	if (document.getElementById("oprtion").selectedIndex < 3)document.getElementById("mainFieldset").style.display='block';
	if (document.getElementById("oprtion").selectedIndex == 2)document.getElementById("floatingDiv").style.display='block';
	if (document.getElementById("oprtion").selectedIndex == 1)document.getElementById("shortFloatingDiv").style.display='block';
 
	 operationID=document.getElementById("oprtion").value;
	yearToDisplay='';
	
   if(operationID == 'reviww'){
	                       selectList  =  document.getElementById("dsplayYear");
	                       yearToDisplay=selectList[selectList.selectedIndex].value;
			                   if (yearToDisplay == 'notChosen')yearToDisplay='';  
                          };
	
  if(operationID == 'reportAssgnmnts')genAssgnmentReport();


 operationID=document.getElementById("oprtion").value;
 document.getElementById(operationID).style.display='inline-block';
}


//--------------------------------------------------------------------------------------------------------
function genAssgnmentReport(){
  url=encodeURI(firstPartOfURL+"/getAssignmentReport/?"+password);  
              xhttp.open("GET", url, false);
              xhttp.send();
	            rspString = xhttp.responseText; 
	if (rspString.substr(0,3)=='---'){
	     document.getElementById("reportAssgnmnts").style.display='none';
	     Alert('יש להכניס סיסמא נכונה לפני שימוש בטופס');
			 return;}
		
		
	rspString=rspString.substr(3);
	if ( ! rspString ){
			 document.getElementById("reportAssgnmnts").style.display='none';
	     Alert('דו"ח הקצאות ריק');
			 return;}
			 
	
	names_values	= rspString.split('$');
		
	
	 deleteOldChildren('rprt_row');
	 
	 rprt_t_body=document.getElementById('rprt_body')
			 
	for (i=0; i<	names_values.length;i++){
	 new_table_row=document.createElement("tr");
	 new_table_row.setAttribute("id","rprt_row");
	 
	 reportValues=names_values[i].split('&');
	 new_td=document.createElement("td");
	 new_td.innerHTML= reportValues[0];
	 new_table_row.appendChild(new_td);
	   for (j=1;j <5; j++){
		   new_td=document.createElement("td");
    	 new_td.innerHTML= reportValues[j] + '/'+ reportValues[j+4];
			 new_table_row.appendChild(new_td);
			 }  // for j
	 
	 rprt_t_body.appendChild (new_table_row);
	 } //for i
	 
}

//--------------------------------------------------------------------------------------------------------createElement("div");  


  function stUpStsfctionInput(){
	simpleHideFieldSets();
	document.getElementById('getstfction').style.display='block';
	getUnFilteredNameList();
	
	
	}
//--------------------------------------------------------------------------------------------------------
  function stUpprsnlProblemsInput(){
	simpleHideFieldSets();
	document.getElementById('prsnlProblems').style.display='block';
	getUnFilteredNameListForPP();
	
	
	}

//-------------------------------------------------------------------------------------------------------- 
   function addANewMember(){
	   simpleHideFieldSets();
	   document.getElementById('addNewMember').style.display='block';
		 document.getElementById('addMemberHdr').style.display='block';
	   document.getElementById('addFirstName').style.display='none';
     addinFirstName=false;
				 
		 }

//-------------------------------------------------------------------------------------------------------- 



function empty(){};
//-------------------------------------------------------------------------------------------------------------  
function addMember(){
             lstNm=delLeadingBlnks(document.myform.newLastName.value);
             frstNm=delLeadingBlnks(document.myform.newFrstName.value);
						 
						 if (addinFirstName){  // adding first name to existing last name
						    if (  ( !frstNm) || ( !lstNm) ) return;
								
								url=encodeURI(firstPartOfURL+"/addFirstName/?&"+lstNm+'&'+frstNm+'&'+password);
							  xhttp.open("GET", url, false);
                xhttp.send();
	              rspnsString1 = xhttp.responseText; 
								if(rspnsString1.substr(0,3)=='+++'){
								  addANewMember();
									Alert('עכשיו ניתן לחזור ולהגדיר את החבר החדש');
									return;
									}
									Alert('שגיאה בהוספת שם פרטי');
							}		
						 
						 
						
						 ChaverOrTomechIdx=document.getElementById("isTomech").selectedIndex;  
						  if ( ( ! lstNm) || ( ! ChaverOrTomechIdx) ) return;
						 	mmbrshp=['0','3','0'][ChaverOrTomechIdx];							 
              url=encodeURI(firstPartOfURL+"/addMember/?&"+lstNm+'&'+frstNm+'&'+mmbrshp+'&'+password);
							
						
              xhttp.open("GET", url, false);
              xhttp.send();
	            rspnsString1 = xhttp.responseText; 
							
							if(rspnsString1.substr(0,3)== '--1'){Alert('שם המשפחה כבר קיים במערכת. אנא מלא שם פרטי'); return;};
							if(rspnsString1.substr(0,3)=='--2'){
							          document.getElementById('addMemberHdr').style.display='none';
	                      document.getElementById('addFirstName').style.display='block';
												addinFirstName=true;
												document.myform.newFrstName.value='';
												Alert('שם המשפחה הז כבר קיים במערכת ללא שם פרטי. כדי להוסיף עוד שם משפחה כזה יש להוסיף שם פרטי לשם המשפחה הקיים');
												return;
												};
              if(rspnsString1.substr(0,3)!='+++'){Alert('נסה שנית. בעיה ברישום');}
							   else Alert(lstNm+' '+frstNm+'  נוסף לרשימת המתפללים');

    
}
// ---------------------------------------------------------------------------------------- '/'
  function isPrintRequestValidNow(){
	if(! moed )return false;
	 
	document.myform.familyname.value='';
	document.getElementById("headerDiv").style.display='none';
  document.getElementById("mainFieldset").style.display='none';
  document.getElementById("ctrlFieldset").style.display='none';
	document.getElementById("hall1").style.display='none';
  document.getElementById("hall2").style.display='none';
  document.getElementById("hall3").style.display='none';

 deleteOldChildren('kk'); // delete previous tables.

 printingNow=true;
 printingMartef=false;
 printingRashi=false;
 printingNashim=false;
		return true;
		}


// ------------------------------------------------------------------------------------------

 function restoreFullMap(){
 printingNow=false;
  document.getElementById("mainFieldset").style.display='none'; 
 document.getElementById("headerDiv").style.display='block'; 
 document.getElementById("ctrlFieldset").style.display='block';
 document.getElementById("hall2").style.display='none';
document.getElementById("hall3").style.display='none';
document.getElementById("hall1").style.display='none';

document.getElementById("hall1Button").innerHTML='מרתף';
document.getElementById("hall2Button").innerHTML='אולם ראשי';
document.getElementById("hall3Button").innerHTML='עזרת נשים';

deleteOldChildren('prtFormt'); // delete previous tables.

 
}
// ------------------------------------------------------------------------------------------



function printMartef(){

if (! isPrintRequestValidNow()  ) {Alert('יש לבחור חג לפני בקשת הדפסה');  return;};

printingMartef=true;

elm=document.getElementById("hall1Button");
elm.onclick=restoreFullMap;
if(moed ==1){elm.innerHTML='<b>מרתף   ראש השנה</b>'}else elm.innerHTML='<b>מרתף   יום כפור</b>';


yearToDisplay='';

ckNameRtrvVlus(true); // generarte tables

prepareToPrint('m');

 }
 
// ---------------------------------------------------------------------------------------- 

function printUlamRashi(){

if (! isPrintRequestValidNow()  ) {Alert('יש לבחור חג לפני בקשת הדפסה');  return;};

printingRashi=true;

elm=document.getElementById("hall2Button");
elm.onclick=restoreFullMap;
if(moed ==1){elm.innerHTML='<b>אולם ראשי   ראש השנה</b>'}else elm.innerHTML='<b>אולם ראשי   יום כפור</b>';

yearToDisplay='';

ckNameRtrvVlus(true); // generarte tables

prepareToPrint('r');


 }
 
       

// ---------------------------------------------------------------------------------------- 

function printEzratNashim(){

if (! isPrintRequestValidNow()  ) {Alert('יש לבחור חג לפני בקשת הדפסה');  return;};


printingNashim=true;

elm=document.getElementById("hall3Button");
elm.onclick=restoreFullMap;
if(moed ==1){elm.innerHTML='<b>עזרת נשים   ראש השנה</b>'}else elm.innerHTML='<b>עזרת נשים   יום כפור</b>';

yearToDisplay='';

ckNameRtrvVlus(true); //  generarte tables

prepareToPrint('n');
 
 }
 
// ---------------------------------------------------------------------------------------- 

function prtPg(){};   // do nthing


// ---------------------------------------------------------------------------------------- 

function initNextYear(){

   if ( ! validPasswordEntered){
							                          Alert('יש להכניס סיסמא נכונה לפני שימוש בטופס');
																				return;
																				}
																				
		simpleHideFieldSets();
		funcNo=empty;
		funcYes=initNextYearfiles;
		yesOrNo("פעולה זו גורמת לסגירת השנה הנוכחית כך שאי אפשר יהיה לעדכן נתונים. האם להמשיך?");
}
function 	 initNextYearfiles(){
       var d = new Date();
	     nextYear=d.getFullYear();
			 currentMonth=Number(d.getMonth()); 
			 if (currentMonth > 9 )nextYear=Number(nextYear)+1;
			 LastYear=(nextYear-1).toString();
			 nextYear=nextYear.toString();
			 
		url=encodeURI(firstPartOfURL+'/initNextyearFiles/?'+password+'$'+nextYear);
		xhttp.open("GET", url, false);
		rspnsString='';
    xhttp.send();   
		
	
	  rspnsStrings = xhttp.responseText.split('$'); 
		if(rspnsStrings[0]=='999'){ Alert('בקשה נדחתה. סיסמא לא תקינה');	return};
		if ( rspnsStrings[0] == '900'){Alert('שנה זו כבר נפתחה בעבר'); return}
	if ( (rspnsStrings[0] == '+++') && (rspnsStrings[1] == '+++') && (rspnsStrings[2] == '+++')  ){
	             Alert('הקובץ אותחל');
							 initListOfYears();
						  return;
							} 
	if ( (rspnsStrings[0] == '+++') || (rspnsStrings[1] == '+++') || (rspnsStrings[2] == '+++')  ){Alert(' הקובץ אותחל חלקית בעבר');
	                                                                                               return} 
	
	 Alert('הקובץ לא אותחל. שגיאת מערכת');         

																		
																				
																				
	}	
//------------------------------------------------------------------------------------------


function executeDownload(){
   simpleHideFieldSets();
   selctdIndx=document.getElementById("downld").selectedIndex;
switch 	(selctdIndx) {  
				     				 
				     case 0:  
						        break;
						 case 1:  
						        download_supportTablesXLS(); 
						        break;				
						 case 2:  
						        download_seatsOrderedXLS(); 
						        break;
							case 3:
							      download_membersRequests();
						        break;
						}													
							  	
  }
	

	
// ---------------------------------------------------------------------------------------- 
	function download_supportTablesXLS(){
	
	 url=firstPartOfURL+'/dnldSupportTblsFile/?'+'-'+password; 
    downloadFile(url,'supportTables.xlsx');
	
	
	
	
	
	}
	
																			
// ----------------------------------------------------------------------------------------

function openCloseRegistration(){

if ( ! validPasswordEntered){
							                          Alert('יש להכניס סיסמא נכונה לפני שימוש בטופס');
																				return;
																				}
    
		simpleHideFieldSets();
		funcNo=empty;
		funcYes=openClose;
		yesOrNo("האם לשנות סטטוס סגירת הרשמה?");
}
function 	 openClose(){
   command='close'
	 if (  registrationClosed )command='open';
	  
		url=encodeURI(firstPartOfURL+'/closeOpen/?'+command+'-'+password);  
		xhttp.open("GET", url, false);
    xhttp.send();
	  rspnsString = xhttp.responseText.substr(0,3);
		if(rspnsString.substr(0,3)=='999'){ Alert('בקשה נדחתה. סיסמא לא תקינה');	}
	if ( rspnsString = '+++')displayRegistrationClosedStatus();         


}



//-----------------------------------------------------------------------------------------
	
function download_membersRequests(){
  url=firstPartOfURL+'/dnldRequests/?'+'-'+password;
    downloadFile(url,'membersRequests.xlsx');
		}
		
// -----------------------------------------------------------------------------------------
function download_seatsOrderedXLS(){
  url=firstPartOfURL+'/seatsOrderedXLS/?'+'-'+password;
    downloadFile(url,'seatsOrdered.xlsx');
}

// -----------------------------------------------------------------------------------------
		
		
		
	function downloadFile(url,filenameToLoad){	             

if ( ! validPasswordEntered){
							                          Alert('יש להכניס סיסמא נכונה לפני שימוש בטופס');
																				return;
																				}


xhttpDnld.open("GET", url, true);
xhttpDnld.responseType = "arraybuffer";

xhttpDnld.onload = function(oEvent) {
  var blob = new Blob([xhttpDnld.response], {type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});
  
	dnld(blob,filenameToLoad);
	
};

xhttpDnld.send();

}

   
function dnld(blob,filenameToLoad){
var a = window.document.createElement('a');

a.href = window.URL.createObjectURL(blob);
a.download = filenameToLoad;

// Append anchor to body.
document.body.appendChild(a);
a.click();

// Remove anchor from body
document.body.removeChild(a);

}			


// -----------------------------------------------------------------------------------------

function ckPassW(){
   paswElement=document.getElementById("pasw");
   password=delLeadingBlnks(paswElement.value);
  

 url=encodeURI(firstPartOfURL+"/ckpswMGMT/?"+password);
            xhttp.open("GET", url, false);
              xhttp.send();
	            rspnsString = xhttp.responseText;
							focusId=paswElement;
							
						
						if(rspnsString.substr(0,3)=='---'){
							
							  Alert ('סיסמא שגויה'); return
												         }
								 else  {
								       document.getElementById("paswDiv").style.display='none';  
								       	validPasswordEntered=true;
												document.getElementById("ctrlFieldset").style.display='block';
												document.getElementById("oprtion").focus();
	
	
	/*dbg
	url=encodeURI(firstPartOfURL+'/testStsfction/?'+password+'$0$40');  
		xhttp.open("GET", url, false);
    xhttp.send();
	  rspnsString = xhttp.responseText.substr(0,3);
		*/						
	                      }
	}   
	
// ----------------------------------------------------------------------------------------- 
  function copyFamilyNameFloat(){
	 
	 if(document.getElementById("fmName").value!= delLeadingBlnks(document.getElementById("fmNameFloat").value))
	    document.getElementById("fmName").value = delLeadingBlnks(document.getElementById("fmNameFloat").value);
     document.getElementById('fmName').onkeyup();
  }
// -----------------------------------------------------------------------------------------
  function copyFamilyName(){
	 
	 if(document.getElementById("fmName").value!= delLeadingBlnks(document.getElementById("fmNameFloat").value))
	    document.getElementById("fmName").value = delLeadingBlnks(document.getElementById("fmNameFloat").value);
     document.getElementById('fmName').onchange();
  }
// -----------------------------------------------------------------------------------------
 function ckInpVld(inpId,minV,maxV,isInt){
 vlu=document.getElementById(inpId).value;
 if(vlu<minV)vlu=minV;
 if(vlu>maxV)vlu=maxV;
 if(isInt)vlu=Math.floor(vlu);
 document.getElementById(inpId).value=vlu;
  
 }
// ----------------------------------------------------------------------------------------------	
function clrFmName(){
if ( ! nameToJumpBackTo ){
         if(lastNameChecked==document.getElementById("fmName").value)
                  				 nameToJumpBackTo=delLeadingBlnks(document.hiddenForm.lastFamName.value);
					}								 
document.getElementById("fmName").value='';
document.getElementById("fmNameFloat").value='';

tmp1= document.getElementById("prtitxt");
		tmp1.style.display='none';

}

// -----------------------------------------------------------------------------------------

function explnArrows(onOrOff){
var msgId;
var tmp;
if (document.getElementById("oprtion").selectedIndex == 2){msgId='explnArrow1';} else msgId='explnArrow2';
tmp=document.getElementById(msgId);
 if (onOrOff){tmp.style.visibility='visible';}else tmp.style.visibility='hidden';
 }

// -----------------------------------------------------------------------------------------
function explnAddMember(onOrOff){
var msgId;
var tmp;
 msgId='explnAddMember';  
tmp=document.getElementById(msgId);
 if (onOrOff){tmp.style.visibility='visible';}else tmp.style.visibility='hidden';
 }




// -----------------------------------------------------------------------------------------
                			
                			
</script>
</head>
<body onload="initPage()" >

<div id="dialogoverlay"></div>
<div id="dialogbox">
  <div>
    <div id="dialogboxhead"></div>
    <div id="dialogboxbody"></div>
    <div><span id="dialogboxfoot"> </span><span id ="dialogboxfootLeft" style='display:inline; float:left'></span>  </div>
</div></div>

<div id='dbg' style='position:fixed; top:10; left:20; direction:ltr;display:none; '> x= <span id='dbgx'></span> &nbsp &nbsp y= <span id='dbgy'></span></div>
 


<form name="myform" id='myForm'     >
<div id='copyAssignment' style='display:none;border-style:  solid; border-width: 2px;position:fixed;padding: 5px;z-index:4;opacity:0.9;
width:100px;color:blue'   onclick='copyFromRosh()'> העתק הצבות <br>ראש השנה</div>
<div id='rishumButza' style='border-style: solid; border-color:green;border-width: 2px;position:fixed;padding:5px; color:green;z-index:15;display:none;font-size:40'><b>רישום בוצע</b></div>

<div id='floatingDiv' style='display:none;border-style:  solid; border-width: 2px;position:fixed;padding: 5px;z-index:4;opacity:0.9'>

<label for="familynameFloat">שם משפחה</label>
									<button  type="button" id='prvsFloat' onclick= 'prvname()' style='display:inline-block;height:30px;font-size:22px'> &#x2192 </button>
		 <table id='FmNmT1'><tbody ><tr><td id='firstX' onclick='clrFmName()'>&nbsp x &nbsp</td><td><input type="text" name="familynameFloat" id="fmNameFloat"  onchange='copyFamilyName()' onkeyup='copyFamilyNameFloat()' style='width:180px'> </td></tr><tbody></table>
     
					 
					<button  type="button" id='nextFloat' onclick= 'nextname()' style='display:inline-block;height:30px;font-size:22px'> &#x2190 </button>

       <button  type="button" id='shmor' onclick= 'saveSeatAssignment(true)' style='display:inline-block;height:30px;font-size:18px'> שמור  הקצאה </button>

 &nbsp 
		   <table  style="direction:ltr;display:inline">
			 <thead > <tr> <th> &nbsp &nbsp 0 &nbsp &nbsp </th> <th> &nbsp &nbsp <1 &nbsp   </th> <th> &nbsp &nbsp 1 &nbsp &nbsp </th> 
			 <th> &nbsp &nbsp <2 &nbsp </th> <th> &nbsp &nbsp  2 &nbsp &nbsp </th> 
			 <th>&nbsp &nbsp  <3 &nbsp </th> <th>&nbsp &nbsp 3 &nbsp &nbsp  </th> <th> &nbsp &nbsp >3 &nbsp </th></tr></thead>
			 <tbody>
			 <tr>
			 <td > &nbsp </td>  <td style="background:rgba(190,190,190,0.6)"> &nbsp </td>
			 <td style="background:rgba(0,0,255,1)"> &nbsp </td>    <td style="background:rgba(0,255,0,1)"> &nbsp </td>
			 <td style="background:rgba(255,255,0,1)"> &nbsp </td>   <td style="background:rgba(255,165,0,1)"> &nbsp </td>
			 <td style="background:rgba(255,0,0,1)"> &nbsp </td>    <td style="background:rgba(139,0,0,1)"> &nbsp </td>    </tr>
			 </tbody>  </table>
&nbsp &nbsp &nbsp 
       <button  type="button"  onclick= 'displayAssignmentCounters()' style='display:inline-block;height:30px;font-size:18px'> הצג מונים  </button>
<span>  &nbsp הוקצו: גב'= </span> <span id='menReqst'>0</span><span><b>  /  </b></span><span id='menToAssgn' style="direction:ltr">0</span>
<span>&nbsp &nbsp נש'=</span><span id='womenRqst'>0</span><span><b>  / </b></span><span id='womenToAssgn' style="direction:ltr">0</span>
			 
</div>

<div id='shortFloatingDiv' style='border-style: solid; display:none; border-width: 2px;position:fixed;padding: 5px;z-index:4;opacity:0.9'>



&nbsp &nbsp 
		   <table  style="direction:ltr;display:inline">
			 <thead > <tr> <th> &nbsp &nbsp 0 &nbsp &nbsp </th> <th> &nbsp &nbsp <1 &nbsp   </th> <th> &nbsp &nbsp 1 &nbsp &nbsp </th> 
			 <th> &nbsp &nbsp <2 &nbsp </th> <th> &nbsp &nbsp  2 &nbsp &nbsp </th> 
			 <th>&nbsp &nbsp  <3 &nbsp </th> <th>&nbsp &nbsp 3 &nbsp &nbsp  </th> <th> &nbsp &nbsp >3 &nbsp </th></tr></thead>
			 <tbody>
			 <tr>
			 <td > &nbsp </td>  <td style="background:rgba(190,190,190,0.6)"> &nbsp </td>
			 <td style="background:rgba(0,0,255,1)"> &nbsp </td>    <td style="background:rgba(0,255,0,1)"> &nbsp </td>
			 <td style="background:rgba(255,255,0,1)"> &nbsp </td>   <td style="background:rgba(255,165,0,1)"> &nbsp </td>
			 <td style="background:rgba(255,0,0,1)"> &nbsp </td>    <td style="background:rgba(139,0,0,1)"> &nbsp </td>    </tr>
			 </tbody>  </table>
			 &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp

       <button  type="button"  onclick= 'displayAssignmentCounters()' style='display:inline-block;height:30px;font-size:22px'> הצג מוני הקצאות </button>

			 
</div>



<div id='seatcounters' style='color:green;font-size:19; display:none; border-style: solid; border-width: 2px;position:fixed;padding: 5px;z-index:11;'  onclick='DoNot_displayAssignmentCounters()'>
<div>מספר המקומות הכולל לנשים בעזרת נשים ובאולם הראשי הוא &nbsp <span id='avlblSeats1'></span> &nbsp ולגברים באולם הראשי הוא &nbsp  <span id='avlblSeats0'> &nbsp </span>
<br> מספר המקומות הכולל לנשים במרתף הוא &nbsp <span id='avlblSeats3'></span> &nbsp ולגברים  הוא &nbsp  <apan id='avlblSeats2'> &nbsp </span></div>

<div>בראש השנה הוקצו לנשים בעזרת נשים ובאולם הראשי  &nbsp <span id='avlblSeats5'></span> &nbsp ולגברים באולם הראשי  &nbsp  <span id='avlblSeats4'> &nbsp </span>
&nbsp &nbsp &nbsp &nbsp &nbsp ובמרתף לנשים   &nbsp <span id='avlblSeats9'></span> &nbsp ולגברים   &nbsp  <apan id='avlblSeats8'> &nbsp </span></div>


<div> &nbsp ביום כפור  הוקצו לנשים בעזרת נשים ובאולם הראשי  &nbsp <span id='avlblSeats7'></span> &nbsp ולגברים באולם הראשי  &nbsp  <span id='avlblSeats6'> &nbsp </span>
&nbsp &nbsp &nbsp &nbsp &nbsp ובמרתף לנשים   &nbsp <span id='avlblSeats11'></span> &nbsp ולגברים   &nbsp  <apan id='avlblSeats10'> &nbsp </span></div>
 
<div> &nbsp למרתף כוונו  &nbsp <span id='avlblSeats12'></span> מקומות לגברים ו-<span id='avlblSeats13'></span> &nbsp לנשים. 
 לאולם הראשי כוונו    &nbsp <span id='avlblSeats14'></span> מקומות לגברים ו-<span id='avlblSeats15'></span> &nbsp לנשים.</div>
 
 <div> &nbsp &nbsp  עדין לא הושלמה הקצאה לראש השנה ל- <span id='avlblSeats16'></span>  &nbsp משפחות, וליום כפור ל- <span id='avlblSeats17'></span>  &nbsp משפחות</div>
 <div>&nbsp <br> </div>
</div>


<div id='headerDiv'>
<h1 style="color:blue; font-size:200%;text-align:center"><b><u>בית כנסת אריאל</u></b> </h1>
<h1 style="font-size:150%;text-align:center"><b><u>הזמנת מקומות לימים נוראים תשע"ח</u></b> </h1>
<div id='paswDiv' >סיסמא:<input id='pasw' type="password" style="display:inline-block"  autofocus onchange='ckPassW()'> </div> <br>
</div>


<fieldset style="width:1200px; display:none" name='ctrlFieldset' id='ctrlFieldset'>
<div  style="width:1200px">
<select id='oprtion'  name='oprtion' onchange="chooseOperation()" style='font-size:20px'>     
							                            <option value="notChosen">בחר/י פעולה</option> 
																					<option value="reviww">סקירה</option>           
																			    <option value="editt">עריכה</option> 
																				  <option value="printt">הדפסה</option> 	
																					<option value="managing">נהול מערכת</option>
																					<option value="reportAssgnmnts">דו"ח הקצאות לטיפול</option> 	
																					
											</select>	
	
<div id=	"reportAssgnmnts"	style='display:none;width:1000px'>
<table  style="direction:rtl;display:inline;border-collapse: collapse;">
			 <thead > <tr> <th> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp שם &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp</th> <th> &nbsp &nbsp גברים ראש &nbsp   </th> <th> &nbsp &nbsp נשים ראש &nbsp &nbsp </th> 
			 <th> &nbsp &nbsp גברים כפור &nbsp </th> <th> &nbsp &nbsp  נשים כפור &nbsp &nbsp </th> </tr></thead>
			 
			 <tbody id='rprt_body'>
			 <tr id='rprt_row'>
			 <td id ='rprt_name'> &nbsp </td>  <td id='rprt_men_rosh' > &nbsp </td>  <td id='rprt_wmn_rosh'> &nbsp </td>
			       <td id='rprt_men_kipur' > &nbsp </td> <td id='rprt_wmn_kipur'> &nbsp </td>
			 </tr>
			 </tbody>
	</table>	
	
	<br><br>	 
<div style='color:red'> הסבר: הערך השמאלי הוא המבוקש והימני הוא המוקצה   </div>

</div>		
	
	
<div id=	"reviww"	style='display:none;width:1000px'>										
 <select id='moed1'  name='moed1' style='font-size:20px'>
							                            <option value="notChosen">בחר/י חג</option> 
																					<option value="rosh">ראש השנה</option>           
																			    <option value="kipur">יום  כפור</option> 
																				  <option value="all">ימים נוראים</option> 	
											</select>	
	<select id='dsplayYear'  name='dsplayYear' style='font-size:20px' >
							                            <option value="notChosen">שנה נוכחית</option> 
																						
											</select>											
	 <button  type="button" id='makeSelection' onclick= 'selectionMade("1")' style='display:inline;float:left'> <h3>החל בחירה </h3></button>&nbsp  
							
	</div>
	
	
<div id=	"editt"	style='display:none;width:1000px'>										
 <select id='moed2'  name='moed2' style='font-size:20px'>
							                            <option value="notChosen">בחר/י חג</option> 
																					<option value="rosh">ראש השנה</option>           
																			    <option value="kipur">יום  כפור</option> 
																				  <option value="all">ימים נוראים</option> 	
											</select>		
											 
<span> &nbsp &nbsp  </span>
<select id='ulamLesidur'  name='ulamLesidur'  style='font-size:20px'>
							                            <option value="notChosen">בחר/י אולם לסדור מקומות</option> 
																					<option value="UlamRashi">אולם ראשי</option> 
																				  <option value="Martef">מרתף</option> 
																					<option value="noUlamFilter+">כל האולמות</option>  	
											</select>	
											
<span style='font-size:25px'> &nbsp    הצג:</span>
<input type="checkbox"  name="sinun" value="scndPhase"  style='font-size:20px'> <span style='font-size:20px'>שלב ב </span>
<span style='font-size:25px'> &nbsp </span>
  <input type="checkbox"  name="sinun" value="notPaid"  style='display:inline' > <span style='font-size:20px'>נרשמים שלא שלמו </span>
	
	<span style='font-size:25px'> &nbsp  </span>
  <input type="checkbox"  name="sinun" value="doneWith"  style='display:inline' > <span style='font-size:20px'>נרשמים שבקשתם מולאה </span>

 <button  type="button" id='makeSelection1' onclick= 'selectionMade("2")' style='display:inline;float:left'> <h3>החל בחירה </h3></button>&nbsp  

</div>	

<div id=	"printt"	style='display:none'>	<span style='font-size:25px'> &nbsp &nbsp &nbsp &nbsp </span>
                    <select id='moedPrint'  name='moedPrint' style='font-size:20px' onchange='setMoedForPrinting()'>
							                            <option value="notChosen">בחר/י חג</option> 
																					<option value="rosh">ראש השנה</option>           
																			    <option value="kipur">יום  כפור</option> 
																				  <option value="all">ימים נוראים</option> 	
											</select>	
											<span style='font-size:25px'>  &nbsp &nbsp </span>
          <button  type="button" id='prtMrtf' onclick= 'printMartef()' > <h3>הדפס מרתף </h3></button>
					<button  type="button" id='prtRashi' onclick= 'printUlamRashi()'> <h3>הדפס אולם ראשי </h3></button>
					<button  type="button" id='prtNashim' onclick= 'printEzratNashim()' > <h3>הדפס עזרת נשים </h3></button>&nbsp 

</div>

<div id=	"managing"	style='display:none'>
<span style='margin: auto; text-align:left; float:left'> &nbsp &nbsp &nbsp &nbsp &nbsp
	<button  type="button"  onclick= 'openCloseRegistration()' style='display:inline-block;'> <h3 id='openclose'>  </h3><h5 id='openclose_2'></h5></button> 
 	 <span> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  </span>
	<button  type="button"  onclick= 'initNextYear()' style='display:inline-block;'> <h3>פתח שנה חדשה  </h3></button>
 <span> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  </span>
<select id='downld'  name='downld'  style='font-size:20px;'display:inline-block;'>     
							                            <option value="notChosen">בחר/י קובץ להורדה</option> 
																					<option value="supportTables">קובץ נתונים בסיסיים</option>          
																			    <option value="seatsOrdered">קובץ רשימת הזמנות</option> 
																				  <option value="membersRequests">קובץ בקשות</option> 	
													</select>	
 
 
<button  type="button"  onclick= 'executeDownload()' style='display:inline-block;'> <h3>הורד קובץ  </h3></button> 
<span> &nbsp &nbsp &nbsp &nbsp  </span>
<button  type="button"  onclick= 'stUpStsfctionInput()' style='display:inline-block;'> <h3>מלא נתוני <br> שביעות רצון </h3></button> 
<span> &nbsp &nbsp &nbsp &nbsp  </span>
<button  type="button"  onclick= 'stUpprsnlProblemsInput()' style='display:inline-block;'> <h3>מלא נתוני <br> בעיות אישיות </h3></button> 
<span> &nbsp &nbsp &nbsp &nbsp  </span>
<button  type="button"  onclick= 'addANewMember()' style='display:inline-block;'> <h3>הוסף חבר </h3></button> 
 </span>
</div>


<span> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  </span>
 
									 

</div>

</fieldset>



<fieldset id='addNewMember' style='display:none'>
<h2 style='color:brown' id='addMemberHdr'> הוספת חבר/תומך חדש

 	<span style='font-size:22px;border:1px dotted' onmouseover="explnAddMember(true)" onmouseout="explnAddMember(false)"> &nbsp ? &nbsp </span>
<br> </h2>
<h2 style='color:brown' id='addFirstName'> הוספת שם פרטי לחבר/תומך קיים </h2>
  <div>  הכנס שם משפחה:
		      <input type="text" name="newLastName" id="newLastName" style='width:200px' > 
					<span> &nbsp &nbsp  &nbsp &nbsp </span>

					הכנס שם פרטי
					<input type="text" name="newFrstName" id="newFrstName"  style='width:200px'> 
										<span> &nbsp &nbsp &nbsp &nbsp  </span>

          <select id='isTomech'  name='isTomech'  style='font-size:20px;'display:inline-block;'>     
							                            <option value="notChosen">האם חבר או תומך?</option> 
																					<option value="chaver">חבר</option>           
																			    <option value="tomech">תומך</option> 
													</select>	
																		<span> &nbsp &nbsp  &nbsp &nbsp </span>

<button  type="button"  onclick= 'addMember()' style='display:inline-block;'> <h3>הוסף  </h3></button> 

</div>

<div id='explnAddMember'> 
החברים במערכת מזוהים על פי שמם<br>
עבור רוב החברים מספיק שם המשפחה על מנת לזהות אותם ולכן רק שם המשפחה רשום במערכת.<br>
כדי לזהות באופן חד ערכי את החברים החולקים שם משפחה עם חברים אחרים (למשל פרנקל), יש צורך לרשום במערכת גם את השם הפרטי<br>
לכן, אם מוסיפים חבר חדש שיש לו שם משפחה שכבר קיים במערכת, יתכנו שני תרחישים:<br>
1. כבר קיימים במערכת שני חברים או יותר להם אותו שם משפחה. במקרה הזה המערכת תבקש גם את שם המשפחה וגם את השם הפרטי של החבר החדש<br>
2. אם קיים רק חבר אחד במערכת שלו אותו שם משפחה הזהה לשם המשפחה של החבר אותו רוצים להוסיף, כדי לאפשר לזהות באופן חד ערכי גם את החבר 
<br> &nbsp &nbsp &nbsp הקיים וגם את החבר החדש, המערכת תבקש קודם להוסיף שם פרטי לחבר הקיים ורק אחר כך תאפשר הוספת החבר החדש
</div>  

</fieldset>		 

<fieldset id='getstfction'   style='display:none'>
<div >
<div>
  <label for="famyname">שם משפחה</label>
									<button  type="button" id='prvs' onclick= 'ckSaveAndMovePrvsStsfction()' style='display:inline-block;height:30px;font-size:22px'> &#x2192 </button>
		      <input type="text" name="famyname" id="fmName1" required onchange='getInfoForStsfction()'> 
					<button  type="button" id='next' onclick= 'ckSaveAndMoveNextStsfction()' style='display:inline-block;height:30px;font-size:22px'> &#x2190 </button>
 </div>  
	<br>
	<div><h2><u>פרטי בקשה (נתוני שנה שעברה) </u></h2></div>
	<div>     
              
	<table>
	
	<thead> 	<tr> 	<th>    </th><th>ראש השנה</th><th>יום כפור</th> </tr>  </thead> 
	<tbody id='misparMekomot'>  
	 <tr>  <td>גברים</td> <td><span id="menRoshStsfctn" ></span></td><td><span id="menkipurStsfctn" ></span></td></tr>
	 <tr>  <td>נשים</td> <td><span id="womenRoshStsfctn" ></span></td><td><span id="womenkipurStsfctn" ></span></td></tr> 
	</tbody>
	</table>
	<br>
	<div ><u>מנין מועדף - נשים  : </u>  <span id='minyanWSStsfctn'></span>    </div>	
	<div ><u>מנין מועדף - גברים  : </u>  <span id='minyanMSStsfctn'></span>    </div>	   
	<br>
		
	<div  id='RmoreCommentsStsfctn' style='display:invisible' ><u>הערות ובקשות נוספות: </u>&nbsp &nbsp &nbsp <span id='rCmntsStsfctn'  ></span></div><br>
		</div>	  
	<div style='color:Red'><h2><u>יש למלא ערכים בכל התאים הצבועים תכלת</u></h2><div> 	

	</div><h2> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp טבלת שביעות רצון</h2></div>
<table id='stsfctnTbl' >
			 <thead> <tr> <th> &nbsp &nbsp &nbsp &nbsp </th> <th> &nbsp גברים &nbsp  &nbsp   </th> <th> &nbsp &nbsp נשים &nbsp &nbsp </th> 
			 <th> &nbsp מקום ישיבה &nbsp &nbsp </th>    </tr></thead>
			 <tbody>
			
			 <tr> <td > לפני 3 שנים </td>  <td id='gvr_m3'> &nbsp </td> <td id='nashim_m3'> &nbsp </td> <td id='mkishv_m3'> &nbsp </td></tr>
			 <tr> <td > לפני 2 שנים </td>  <td id='gvr_m2'> &nbsp </td> <td id='nashim_m2'> &nbsp </td> <td id='mkishv_m2'> &nbsp </td></tr>
			 <tr height:'5px'> <td > לפני שנה </td>  <td > <input id='gvr_m1' name='gvr_m1' style='background:lightBlue;font-size:16px;width:56px;padding:0px;text-align:center' type="number" onchange='ckInpVld("gvr_m1",0,10,false)'  >
			          </td> <td ><input id='nashim_m1' name='nashim_m1' style='background:lightBlue;font-size:16px;width:60px;padding:0px;text-align:center'   type="number" onchange='ckInpVld("nashim_m1",0,10,false)'  >
								</td> <td > <input id='mkishv_m1' name='mkishv_m1' style='background:lightBlue;font-size:16px;width:90px;padding:0px;text-align:center'   type="number" onchange='ckInpVld("mkishv_m1",0,1,false)'  > </td>
														</tr>
			 </tbody>  </table>

</div>  

<div><h3  >ותק מעודכן: <span id='vetek' ></span></h3></div><br>

<br><br>
	<button  type="button" id='saveStsfct1' onclick= 'saveStsfctn()' style='display:block;height:30px;font-size:22px' > שמור ערכים</button>



</div>	


<div id='calculatedStsfctn' style='display:none'>
<div><h3> &nbsp &nbsp ערכי  שביעות רצון מחושבים</h3></div>
<table> 
<thead> <tr>  <th> &nbsp גברים &nbsp  &nbsp   </th> <th> &nbsp &nbsp נשים &nbsp &nbsp </th> 
			 <th> &nbsp מקום ישיבה &nbsp &nbsp </th>    </tr></thead>
<tbody>
<tr height:'5px'>   <td  id='calcGvr_m1'  style='background:LightSlateGray;font-size:16px;width:56px;padding:0px;text-align:center'   >5 </td>
			              <td  id='calcNashim_m1'  style='background:LightSlateGray;font-size:16px;width:60px;padding:0px;text-align:center'   > 6</td>
								    <td  id='calcMkishv_m1'  style='background:LightSlateGray;font-size:16px;width:90px;padding:0px;text-align:center'    > 7</td>
														</tr>		
	</tbody>  </table>	 
</div>


</fieldset>



<fieldset id='prsnlProblems'   style='display:none'>
<div >
<div>
  <label for="famlyname">שם משפחה</label>
									<button  type="button" id='prvsPrsnl' onclick= 'ckSaveAndMovePrvsPrsnlProblems()' style='display:inline-block;height:30px;font-size:22px'> &#x2192 </button>
		      <input type="text" name="famlyname" id="fmName11" required onchange='getInfoForPrsnlPrblm()'> 
					<button  type="button" id='nextPrsnl' onclick= 'ckSaveAndMoveNextPrsnlProblems()' style='display:inline-block;height:30px;font-size:22px'> &#x2190 </button>
 </div>  
	<br>
	<div><h2><u>פרטי בקשה  </u></h2></div>
	<div>     
              
	
	 
	 
	<table>
	
	<thead> 	<tr> 	<th>    </th><th>ראש השנה</th><th>יום כפור</th> </tr>  </thead> 
	<tbody id='misparMekomot'>  
	 <tr>  <td>גברים</td> <td><span id="menRoshPrsnlProblems" ></span></td><td><span id="menkipurPrsnlProblems" ></span></td></tr>
	 <tr>  <td>נשים</td> <td><span id="womenRoshPrsnlProblems" ></span></td><td><span id="womenkipurPrsnlProblems" ></span></td></tr> 
	</tbody>
	</table>
	<br>
	<div ><u>מנין מועדף - נשים  : </u>  <span id='minyanWSPrsnlProblems'></span>    </div>	
	<div ><u>מנין מועדף - גברים  : </u>  <span id='minyanMSPrsnlProblems'></span>    </div>	   
	<br>
		
	<div  id='RmoreCommentsPrsnlProblems' style='display:invisible' ><u>הערות ובקשות נוספות: </u>&nbsp &nbsp &nbsp <span id='rCmntsPrsnlProblems'  ></span></div><br>
		</div>	  
	<div style='color:Red'><h2><u>יש למלא ערכים בכל התאים הצבועים תכלת</u></h2><div> 	
<div><h3 style='color:black' >נא מלא מניין מועדף (1-אולם ראשי, 2-מרתף, 3-לא משנה).  נשים:  <input id='nashimMuadaf' name='nashimMuadaf' style='background:lightBlue;width:30px;height:22px;padding:0px;font-size:16px' 
                                         type="number" onchange='ckInpVld("nashimMuadaf",1,3,true)'>
       &nbsp &nbsp &nbsp גברים:  <input id='gvarimMuadaf' name='gvarimMuadaf' style='background:lightBlue;width:32px;height:23px;padding:0px;font-size:16px'  
			                 type="number" onchange='ckInpVld("gvarimMuadaf",1,3,true)'> </h3></div><br>		
	 

<div><h3  >ותק מעודכן: <span id='vetekPP' ></span></h3></div><br>
<div>בעיה אישית בין קומות:  <input    type="number" name="beinKomot" id='beinKomot'  style='background:lightBlue;width:40px;font-size:16px' onchange='ckInpVld("beinKomot",0,1,true)'></div>
<div>בעיה אישית בתוך קומה. גברים:  <input style='background:lightBlue;width:40px;font-size:16px'   type="number" id='bekomaM' name="bekomaM" onchange='ckInpVld("bekomaM",0,1,true)'> &nbsp &nbsp נשים: 
             <input style='background:lightBlue;width:40px;font-size:16px'   type="number" name="bekomaW" id='bekomaW' onchange='ckInpVld("bekomaW",0,1,true)'></div>
<br><br>
	<button  type="button" id='savePrsnlProblems' onclick= 'savePrsnlPrblms()' style='display:block;height:30px;font-size:22px' > שמור ערכים</button>



</div>	


</fieldset>







	 <fieldset style="width:1200px; display:none" id='mainFieldset'   >   
	<div>     
                  <label for="familyname">שם משפחה</label>
		<button  type="button" id='prvs1' onclick= 'prvname()' style='display:inline-block;height:30px;font-size:22px'> &#x2192 </button>
	 <table id='FmNmT2'><tbody ><tr><td id='secondX' onclick='clrFmName()'>&nbsp x &nbsp</td><td><input type="text" name="familyname" id="fmName"  required onkeyup='getNamesForCompletion(true)' onchange='ckNameRtrvVlus(true)' style='width:250px'> </td></tr><tbody></table>

				  <button  type="button" id='next1' onclick= 'nextname()' style='display:inline-block;height:30px;font-size:22px'> &#x2190 </button>
					<span style='font-size:22px;border:1px dotted' onmouseover="explnArrows(true)" onmouseout="explnArrows(false)"> &nbsp ? &nbsp </span>
<div id='prtitxt' style='display:none'> <span> &nbsp &nbsp &nbsp</span> 
						<select id='prti'  name='prti' onchange="inputCompletion()">
							                            <option value="0" >השלם </option>  
																					<option value="0" > &nbsp </option>         
																			    <option value="1" > &nbsp </option> 
																				  <option value="2" > &nbsp </option> 	
											</select>	
											</div>	
 
					
					</div>
					<div>
                <span style='font-size:25px'> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </span>
								
					</div>
					<br><br>
	<div id='isClosed' style="color:red; font-size:130%;text-align:center;display:none"><b><u>בקשה זו נרשמה לאחר סגירת ההרשמה, ב </u> </b> 
	<div id='isClosedDate' style='display:inline-block;direction:ltr'> </div> </div>
	<div style='font-size:19px' id='details'>				      
								<label for="reqemail">מייל:</label>
		      <div name="reqemail" id='reqemail' style="display:inline-block" ></div> <span> &nbsp &nbsp &nbsp &nbsp </span>
                  <label for="reqmobile">טלפון  :</label>
		      <div name="reqmobile" id='reqmobile' style="display:inline-block" ></div> <span> &nbsp &nbsp &nbsp &nbsp </span>
                  <label for="reqaddress" >כתובת:</label>
          <div  name="reqaddress" id='reqaddress' style="display:inline-block"></div> 
								
	<br>
	<div> <h3> סכום לתשלום: <span id ='letashlum'></span> </h3> </div>
	
        
	<p><u>מספר מקומות מבוקש:</u> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp 
	<span id='adainloukzu' style="color:red;display:none;font-size:130%"><span> עדין לא הוקצו  </span> <span id='mekomotGvarim'>0</span><span> מקומות לגברים ו-</span><span id='mekomotNashim'>0 </span><span> מקומות לנשים</span>
	</span>
	<span id='yotermidai' style="color:red;display:none;font-size:130%"> הוקצו מקומות מעבר לבקשה. יש לתקן את ההקצאה או את הבקשה</span>
	<span id='hakzaamleaa' style="color:green;display:none;font-size:130%"> הוקצו מקומות בהתאם לבקשה</span>
	<span id='holidayMixup' style="color:red;display:none;font-size:130%"><marquee direction='right';  width:  100%;
    height: 100%; SCROLLAMOUNT =10><b> ההקצאה כרגע היא עבור שני המועדים. כרגע ההקצאה לראש השנה שונה מההקצאה ליום כפור. כדי לצרף את שתי ההקצאות להקצאה אחידה לשני החגים יש לבצע שינוי כל שהוא בהקצאות</b></marquee></span>
	 </p> 
	<table>
	
	<thead> 	<tr> 	<th>    </th><th>ראש השנה</th><th>יום כפור</th> </tr>  </thead> 
	<tbody id='misparMekomot'>  
	 <tr>  <td>גברים</td> <td><span id="menRosh" ></span></td><td><span id="menkipur" ></span></td></tr>
	 <tr>  <td>נשים</td> <td><span id="womenRosh" ></span></td><td><span id="womenkipur" ></span></td></tr> 
	</tbody>
	</table>
	<br>
	<div ><u>מנין מועדף - נשים  : </u>  <span id='minyanW'></span>    </div>	
	<div ><u>מנין מועדף - גברים  : </u>  <span id='minyanM'></span>    </div>	
	<br>
		
		      <div  id='RmoreComments' style='display:none' ><u>הערות ובקשות נוספות: </u>&nbsp &nbsp &nbsp <span id='rCmnts'  ></span></div><br>
		</div>	
		<div id='colorMap'   style='display:none'>
		
		   <h3> מפתח צבעים </h3>
		   <table  style="direction:ltr">
			 <thead> <tr> <th> &nbsp &nbsp 0 &nbsp &nbsp </th> <th> &nbsp &nbsp <1 &nbsp   </th> <th> &nbsp &nbsp 1 &nbsp &nbsp </th> 
			 <th> &nbsp &nbsp <2 &nbsp </th> <th> &nbsp &nbsp  2 &nbsp &nbsp </th> 
			 <th>&nbsp &nbsp  <3 &nbsp </th> <th>&nbsp &nbsp 3 &nbsp &nbsp  </th> <th> &nbsp &nbsp >3 &nbsp </th></tr></thead>
			 <tbody>
			 <tr>
			 <td > &nbsp </td>  <td style="background:rgba(190,190,190,0.6)"> &nbsp </td>
			 <td style="background:rgba(0,0,255,0.6)"> &nbsp </td>    <td style="background:rgba(0,255,0,0.6)"> &nbsp </td>
			 <td style="background:rgba(255,255,0,0.6)"> &nbsp </td>   <td style="background:rgba(255,165,0,0.6)"> &nbsp </td>
			 <td style="background:rgba(255,0,0,0.6)"> &nbsp </td>    <td style="background:rgba(139,0,0,0.6)"> &nbsp </td>    </tr>
			 </tbody>  </table>
		 
<br></div>
<br>

<div id='explnArrow1' >
בפעולת עריכה קיימת הפונקציונליות הבאה:<br>
1. לחיצה על ה x  מימין לשם החבר תמחוק את השם<br>
2. אם, כאשר נלחץ אחד החיצים, גם מקש alt לחוץ, תתבצע שמירה אוטומטית והמערכת תקדם אל השם הבא או הקודם
<br> &nbsp &nbsp &nbsp (הדבר נכון גם ביחס לחיצים בשורה בתחתית המסך)<br>
3. לחיצה על מקש c (או ב אם נמצאים במצב עברית) כאשר מקש alt לחוץ, תבטל או תפעיל את פונקציית השלמת השמות האוטומטית<br>
4. לחיצה על מקש j (או ח אם נמצאים במצב עברית) כאשר מקש alt לחוץ, <br> &nbsp &nbsp &nbsp תשמור אוטומטית את השינויים שנעשו עבור החבר המוצג על המסך 
<br> &nbsp &nbsp &nbsp ותקפיץ את התצוגה אל ראש הדף ויוצג המידע של החבר שהוקצה לו הכסא עליו נמצא הcursor בעת הלחיצה
<br> &nbsp &nbsp &nbsp (הבחירה של החבר תהיה בהתאם לחג אותו עורכים)<br>
5. לחיצה על מקש l (או ך אם נמצאים במצב עברית) כאשר מקש alt לחוץ, <br> &nbsp &nbsp &nbsp
דומה בתפקודה למקש j, פרט לכך שה cursor ישאר באותו המקום שהיה לפני הלחיצה
</div>

<div id='explnArrow2' >
בפעולת סקירה קיימת הפונקציונליות הבאה:<br>
1. לחיצה על ה x  מימין לשם החבר תמחוק את השם<br>
2. לחיצה על מקש c (או ב אם נמצאים במצב עברית) כאשר מקש alt לחוץ, תבטל או תפעיל את פונקציית השלמת השמות האוטומטית<br>
3. לחיצה על מקש j (או ח אם נמצאים במצב עברית) כאשר מקש alt לחוץ, 
<br> &nbsp &nbsp &nbsp תקפיץ את התצוגה אל ראש הדף ויוצג המידע של החבר שהוקצה לו הכסא עליו נמצא הcursor בעת הלחיצה
<br> &nbsp &nbsp &nbsp (הבחירה של החבר תהיה בהתאם לחג אותו עורכים)<br>
4.לחיצה על מקש l (או ך אם נמצאים במצב עברית) כאשר מקש alt לחוץ, <br> &nbsp &nbsp &nbsp
דומה בתפקודה למקש j, פרט לכך שה cursor ישאר באותו המקום שהיה לפני הלחיצה
</div>



<!--
RGray='rgba(190,190,190,0.6)';
RBlue='rgba(0,0,255,0.6)';
RGreen='rgba(0,255,0,0.6)';
RYellow='rgba(255,255,0,0.6)';
ROrange='rgba(255,165,0,0.6)';
RRed='rgba(255,0,0,0.6)';
RRed4='rgba(139,0,0,0.6)';  // dark red replacement


-->
									                  
	</fieldset> 

	<fieldset id="hall1" class="subframe"   style='display:none'>
	   <legend><big><b id="Hall1FrameTop"><button  type="button" id='hall1Button' style='font-size:30px' onclick= 'prtPg()'>מרתף </button> </b></big></legend>   
		 <div id="drawing_1" style='visibility:hidden'> </div>
		 <div id="drawing_2" style='visibility:hidden'> לוח זכרון</div>
		 <div id="knisa" style='visibility:hidden'> כניסה </div>
		 <div id="mafrid1" style='visibility:hidden'> </div>
		 <div id="mafrid2" style='visibility:hidden'> </div>
		 <div id="mafrid3" style='visibility:hidden'> </div>
	   
	 </fieldset> <br><br>
		 
		 
		 
   <fieldset id="hall2" class="subframe"  style='display:none'>
	    <legend><big><b id="Hall2FrameTop"><button  type="button" id='hall2Button' style='font-size:30px' onclick= 'prtPg()'>>אולם ראשי</b></big></button></legend> 
			<div id="drawing_3" style='visibility:hidden'> </div>
			<div id="mafrid4" style='visibility:hidden'> </div>
		  <div id="mafrid5" style='visibility:hidden'> </div>
			<div id="knisa1" style='visibility:hidden'> כניסה </div>
			<div id="arrow1" style='visibility:hidden'> &#x27a0;</div>
			<div id="knisa2" style='visibility:hidden'>  כניסה <br> לגברים </div>   
      <div id="arrow2" style='visibility:hidden'> &#x27a8;</div>

			
  </fieldset> <br><br>
  
	
	 <fieldset id="hall3" class="subframe"   style='display:none'>
	    <legend><big><b id="Hall3FrameTop"><button  type="button" id='hall3Button' style='font-size:30px' onclick= 'prtPg()'>עזרת נשים</button> </b></big></legend>
			<div id="drawing_4" style='visibility:hidden'> </div>
			<div id="knisa3" style='visibility:hidden'> כניסה </div>
			<div id="arrow3" style='visibility:hidden'> &#x27a8;</div>
			<div id="drawing_5" style='visibility:hidden'> </div>
			<div id="drawing_6" style='visibility:hidden'> </div> 
			<div id="knisa4" style='visibility:hidden'> כניסה </div>
   		<div id="arrow4" style='visibility:hidden'> &#x27a8;</div>

			
 </fieldset> <br><br>
<fieldset id='Button'>

	
	<input type="text"  name='seatsString'  value='' style='display:none'> 
	</fieldset>
</form>

<form name="hiddenForm" id='hiddenForm' style='display:none'>
<div id='hiddenDiv'>  </div>
<input type="text"  name='lastFamName'  value='' style='display:none'>

</form>

<div id='showNames' >מקום מספר <span id='misparMakom'></span><br><span id='isBikshu'> &nbsp בקשו את המקום: <span id='bikshu'> </span></span><br><span id='mukzerosh'>מוקצה לראש השנה ל: <span id='hakzaaRosh'></span>
    </span><span id='muktzaTag1'>  מוקצה &nbsp </span><span id='mukzekipur'><span id='muktzaTag2'>,</span> ליום כפור ל: <span id='hakzaakipur'></span>  </span></div>

</body>
</html>

